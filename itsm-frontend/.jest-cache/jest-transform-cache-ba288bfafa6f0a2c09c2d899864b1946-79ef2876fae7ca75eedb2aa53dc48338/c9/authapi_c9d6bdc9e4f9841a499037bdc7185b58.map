{"version":3,"names":["cov_130d1mmmik","actualCoverage","s","AuthAPI","f","authApiClient","default","_default","API_BASE_URL","b","process","env","NEXT_PUBLIC_API_URL","API_TIMEOUT","AuthApiClient","constructor","baseURL","timeout","getCsrfToken","response","fetch","_apiunified","API_URLS","LOGIN","replace","method","credentials","headers","ok","Error","data","json","token","error","console","login","loginData","csrfToken","controller","AbortController","timeoutId","setTimeout","abort","body","JSON","stringify","username","password","remember_me","rememberMe","totp_code","totpCode","signal","clearTimeout","success","message","_tokenstorage","setAccessToken","refreshToken","refresh_token","requiresMfa","requires_mfa","mfaType","mfa_type","user","name","logout","getAccessToken","clearAuthStorage","getWebAuthnChallenge","challenge","verifyWebAuthn","credential","initiateSSOLogin","provider","redirectUrl","redirect_url","validateToken","valid"],"sources":["/Users/heidsoft/Downloads/research/itsm/itsm-frontend/src/lib/api/auth-api.ts"],"sourcesContent":["/**\n * 企业级ITSM认证API示例\n * 展示如何安全地与后端进行认证交互\n */\n\n// 类型定义\nexport interface LoginRequest {\n  username: string;\n  password: string;\n  rememberMe?: boolean;\n  totpCode?: string;\n  csrfToken?: string;\n}\n\nexport interface LoginResponse {\n  success: boolean;\n  token?: string;\n  refreshToken?: string;\n  requiresMfa?: boolean;\n  mfaType?: 'totp' | 'webauthn';\n  user?: {\n    id: string;\n    username: string;\n    email: string;\n    role: string;\n    permissions: string[];\n  };\n  error?: string;\n}\n\nexport interface RefreshTokenResponse {\n  success: boolean;\n  token?: string;\n  error?: string;\n}\n\nexport interface WebAuthnChallengeResponse {\n  success: boolean;\n  challenge?: string;\n  error?: string;\n}\n\n// API配置\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8080';\nconst API_TIMEOUT = 30000; // 30秒超时\n\n// 统一 token 存储工具\nimport { setAccessToken, getAccessToken, clearAuthStorage } from '@/lib/auth/token-storage';\nimport { API_URLS } from './api-unified';\n\n// HTTP客户端配置\nclass AuthApiClient {\n  private baseURL: string;\n  private timeout: number;\n\n  constructor(baseURL: string = API_BASE_URL, timeout: number = API_TIMEOUT) {\n    this.baseURL = baseURL;\n    this.timeout = timeout;\n  }\n\n  /**\n   * 获取CSRF Token\n   */\n  async getCsrfToken(): Promise<string> {\n    try {\n      const response = await fetch(`${this.baseURL}${API_URLS.LOGIN().replace('/login', '')}/csrf`, {\n        method: 'GET',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to get CSRF token');\n      }\n\n      const data = await response.json();\n      return data.token;\n    } catch (error) {\n      console.error('Error getting CSRF token:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 用户登录\n   */\n  async login(loginData: LoginRequest): Promise<LoginResponse> {\n    try {\n      // 获取CSRF Token（如果没有提供）\n      const csrfToken = loginData.csrfToken || await this.getCsrfToken();\n\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), this.timeout);\n\n      const response = await fetch(`${this.baseURL}${API_URLS.LOGIN()}`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRF-Token': csrfToken,\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify({\n          username: loginData.username,\n          password: loginData.password,\n          remember_me: loginData.rememberMe,\n          totp_code: loginData.totpCode,\n        }),\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        return {\n          success: false,\n          error: data.message || 'Login failed',\n        };\n      }\n\n      // 安全地存储token（仅在成功时）\n      if (data.token) {\n        // 统一使用 access_token（通过 token-storage 统一管理）\n        setAccessToken(data.token);\n      }\n\n      return {\n        success: true,\n        token: data.token,\n        refreshToken: data.refresh_token,\n        requiresMfa: data.requires_mfa,\n        mfaType: data.mfa_type,\n        user: data.user,\n      };\n    } catch (error) {\n      console.error('Login error:', error);\n      \n      if (error instanceof Error) {\n        if (error.name === 'AbortError') {\n          return {\n            success: false,\n            error: 'Request timeout',\n          };\n        }\n        \n        return {\n          success: false,\n          error: error.message,\n        };\n      }\n\n      return {\n        success: false,\n        error: 'Network error',\n      };\n    }\n  }\n\n  /**\n   * 刷新Token\n   */\n  async refreshToken(refreshToken: string): Promise<RefreshTokenResponse> {\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), this.timeout);\n\n      const response = await fetch(`${this.baseURL}/api/auth/refresh`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${refreshToken}`,\n        },\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        return {\n          success: false,\n          error: data.message || 'Token refresh failed',\n        };\n      }\n\n      return {\n        success: true,\n        token: data.token,\n      };\n    } catch (error) {\n      console.error('Token refresh error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Network error',\n      };\n    }\n  }\n\n  /**\n   * 用户登出\n   */\n  async logout(): Promise<{ success: boolean; error?: string }> {\n    try {\n      const token = getAccessToken();\n      \n      const response = await fetch(`${this.baseURL}/api/auth/logout`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(token && { 'Authorization': `Bearer ${token}` }),\n        },\n      });\n\n      // 清除本地存储的token（统一清理，包含历史键名）\n      clearAuthStorage();\n\n      if (!response.ok) {\n        const data = await response.json();\n        return {\n          success: false,\n          error: data.message || 'Logout failed',\n        };\n      }\n\n      return { success: true };\n    } catch (error) {\n      console.error('Logout error:', error);\n      \n      // 即使请求失败，也要清除本地token（统一清理，包含历史键名）\n      clearAuthStorage();\n      \n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Network error',\n      };\n    }\n  }\n\n  /**\n   * WebAuthn认证挑战\n   */\n  async getWebAuthnChallenge(username: string): Promise<WebAuthnChallengeResponse> {\n    try {\n      const response = await fetch(`${this.baseURL}/api/auth/webauthn/challenge`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ username }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        return {\n          success: false,\n          error: data.message || 'Failed to get WebAuthn challenge',\n        };\n      }\n\n      return {\n        success: true,\n        challenge: data.challenge,\n      };\n    } catch (error) {\n      console.error('WebAuthn challenge error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Network error',\n      };\n    }\n  }\n\n  /**\n   * WebAuthn认证验证\n   */\n  async verifyWebAuthn(credential: WebAuthnCredential): Promise<LoginResponse> {\n    try {\n      const response = await fetch(`${this.baseURL}/api/auth/webauthn/verify`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ credential }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        return {\n          success: false,\n          error: data.message || 'WebAuthn verification failed',\n        };\n      }\n\n      return {\n        success: true,\n        token: data.token,\n        refreshToken: data.refresh_token,\n        user: data.user,\n      };\n    } catch (error) {\n      console.error('WebAuthn verification error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Network error',\n      };\n    }\n  }\n\n  /**\n   * SSO登录重定向\n   */\n  async initiateSSOLogin(provider: string = 'default'): Promise<{ success: boolean; redirectUrl?: string; error?: string }> {\n    try {\n      const response = await fetch(`${this.baseURL}/api/auth/sso/initiate`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ provider }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        return {\n          success: false,\n          error: data.message || 'SSO initiation failed',\n        };\n      }\n\n      return {\n        success: true,\n        redirectUrl: data.redirect_url,\n      };\n    } catch (error) {\n      console.error('SSO initiation error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Network error',\n      };\n    }\n  }\n\n  /**\n   * 验证当前token是否有效\n   */\n  async validateToken(): Promise<{ valid: boolean; user?: WebAuthnUser; error?: string }> {\n    try {\n      const token = getAccessToken();\n      \n      if (!token) {\n        return { valid: false, error: 'No token found' };\n      }\n\n      const response = await fetch(`${this.baseURL}/api/auth/validate`, {\n        method: 'GET',\n        credentials: 'include',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        return { valid: false, error: 'Token validation failed' };\n      }\n\n      const data = await response.json();\n      return {\n        valid: true,\n        user: data.user,\n      };\n    } catch (error) {\n      console.error('Token validation error:', error);\n      return {\n        valid: false,\n        error: error instanceof Error ? error.message : 'Network error',\n      };\n    }\n  }\n}\n\n// 导出单例实例\nexport const authApiClient = new AuthApiClient();\n\n// WebAuthn类型定义\nexport interface WebAuthnCredential {\n  id: string;\n  rawId: ArrayBuffer;\n  response: {\n    authenticatorData: ArrayBuffer;\n    clientDataJSON: ArrayBuffer;\n    signature: ArrayBuffer;\n    userHandle?: ArrayBuffer;\n  };\n  type: 'public-key';\n}\n\nexport interface WebAuthnUser {\n  id: string;\n  username: string;\n  email: string;\n  role: string;\n  permissions: string[];\n}\n\n// 导出便捷方法\nexport const AuthAPI = {\n  login: (data: LoginRequest) => authApiClient.login(data),\n  logout: () => authApiClient.logout(),\n  refreshToken: (token: string) => authApiClient.refreshToken(token),\n  getCsrfToken: () => authApiClient.getCsrfToken(),\n  getWebAuthnChallenge: (username: string) => authApiClient.getWebAuthnChallenge(username),\n  verifyWebAuthn: (credential: WebAuthnCredential) => authApiClient.verifyWebAuthn(credential),\n  initiateSSOLogin: (provider?: string) => authApiClient.initiateSSOLogin(provider),\n  validateToken: () => authApiClient.validateToken(),\n};\n\nexport default AuthAPI;"],"mappings":"AAAA;;;GAAA,CAKA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA8ZoB;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAAAA,cAAA,GAAAE,CAAA;;;;;;;;;;;;;;;;;;;;EAAPC,OAAO,WAAAA,CAAA;IAAA;IAAAH,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;WAAPC,OAAA;;EAxBAE,aAAa,WAAAA,CAAA;IAAA;IAAAL,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;WAAbG,aAAA;;EAmCbC,OAAuB,WAAAA,CAAA;IAAA;IAAAN,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;WAAvBK,QAAA;;;;;kCA/XiE;;;kCACxC;AANzB;AACA,MAAMC,YAAA;AAAA;AAAA,CAAAR,cAAA,GAAAE,CAAA;AAAe;AAAA,CAAAF,cAAA,GAAAS,CAAA,UAAAC,OAAA,CAAQC,GAAG,CAACC,mBAAmB;AAAA;AAAA,CAAAZ,cAAA,GAAAS,CAAA,UAAI;AACxD,MAAMI,WAAA;AAAA;AAAA,CAAAb,cAAA,GAAAE,CAAA,QAAc,QAAO;AAM3B;AACA,MAAMY,aAAA;EAIJC,YAAYC,OAAA;EAAA;EAAA,CAAAhB,cAAA,GAAAS,CAAA,UAAkBD,YAAY,GAAES,OAAA;EAAA;EAAA,CAAAjB,cAAA,GAAAS,CAAA,UAAkBI,WAAW,GAAE;IAAA;IAAAb,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IACzE,IAAI,CAACc,OAAO,GAAGA,OAAA;IAAA;IAAAhB,cAAA,GAAAE,CAAA;IACf,IAAI,CAACe,OAAO,GAAGA,OAAA;EACjB;EAEA;;;EAGA,MAAMC,aAAA,EAAgC;IAAA;IAAAlB,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IACpC,IAAI;MACF,MAAMiB,QAAA;MAAA;MAAA,CAAAnB,cAAA,GAAAE,CAAA,QAAW,MAAMkB,KAAA,CAAM,GAAG,IAAI,CAACJ,OAAO,GAAGK,WAAA,CAAAC,QAAQ,CAACC,KAAK,GAAGC,OAAO,CAAC,UAAU,UAAU,EAAE;QAC5FC,MAAA,EAAQ;QACRC,WAAA,EAAa;QACbC,OAAA,EAAS;UACP,gBAAgB;QAClB;MACF;MAAA;MAAA3B,cAAA,GAAAE,CAAA;MAEA,IAAI,CAACiB,QAAA,CAASS,EAAE,EAAE;QAAA;QAAA5B,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QAChB,MAAM,IAAI2B,KAAA,CAAM;MAClB;MAAA;MAAA;QAAA7B,cAAA,GAAAS,CAAA;MAAA;MAEA,MAAMqB,IAAA;MAAA;MAAA,CAAA9B,cAAA,GAAAE,CAAA,QAAO,MAAMiB,QAAA,CAASY,IAAI;MAAA;MAAA/B,cAAA,GAAAE,CAAA;MAChC,OAAO4B,IAAA,CAAKE,KAAK;IACnB,EAAE,OAAOC,KAAA,EAAO;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MACdgC,OAAA,CAAQD,KAAK,CAAC,6BAA6BA,KAAA;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MAC3C,MAAM+B,KAAA;IACR;EACF;EAEA;;;EAGA,MAAME,MAAMC,SAAuB,EAA0B;IAAA;IAAApC,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IAC3D,IAAI;MACF;MACA,MAAMmC,SAAA;MAAA;MAAA,CAAArC,cAAA,GAAAE,CAAA;MAAY;MAAA,CAAAF,cAAA,GAAAS,CAAA,UAAA2B,SAAA,CAAUC,SAAS;MAAA;MAAA,CAAArC,cAAA,GAAAS,CAAA,UAAI,MAAM,IAAI,CAACS,YAAY;MAEhE,MAAMoB,UAAA;MAAA;MAAA,CAAAtC,cAAA,GAAAE,CAAA,QAAa,IAAIqC,eAAA;MACvB,MAAMC,SAAA;MAAA;MAAA,CAAAxC,cAAA,GAAAE,CAAA,QAAYuC,UAAA,CAAW,MAAM;QAAA;QAAAzC,cAAA,GAAAI,CAAA;QAAAJ,cAAA,GAAAE,CAAA;QAAA,OAAAoC,UAAA,CAAWI,KAAK;MAAA,GAAI,IAAI,CAACzB,OAAO;MAEnE,MAAME,QAAA;MAAA;MAAA,CAAAnB,cAAA,GAAAE,CAAA,QAAW,MAAMkB,KAAA,CAAM,GAAG,IAAI,CAACJ,OAAO,GAAGK,WAAA,CAAAC,QAAQ,CAACC,KAAK,IAAI,EAAE;QACjEE,MAAA,EAAQ;QACRC,WAAA,EAAa;QACbC,OAAA,EAAS;UACP,gBAAgB;UAChB,gBAAgBU,SAAA;UAChB,oBAAoB;QACtB;QACAM,IAAA,EAAMC,IAAA,CAAKC,SAAS,CAAC;UACnBC,QAAA,EAAUV,SAAA,CAAUU,QAAQ;UAC5BC,QAAA,EAAUX,SAAA,CAAUW,QAAQ;UAC5BC,WAAA,EAAaZ,SAAA,CAAUa,UAAU;UACjCC,SAAA,EAAWd,SAAA,CAAUe;QACvB;QACAC,MAAA,EAAQd,UAAA,CAAWc;MACrB;MAAA;MAAApD,cAAA,GAAAE,CAAA;MAEAmD,YAAA,CAAab,SAAA;MAEb,MAAMV,IAAA;MAAA;MAAA,CAAA9B,cAAA,GAAAE,CAAA,QAAO,MAAMiB,QAAA,CAASY,IAAI;MAAA;MAAA/B,cAAA,GAAAE,CAAA;MAEhC,IAAI,CAACiB,QAAA,CAASS,EAAE,EAAE;QAAA;QAAA5B,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QAChB,OAAO;UACLoD,OAAA,EAAS;UACTrB,KAAA;UAAO;UAAA,CAAAjC,cAAA,GAAAS,CAAA,UAAAqB,IAAA,CAAKyB,OAAO;UAAA;UAAA,CAAAvD,cAAA,GAAAS,CAAA,UAAI;QACzB;MACF;MAAA;MAAA;QAAAT,cAAA,GAAAS,CAAA;MAAA;MAEA;MAAAT,cAAA,GAAAE,CAAA;MACA,IAAI4B,IAAA,CAAKE,KAAK,EAAE;QAAA;QAAAhC,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QACd;QACA,IAAAsD,aAAA,CAAAC,cAAc,EAAC3B,IAAA,CAAKE,KAAK;MAC3B;MAAA;MAAA;QAAAhC,cAAA,GAAAS,CAAA;MAAA;MAAAT,cAAA,GAAAE,CAAA;MAEA,OAAO;QACLoD,OAAA,EAAS;QACTtB,KAAA,EAAOF,IAAA,CAAKE,KAAK;QACjB0B,YAAA,EAAc5B,IAAA,CAAK6B,aAAa;QAChCC,WAAA,EAAa9B,IAAA,CAAK+B,YAAY;QAC9BC,OAAA,EAAShC,IAAA,CAAKiC,QAAQ;QACtBC,IAAA,EAAMlC,IAAA,CAAKkC;MACb;IACF,EAAE,OAAO/B,KAAA,EAAO;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MACdgC,OAAA,CAAQD,KAAK,CAAC,gBAAgBA,KAAA;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MAE9B,IAAI+B,KAAA,YAAiBJ,KAAA,EAAO;QAAA;QAAA7B,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QAC1B,IAAI+B,KAAA,CAAMgC,IAAI,KAAK,cAAc;UAAA;UAAAjE,cAAA,GAAAS,CAAA;UAAAT,cAAA,GAAAE,CAAA;UAC/B,OAAO;YACLoD,OAAA,EAAS;YACTrB,KAAA,EAAO;UACT;QACF;QAAA;QAAA;UAAAjC,cAAA,GAAAS,CAAA;QAAA;QAAAT,cAAA,GAAAE,CAAA;QAEA,OAAO;UACLoD,OAAA,EAAS;UACTrB,KAAA,EAAOA,KAAA,CAAMsB;QACf;MACF;MAAA;MAAA;QAAAvD,cAAA,GAAAS,CAAA;MAAA;MAAAT,cAAA,GAAAE,CAAA;MAEA,OAAO;QACLoD,OAAA,EAAS;QACTrB,KAAA,EAAO;MACT;IACF;EACF;EAEA;;;EAGA,MAAMyB,aAAaA,YAAoB,EAAiC;IAAA;IAAA1D,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IACtE,IAAI;MACF,MAAMoC,UAAA;MAAA;MAAA,CAAAtC,cAAA,GAAAE,CAAA,QAAa,IAAIqC,eAAA;MACvB,MAAMC,SAAA;MAAA;MAAA,CAAAxC,cAAA,GAAAE,CAAA,QAAYuC,UAAA,CAAW,MAAM;QAAA;QAAAzC,cAAA,GAAAI,CAAA;QAAAJ,cAAA,GAAAE,CAAA;QAAA,OAAAoC,UAAA,CAAWI,KAAK;MAAA,GAAI,IAAI,CAACzB,OAAO;MAEnE,MAAME,QAAA;MAAA;MAAA,CAAAnB,cAAA,GAAAE,CAAA,QAAW,MAAMkB,KAAA,CAAM,GAAG,IAAI,CAACJ,OAAO,mBAAmB,EAAE;QAC/DS,MAAA,EAAQ;QACRC,WAAA,EAAa;QACbC,OAAA,EAAS;UACP,gBAAgB;UAChB,iBAAiB,UAAU+B,YAAA;QAC7B;QACAN,MAAA,EAAQd,UAAA,CAAWc;MACrB;MAAA;MAAApD,cAAA,GAAAE,CAAA;MAEAmD,YAAA,CAAab,SAAA;MAEb,MAAMV,IAAA;MAAA;MAAA,CAAA9B,cAAA,GAAAE,CAAA,QAAO,MAAMiB,QAAA,CAASY,IAAI;MAAA;MAAA/B,cAAA,GAAAE,CAAA;MAEhC,IAAI,CAACiB,QAAA,CAASS,EAAE,EAAE;QAAA;QAAA5B,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QAChB,OAAO;UACLoD,OAAA,EAAS;UACTrB,KAAA;UAAO;UAAA,CAAAjC,cAAA,GAAAS,CAAA,WAAAqB,IAAA,CAAKyB,OAAO;UAAA;UAAA,CAAAvD,cAAA,GAAAS,CAAA,WAAI;QACzB;MACF;MAAA;MAAA;QAAAT,cAAA,GAAAS,CAAA;MAAA;MAAAT,cAAA,GAAAE,CAAA;MAEA,OAAO;QACLoD,OAAA,EAAS;QACTtB,KAAA,EAAOF,IAAA,CAAKE;MACd;IACF,EAAE,OAAOC,KAAA,EAAO;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MACdgC,OAAA,CAAQD,KAAK,CAAC,wBAAwBA,KAAA;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MACtC,OAAO;QACLoD,OAAA,EAAS;QACTrB,KAAA,EAAOA,KAAA,YAAiBJ,KAAA;QAAA;QAAA,CAAA7B,cAAA,GAAAS,CAAA,WAAQwB,KAAA,CAAMsB,OAAO;QAAA;QAAA,CAAAvD,cAAA,GAAAS,CAAA,WAAG;MAClD;IACF;EACF;EAEA;;;EAGA,MAAMyD,OAAA,EAAwD;IAAA;IAAAlE,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IAC5D,IAAI;MACF,MAAM8B,KAAA;MAAA;MAAA,CAAAhC,cAAA,GAAAE,CAAA,QAAQ,IAAAsD,aAAA,CAAAW,cAAc;MAE5B,MAAMhD,QAAA;MAAA;MAAA,CAAAnB,cAAA,GAAAE,CAAA,QAAW,MAAMkB,KAAA,CAAM,GAAG,IAAI,CAACJ,OAAO,kBAAkB,EAAE;QAC9DS,MAAA,EAAQ;QACRC,WAAA,EAAa;QACbC,OAAA,EAAS;UACP,gBAAgB;UAChB;UAAI;UAAA,CAAA3B,cAAA,GAAAS,CAAA,WAAAuB,KAAA;UAAA;UAAA,CAAAhC,cAAA,GAAAS,CAAA,WAAS;YAAE,iBAAiB,UAAUuB,KAAA;UAAQ,CAAC;QACrD;MACF;MAEA;MAAA;MAAAhC,cAAA,GAAAE,CAAA;MACA,IAAAsD,aAAA,CAAAY,gBAAgB;MAAA;MAAApE,cAAA,GAAAE,CAAA;MAEhB,IAAI,CAACiB,QAAA,CAASS,EAAE,EAAE;QAAA;QAAA5B,cAAA,GAAAS,CAAA;QAChB,MAAMqB,IAAA;QAAA;QAAA,CAAA9B,cAAA,GAAAE,CAAA,QAAO,MAAMiB,QAAA,CAASY,IAAI;QAAA;QAAA/B,cAAA,GAAAE,CAAA;QAChC,OAAO;UACLoD,OAAA,EAAS;UACTrB,KAAA;UAAO;UAAA,CAAAjC,cAAA,GAAAS,CAAA,WAAAqB,IAAA,CAAKyB,OAAO;UAAA;UAAA,CAAAvD,cAAA,GAAAS,CAAA,WAAI;QACzB;MACF;MAAA;MAAA;QAAAT,cAAA,GAAAS,CAAA;MAAA;MAAAT,cAAA,GAAAE,CAAA;MAEA,OAAO;QAAEoD,OAAA,EAAS;MAAK;IACzB,EAAE,OAAOrB,KAAA,EAAO;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MACdgC,OAAA,CAAQD,KAAK,CAAC,iBAAiBA,KAAA;MAE/B;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MACA,IAAAsD,aAAA,CAAAY,gBAAgB;MAAA;MAAApE,cAAA,GAAAE,CAAA;MAEhB,OAAO;QACLoD,OAAA,EAAS;QACTrB,KAAA,EAAOA,KAAA,YAAiBJ,KAAA;QAAA;QAAA,CAAA7B,cAAA,GAAAS,CAAA,WAAQwB,KAAA,CAAMsB,OAAO;QAAA;QAAA,CAAAvD,cAAA,GAAAS,CAAA,WAAG;MAClD;IACF;EACF;EAEA;;;EAGA,MAAM4D,qBAAqBvB,QAAgB,EAAsC;IAAA;IAAA9C,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IAC/E,IAAI;MACF,MAAMiB,QAAA;MAAA;MAAA,CAAAnB,cAAA,GAAAE,CAAA,QAAW,MAAMkB,KAAA,CAAM,GAAG,IAAI,CAACJ,OAAO,8BAA8B,EAAE;QAC1ES,MAAA,EAAQ;QACRC,WAAA,EAAa;QACbC,OAAA,EAAS;UACP,gBAAgB;QAClB;QACAgB,IAAA,EAAMC,IAAA,CAAKC,SAAS,CAAC;UAAEC;QAAS;MAClC;MAEA,MAAMhB,IAAA;MAAA;MAAA,CAAA9B,cAAA,GAAAE,CAAA,QAAO,MAAMiB,QAAA,CAASY,IAAI;MAAA;MAAA/B,cAAA,GAAAE,CAAA;MAEhC,IAAI,CAACiB,QAAA,CAASS,EAAE,EAAE;QAAA;QAAA5B,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QAChB,OAAO;UACLoD,OAAA,EAAS;UACTrB,KAAA;UAAO;UAAA,CAAAjC,cAAA,GAAAS,CAAA,WAAAqB,IAAA,CAAKyB,OAAO;UAAA;UAAA,CAAAvD,cAAA,GAAAS,CAAA,WAAI;QACzB;MACF;MAAA;MAAA;QAAAT,cAAA,GAAAS,CAAA;MAAA;MAAAT,cAAA,GAAAE,CAAA;MAEA,OAAO;QACLoD,OAAA,EAAS;QACTgB,SAAA,EAAWxC,IAAA,CAAKwC;MAClB;IACF,EAAE,OAAOrC,KAAA,EAAO;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MACdgC,OAAA,CAAQD,KAAK,CAAC,6BAA6BA,KAAA;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MAC3C,OAAO;QACLoD,OAAA,EAAS;QACTrB,KAAA,EAAOA,KAAA,YAAiBJ,KAAA;QAAA;QAAA,CAAA7B,cAAA,GAAAS,CAAA,WAAQwB,KAAA,CAAMsB,OAAO;QAAA;QAAA,CAAAvD,cAAA,GAAAS,CAAA,WAAG;MAClD;IACF;EACF;EAEA;;;EAGA,MAAM8D,eAAeC,UAA8B,EAA0B;IAAA;IAAAxE,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IAC3E,IAAI;MACF,MAAMiB,QAAA;MAAA;MAAA,CAAAnB,cAAA,GAAAE,CAAA,QAAW,MAAMkB,KAAA,CAAM,GAAG,IAAI,CAACJ,OAAO,2BAA2B,EAAE;QACvES,MAAA,EAAQ;QACRC,WAAA,EAAa;QACbC,OAAA,EAAS;UACP,gBAAgB;QAClB;QACAgB,IAAA,EAAMC,IAAA,CAAKC,SAAS,CAAC;UAAE2B;QAAW;MACpC;MAEA,MAAM1C,IAAA;MAAA;MAAA,CAAA9B,cAAA,GAAAE,CAAA,QAAO,MAAMiB,QAAA,CAASY,IAAI;MAAA;MAAA/B,cAAA,GAAAE,CAAA;MAEhC,IAAI,CAACiB,QAAA,CAASS,EAAE,EAAE;QAAA;QAAA5B,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QAChB,OAAO;UACLoD,OAAA,EAAS;UACTrB,KAAA;UAAO;UAAA,CAAAjC,cAAA,GAAAS,CAAA,WAAAqB,IAAA,CAAKyB,OAAO;UAAA;UAAA,CAAAvD,cAAA,GAAAS,CAAA,WAAI;QACzB;MACF;MAAA;MAAA;QAAAT,cAAA,GAAAS,CAAA;MAAA;MAAAT,cAAA,GAAAE,CAAA;MAEA,OAAO;QACLoD,OAAA,EAAS;QACTtB,KAAA,EAAOF,IAAA,CAAKE,KAAK;QACjB0B,YAAA,EAAc5B,IAAA,CAAK6B,aAAa;QAChCK,IAAA,EAAMlC,IAAA,CAAKkC;MACb;IACF,EAAE,OAAO/B,KAAA,EAAO;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MACdgC,OAAA,CAAQD,KAAK,CAAC,gCAAgCA,KAAA;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MAC9C,OAAO;QACLoD,OAAA,EAAS;QACTrB,KAAA,EAAOA,KAAA,YAAiBJ,KAAA;QAAA;QAAA,CAAA7B,cAAA,GAAAS,CAAA,WAAQwB,KAAA,CAAMsB,OAAO;QAAA;QAAA,CAAAvD,cAAA,GAAAS,CAAA,WAAG;MAClD;IACF;EACF;EAEA;;;EAGA,MAAMgE,iBAAiBC,QAAA;EAAA;EAAA,CAAA1E,cAAA,GAAAS,CAAA,WAAmB,SAAS,GAAuE;IAAA;IAAAT,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IACxH,IAAI;MACF,MAAMiB,QAAA;MAAA;MAAA,CAAAnB,cAAA,GAAAE,CAAA,QAAW,MAAMkB,KAAA,CAAM,GAAG,IAAI,CAACJ,OAAO,wBAAwB,EAAE;QACpES,MAAA,EAAQ;QACRC,WAAA,EAAa;QACbC,OAAA,EAAS;UACP,gBAAgB;QAClB;QACAgB,IAAA,EAAMC,IAAA,CAAKC,SAAS,CAAC;UAAE6B;QAAS;MAClC;MAEA,MAAM5C,IAAA;MAAA;MAAA,CAAA9B,cAAA,GAAAE,CAAA,QAAO,MAAMiB,QAAA,CAASY,IAAI;MAAA;MAAA/B,cAAA,GAAAE,CAAA;MAEhC,IAAI,CAACiB,QAAA,CAASS,EAAE,EAAE;QAAA;QAAA5B,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QAChB,OAAO;UACLoD,OAAA,EAAS;UACTrB,KAAA;UAAO;UAAA,CAAAjC,cAAA,GAAAS,CAAA,WAAAqB,IAAA,CAAKyB,OAAO;UAAA;UAAA,CAAAvD,cAAA,GAAAS,CAAA,WAAI;QACzB;MACF;MAAA;MAAA;QAAAT,cAAA,GAAAS,CAAA;MAAA;MAAAT,cAAA,GAAAE,CAAA;MAEA,OAAO;QACLoD,OAAA,EAAS;QACTqB,WAAA,EAAa7C,IAAA,CAAK8C;MACpB;IACF,EAAE,OAAO3C,KAAA,EAAO;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MACdgC,OAAA,CAAQD,KAAK,CAAC,yBAAyBA,KAAA;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MACvC,OAAO;QACLoD,OAAA,EAAS;QACTrB,KAAA,EAAOA,KAAA,YAAiBJ,KAAA;QAAA;QAAA,CAAA7B,cAAA,GAAAS,CAAA,WAAQwB,KAAA,CAAMsB,OAAO;QAAA;QAAA,CAAAvD,cAAA,GAAAS,CAAA,WAAG;MAClD;IACF;EACF;EAEA;;;EAGA,MAAMoE,cAAA,EAAkF;IAAA;IAAA7E,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IACtF,IAAI;MACF,MAAM8B,KAAA;MAAA;MAAA,CAAAhC,cAAA,GAAAE,CAAA,QAAQ,IAAAsD,aAAA,CAAAW,cAAc;MAAA;MAAAnE,cAAA,GAAAE,CAAA;MAE5B,IAAI,CAAC8B,KAAA,EAAO;QAAA;QAAAhC,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QACV,OAAO;UAAE4E,KAAA,EAAO;UAAO7C,KAAA,EAAO;QAAiB;MACjD;MAAA;MAAA;QAAAjC,cAAA,GAAAS,CAAA;MAAA;MAEA,MAAMU,QAAA;MAAA;MAAA,CAAAnB,cAAA,GAAAE,CAAA,QAAW,MAAMkB,KAAA,CAAM,GAAG,IAAI,CAACJ,OAAO,oBAAoB,EAAE;QAChES,MAAA,EAAQ;QACRC,WAAA,EAAa;QACbC,OAAA,EAAS;UACP,iBAAiB,UAAUK,KAAA,EAAO;UAClC,gBAAgB;QAClB;MACF;MAAA;MAAAhC,cAAA,GAAAE,CAAA;MAEA,IAAI,CAACiB,QAAA,CAASS,EAAE,EAAE;QAAA;QAAA5B,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QAChB,OAAO;UAAE4E,KAAA,EAAO;UAAO7C,KAAA,EAAO;QAA0B;MAC1D;MAAA;MAAA;QAAAjC,cAAA,GAAAS,CAAA;MAAA;MAEA,MAAMqB,IAAA;MAAA;MAAA,CAAA9B,cAAA,GAAAE,CAAA,QAAO,MAAMiB,QAAA,CAASY,IAAI;MAAA;MAAA/B,cAAA,GAAAE,CAAA;MAChC,OAAO;QACL4E,KAAA,EAAO;QACPd,IAAA,EAAMlC,IAAA,CAAKkC;MACb;IACF,EAAE,OAAO/B,KAAA,EAAO;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MACdgC,OAAA,CAAQD,KAAK,CAAC,2BAA2BA,KAAA;MAAA;MAAAjC,cAAA,GAAAE,CAAA;MACzC,OAAO;QACL4E,KAAA,EAAO;QACP7C,KAAA,EAAOA,KAAA,YAAiBJ,KAAA;QAAA;QAAA,CAAA7B,cAAA,GAAAS,CAAA,WAAQwB,KAAA,CAAMsB,OAAO;QAAA;QAAA,CAAAvD,cAAA,GAAAS,CAAA,WAAG;MAClD;IACF;EACF;AACF;AAGO,MAAMJ,aAAA;AAAA;AAAA,CAAAL,cAAA,GAAAE,CAAA,QAAgB,IAAIY,aAAA;AAwB1B,MAAMX,OAAA;AAAA;AAAA,CAAAH,cAAA,GAAAE,CAAA,QAAU;EACrBiC,KAAA,EAAQL,IAAA,IAAuB;IAAA;IAAA9B,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IAAA,OAAAG,aAAA,CAAc8B,KAAK,CAACL,IAAA;EAAA;EACnDoC,MAAA,EAAQA,CAAA,KAAM;IAAA;IAAAlE,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IAAA,OAAAG,aAAA,CAAc6D,MAAM;EAAA;EAClCR,YAAA,EAAe1B,KAAA,IAAkB;IAAA;IAAAhC,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IAAA,OAAAG,aAAA,CAAcqD,YAAY,CAAC1B,KAAA;EAAA;EAC5Dd,YAAA,EAAcA,CAAA,KAAM;IAAA;IAAAlB,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IAAA,OAAAG,aAAA,CAAca,YAAY;EAAA;EAC9CmD,oBAAA,EAAuBvB,QAAA,IAAqB;IAAA;IAAA9C,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IAAA,OAAAG,aAAA,CAAcgE,oBAAoB,CAACvB,QAAA;EAAA;EAC/EyB,cAAA,EAAiBC,UAAA,IAAmC;IAAA;IAAAxE,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IAAA,OAAAG,aAAA,CAAckE,cAAc,CAACC,UAAA;EAAA;EACjFC,gBAAA,EAAmBC,QAAA,IAAsB;IAAA;IAAA1E,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IAAA,OAAAG,aAAA,CAAcoE,gBAAgB,CAACC,QAAA;EAAA;EACxEG,aAAA,EAAeA,CAAA,KAAM;IAAA;IAAA7E,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAE,CAAA;IAAA,OAAAG,aAAA,CAAcwE,aAAa;EAAA;AAClD;MAEAtE,QAAA;AAAA;AAAA,CAAAP,cAAA,GAAAE,CAAA,SAAeC,OAAA","ignoreList":[]}