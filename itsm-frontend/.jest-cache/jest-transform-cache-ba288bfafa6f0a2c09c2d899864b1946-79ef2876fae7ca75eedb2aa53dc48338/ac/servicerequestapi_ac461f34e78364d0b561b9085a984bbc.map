{"version":3,"names":["cov_1jf47eti08","actualCoverage","s","serviceRequestAPI","ServiceRequestAPI","constructor","f","baseURL","_apiconfig","API_BASE_URL","request","endpoint","options","b","token","_tokenstorage","getAccessToken","tenantCode","getTenantCode","response","fetch","headers","Authorization","ok","errorText","text","Error","status","statusText","data","json","code","message","error","console","getUserServiceRequests","params","searchParams","URLSearchParams","page","append","toString","size","getPendingApprovals","qs","getServiceRequestDetails","id","createServiceRequest","method","body","JSON","stringify","updateServiceRequestStatus","comment","applyApprovalAction","payload","healthCheck","startProvisioning","serviceRequestId","listProvisioningTasks","executeProvisioningTask","taskId"],"sources":["/Users/heidsoft/Downloads/research/itsm/itsm-frontend/src/lib/api/service-request-api.ts"],"sourcesContent":["import { API_BASE_URL } from '@/app/lib/api-config';\nimport { getAccessToken, getTenantCode } from '@/lib/auth/token-storage';\n\nexport interface ServiceRequest {\n  id: number;\n  catalog_id: number;\n  requester_id: number;\n  status:\n    | 'submitted'\n    | 'manager_approved'\n    | 'it_approved'\n    | 'security_approved'\n    | 'provisioning'\n    | 'delivered'\n    | 'failed'\n    | 'rejected'\n    | 'cancelled';\n  title?: string;\n  reason?: string;\n  form_data?: Record<string, any>;\n  cost_center?: string;\n  data_classification?: 'public' | 'internal' | 'confidential';\n  needs_public_ip?: boolean;\n  source_ip_whitelist?: string[];\n  expire_at?: string | null;\n  compliance_ack?: boolean;\n  current_level?: number;\n  total_levels?: number;\n  created_at: string;\n  catalog?: {\n    id: number;\n    name: string;\n    category: string;\n    description: string;\n    delivery_time: string;\n  };\n  requester?: {\n    id: number;\n    username: string;\n    name: string;\n    email: string;\n    department: string;\n  };\n}\n\nexport interface ServiceRequestListResponse {\n  requests: ServiceRequest[];\n  total: number;\n  page: number;\n  size: number;\n}\n\nexport interface CreateServiceRequestRequest {\n  catalog_id: number;\n  title?: string;\n  reason?: string;\n  form_data?: Record<string, any>;\n  cost_center?: string;\n  data_classification?: 'public' | 'internal' | 'confidential';\n  needs_public_ip?: boolean;\n  source_ip_whitelist?: string[];\n  expire_at?: string;\n  compliance_ack: boolean;\n}\n\nexport interface UpdateServiceRequestStatusRequest {\n  status:\n    | 'submitted'\n    | 'manager_approved'\n    | 'it_approved'\n    | 'security_approved'\n    | 'provisioning'\n    | 'delivered'\n    | 'failed'\n    | 'rejected'\n    | 'cancelled';\n}\n\nexport interface ServiceRequestApprovalActionRequest {\n  action: 'approve' | 'reject';\n  comment?: string;\n}\n\nclass ServiceRequestAPI {\n  private baseURL: string;\n\n  constructor() {\n    this.baseURL = API_BASE_URL;\n  }\n\n  private async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\n    const token = getAccessToken();\n    const tenantCode = getTenantCode();\n    \n    try {\n      const response = await fetch(`${this.baseURL}${endpoint}`, {\n        ...options,\n        headers: {\n          'Content-Type': 'application/json',\n          ...(token && { Authorization: `Bearer ${token}` }),\n          ...(tenantCode && { 'X-Tenant-Code': tenantCode }),\n          ...options.headers,\n        },\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorText}`);\n      }\n\n      const data = await response.json();\n      \n      // Check backend response code field\n      if (data.code !== 0) {\n        throw new Error(data.message || 'Request failed');\n      }\n      \n      return data.data; // Backend response format: { code, message, data }\n    } catch (error) {\n      console.error('API request failed:', error);\n      throw error;\n    }\n  }\n\n  // Get current user's service request list\n  async getUserServiceRequests(params: {\n    page?: number;\n    size?: number;\n    status?: string;\n  } = {}): Promise<ServiceRequestListResponse> {\n    const searchParams = new URLSearchParams();\n    \n    if (params.page) searchParams.append('page', params.page.toString());\n    if (params.size) searchParams.append('size', params.size.toString());\n    if (params.status && params.status !== 'all') searchParams.append('status', params.status);\n\n    return this.request<ServiceRequestListResponse>(\n      `/api/v1/service-requests/me?${searchParams.toString()}`\n    );\n  }\n\n  // Get pending approvals (approver inbox)\n  async getPendingApprovals(params: { page?: number; size?: number } = {}): Promise<ServiceRequestListResponse> {\n    const searchParams = new URLSearchParams();\n    if (params.page) searchParams.append('page', params.page.toString());\n    if (params.size) searchParams.append('size', params.size.toString());\n    const qs = searchParams.toString();\n    return this.request<ServiceRequestListResponse>(\n      `/api/v1/service-requests/approvals/pending${qs ? `?${qs}` : ''}`\n    );\n  }\n\n  // Get service request details\n  async getServiceRequestDetails(id: number): Promise<ServiceRequest> {\n    return this.request<ServiceRequest>(`/api/v1/service-requests/${id}`);\n  }\n\n  // Create service request\n  async createServiceRequest(data: CreateServiceRequestRequest): Promise<ServiceRequest> {\n    return this.request<ServiceRequest>('/api/v1/service-requests', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  }\n\n  // Update service request status (admin operation)\n  async updateServiceRequestStatus(id: number, status: string, comment?: string): Promise<ServiceRequest> {\n    return this.request<ServiceRequest>(`/api/v1/service-requests/${id}/status`, {\n      method: 'PUT',\n      body: JSON.stringify({ status, comment }),\n    });\n  }\n\n  // Apply approval action on current step\n  async applyApprovalAction(id: number, payload: ServiceRequestApprovalActionRequest): Promise<ServiceRequest> {\n    return this.request<ServiceRequest>(`/api/v1/service-requests/${id}/approvals`, {\n      method: 'POST',\n      body: JSON.stringify(payload),\n    });\n  }\n\n  // Health check\n  async healthCheck(): Promise<{ status: string }> {\n    // backend exposes public health endpoint under /api/v1/health\n    return this.request<{ status: string }>('/api/v1/health');\n  }\n\n  // ==================== Provisioning Tasks ====================\n  \n  // Start provisioning for a service request\n  async startProvisioning(serviceRequestId: number): Promise<{ task: ProvisioningTask }> {\n    return this.request<{ task: ProvisioningTask }>(\n      `/api/v1/service-requests/${serviceRequestId}/provision`,\n      {\n        method: 'POST',\n      }\n    );\n  }\n\n  // List provisioning tasks for a service request\n  async listProvisioningTasks(serviceRequestId: number): Promise<ProvisioningTask[]> {\n    return this.request<ProvisioningTask[]>(\n      `/api/v1/service-requests/${serviceRequestId}/provisioning-tasks`\n    );\n  }\n\n  // Execute a provisioning task\n  async executeProvisioningTask(taskId: number): Promise<ProvisioningTask> {\n    return this.request<ProvisioningTask>(\n      `/api/v1/provisioning-tasks/${taskId}/execute`,\n      {\n        method: 'POST',\n      }\n    );\n  }\n}\n\nexport interface ProvisioningTask {\n  id: number;\n  service_request_id: number;\n  provider: string;\n  resource_type: string;\n  status: 'pending' | 'running' | 'succeeded' | 'failed';\n  payload?: Record<string, any>;\n  result?: Record<string, any>;\n  error_message?: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport const serviceRequestAPI = new ServiceRequestAPI();"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}