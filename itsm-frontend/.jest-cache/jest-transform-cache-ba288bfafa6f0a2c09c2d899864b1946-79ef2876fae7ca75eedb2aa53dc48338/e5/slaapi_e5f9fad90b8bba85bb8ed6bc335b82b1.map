{"version":3,"names":["SLAApi","cov_68wb9o8j8","f","s","default","_default","getSLADefinitions","params","_httpclient","httpClient","get","createSLADefinition","data","post","getSLADefinition","id","updateSLADefinition","put","deleteSLADefinition","delete","getSLAViolations","updateSLAViolationStatus","status","getSLAComplianceReport","checkTicketSLAViolation","ticketId","getSLAStats","getSLAMonitoring","requestBody","start_time","b","end_time","sla_definition_id","response","violationRate","total_tickets","violated_tickets","compliantTickets","atRiskTickets","Math","floor","compliance_rate","violation_rate","compliant_tickets","at_risk_tickets","average_response_time","average_resolution_time","response_time_compliance","resolution_time_compliance","alerts","getSLAMetrics","getSLAAlerts","triggerSLAMonitoring","createAlertRule","updateAlertRule","deleteAlertRule","getAlertRules"],"sources":["/Users/heidsoft/Downloads/research/itsm/itsm-frontend/src/lib/api/sla-api.ts"],"sourcesContent":["import { httpClient } from './http-client';\n\n// SLA定义接口\nexport interface SLADefinition {\n  id: number;\n  name: string;\n  description: string;\n  service_type: string;\n  priority: string;\n  response_time_minutes: number;\n  resolution_time_minutes: number;\n  availability_target: number;\n  is_active: boolean;\n  tenant_id: number;\n  created_at: string;\n  updated_at: string;\n}\n\n// SLA违规接口\nexport interface SLAViolation {\n  id: number;\n  ticket_id: number;\n  sla_def_id: number;\n  violation_type: string;\n  expected_time: string;\n  actual_time: string;\n  delay_minutes: number;\n  status: string;\n  severity: string;\n  description: string;\n  tenant_id: number;\n  created_at: string;\n  updated_at: string;\n}\n\n// SLA合规报告接口\nexport interface SLAComplianceReport {\n  total_tickets: number;\n  met_sla: number;\n  violated_sla: number;\n  compliance_rate: number;\n  avg_response_time: number;\n  avg_resolution_time: number;\n  report_period: {\n    start_date: string;\n    end_date: string;\n  };\n}\n\n// 创建SLA定义请求\nexport interface CreateSLADefinitionRequest {\n  name: string;\n  description: string;\n  service_type: string;\n  priority: string;\n  response_time_minutes: number;\n  resolution_time_minutes: number;\n  availability_target: number;\n}\n\nexport class SLAApi {\n  // 获取SLA定义列表\n  static async getSLADefinitions(params?: {\n    page?: number;\n    page_size?: number;\n  }): Promise<{\n    items: SLADefinition[];\n    total: number;\n    page: number;\n    page_size: number;\n  }> {\n    return httpClient.get('/api/sla/definitions', params);\n  }\n\n  // 创建SLA定义\n  static async createSLADefinition(data: CreateSLADefinitionRequest): Promise<SLADefinition> {\n    return httpClient.post<SLADefinition>('/api/sla/definitions', data);\n  }\n\n  // 获取SLA定义详情\n  static async getSLADefinition(id: number): Promise<SLADefinition> {\n    return httpClient.get<SLADefinition>(`/api/sla/definitions/${id}`);\n  }\n\n  // 更新SLA定义\n  static async updateSLADefinition(id: number, data: Partial<CreateSLADefinitionRequest>): Promise<SLADefinition> {\n    return httpClient.put<SLADefinition>(`/api/sla/definitions/${id}`, data);\n  }\n\n  // 删除SLA定义\n  static async deleteSLADefinition(id: number): Promise<void> {\n    return httpClient.delete(`/api/sla/definitions/${id}`);\n  }\n\n  // 获取SLA违规列表\n  static async getSLAViolations(params?: {\n    page?: number;\n    page_size?: number;\n    status?: string;\n  }): Promise<{\n    items: SLAViolation[];\n    total: number;\n    page: number;\n    page_size: number;\n  }> {\n    return httpClient.get('/api/sla/violations', params);\n  }\n\n  // 更新SLA违规状态\n  static async updateSLAViolationStatus(id: number, status: string): Promise<void> {\n    return httpClient.put(`/api/sla/violations/${id}/status`, { status });\n  }\n\n  // 获取SLA合规报告\n  static async getSLAComplianceReport(params: {\n    start_date: string;\n    end_date: string;\n  }): Promise<SLAComplianceReport> {\n    return httpClient.get('/api/sla/compliance-report', params);\n  }\n\n  // 检查工单SLA违规\n  static async checkTicketSLAViolation(ticketId: number): Promise<void> {\n    return httpClient.post(`/api/sla/check-violation/${ticketId}`);\n  }\n\n  // 获取SLA统计信息\n  static async getSLAStats(): Promise<{\n    total_definitions: number;\n    active_definitions: number;\n    total_violations: number;\n    open_violations: number;\n    overall_compliance_rate: number;\n  }> {\n    return httpClient.get('/api/sla/stats');\n  }\n\n  // 获取SLA实时监控数据\n  static async getSLAMonitoring(params?: {\n    tenant_id?: number;\n    start_time?: string;\n    end_time?: string;\n    sla_definition_id?: number;\n  }): Promise<{\n    compliance_rate: number;\n    violation_rate: number;\n    total_tickets: number;\n    compliant_tickets: number;\n    violated_tickets: number;\n    at_risk_tickets: number;\n    average_response_time: number;\n    average_resolution_time: number;\n    response_time_compliance: number;\n    resolution_time_compliance: number;\n    alerts: Array<{\n      id: string;\n      ticket_id: number;\n      ticket_number: string;\n      ticket_title: string;\n      priority: string;\n      alert_level: string;\n      time_remaining: number;\n      sla_definition: string;\n      created_at: string;\n    }>;\n  }> {\n    const requestBody: any = {};\n    if (params?.start_time) requestBody.start_time = params.start_time;\n    if (params?.end_time) requestBody.end_time = params.end_time;\n    if (params?.sla_definition_id) requestBody.sla_definition_id = params.sla_definition_id;\n    \n    const response = await httpClient.post('/api/sla/monitoring', requestBody);\n    \n    // 转换后端响应格式到前端格式\n    const violationRate = response.total_tickets > 0 \n      ? (response.violated_tickets / response.total_tickets) * 100 \n      : 0;\n    const compliantTickets = response.total_tickets - response.violated_tickets;\n    \n    // 计算风险工单（接近SLA截止时间的工单）\n    const atRiskTickets = Math.floor(response.total_tickets * 0.15); // 模拟数据\n    \n    return {\n      compliance_rate: response.compliance_rate,\n      violation_rate: violationRate,\n      total_tickets: response.total_tickets,\n      compliant_tickets: compliantTickets,\n      violated_tickets: response.violated_tickets,\n      at_risk_tickets: atRiskTickets,\n      average_response_time: response.average_response_time,\n      average_resolution_time: response.average_resolution_time,\n      response_time_compliance: 92.5, // 需要从后端计算\n      resolution_time_compliance: 88.2, // 需要从后端计算\n      alerts: [], // 需要从后端获取\n    };\n  }\n\n  // 获取SLA性能指标\n  static async getSLAMetrics(params?: {\n    period?: 'day' | 'week' | 'month' | 'quarter';\n    service_type?: string;\n    priority?: string;\n  }): Promise<{\n    response_time_avg: number;\n    resolution_time_avg: number;\n    compliance_rate: number;\n    violation_count: number;\n    trend_data: Array<{\n      date: string;\n      compliance_rate: number;\n      avg_response_time: number;\n      avg_resolution_time: number;\n    }>;\n  }> {\n    return httpClient.get('/api/sla/metrics', params);\n  }\n\n  // 获取SLA预警\n  static async getSLAAlerts(): Promise<Array<{\n    ticket_id: number;\n    ticket_title: string;\n    priority: string;\n    sla_definition: string;\n    time_remaining: number;\n    alert_level: 'warning' | 'critical';\n    created_at: string;\n  }>> {\n    return httpClient.get('/api/sla/alerts');\n  }\n\n  // 触发SLA监控检查\n  static async triggerSLAMonitoring(): Promise<{\n    checked_tickets: number;\n    violations_found: number;\n    alerts_sent: number;\n  }> {\n    return httpClient.post('/api/sla/monitor');\n  }\n\n  // 创建SLA预警规则\n  static async createAlertRule(data: {\n    name: string;\n    sla_definition_id: number;\n    alert_level: 'warning' | 'critical';\n    trigger_conditions: {\n      time_threshold_percent: number;\n      violation_types: string[];\n    };\n    notification_channels: string[];\n    is_active: boolean;\n  }): Promise<any> {\n    return httpClient.post('/api/sla/alert-rules', data);\n  }\n\n  // 更新SLA预警规则\n  static async updateAlertRule(id: number, data: Partial<{\n    name: string;\n    alert_level: 'warning' | 'critical';\n    trigger_conditions: {\n      time_threshold_percent: number;\n      violation_types: string[];\n    };\n    notification_channels: string[];\n    is_active: boolean;\n  }>): Promise<any> {\n    return httpClient.put(`/api/sla/alert-rules/${id}`, data);\n  }\n\n  // 删除SLA预警规则\n  static async deleteAlertRule(id: number): Promise<void> {\n    return httpClient.delete(`/api/sla/alert-rules/${id}`);\n  }\n\n  // 获取SLA预警规则列表\n  static async getAlertRules(params?: {\n    sla_definition_id?: number;\n    is_active?: boolean;\n    alert_level?: string;\n  }): Promise<any[]> {\n    return httpClient.get('/api/sla/alert-rules', params);\n  }\n}\n\nexport default SLAApi;"],"mappings":"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","ignoreList":[]}