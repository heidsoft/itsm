f58fc32cf614b29d07f51b4996979ed7
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    default: function() {
        return _default;
    },
    httpClient: function() {
        return httpClient;
    }
});
const _apiconfig = require("./api-config");
const _security = require("./security");
const _env = require("../../lib/env");
class HttpClient {
    constructor(baseURL = _apiconfig.API_BASE_URL){
        this.token = null;
        this.tenantId = null;
        this.tenantCode = null;
        this.baseURL = process.env.NEXT_PUBLIC_API_URL || baseURL;
        this.timeout = parseInt(process.env.NEXT_PUBLIC_API_TIMEOUT || '30000');
        // Get token and tenant ID from localStorage
        if (typeof window !== 'undefined') {
            this.token = localStorage.getItem('access_token'); // Changed to access_token
            const storedTenantId = localStorage.getItem('current_tenant_id');
            this.tenantId = storedTenantId ? parseInt(storedTenantId) : null;
            this.tenantCode = localStorage.getItem('current_tenant_code') || null;
        }
    }
    setToken(token) {
        this.token = token;
        if (typeof window !== 'undefined') {
            localStorage.setItem('access_token', token); // Changed to access_token
            // 同步更新 Cookie，有效期 15 分钟
            document.cookie = `auth-token=${token}; path=/; max-age=900; SameSite=Lax`;
        }
    }
    clearToken() {
        this.token = null;
        if (typeof window !== 'undefined') {
            localStorage.removeItem('access_token'); // Changed to access_token
            // 清除 Cookie
            document.cookie = 'auth-token=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
            document.cookie = 'refresh-token=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
        }
    }
    setTenantId(tenantId) {
        this.tenantId = tenantId;
        if (typeof window !== 'undefined') {
            if (tenantId) {
                localStorage.setItem('current_tenant_id', tenantId.toString());
            } else {
                localStorage.removeItem('current_tenant_id');
            }
        }
    }
    setTenantCode(code) {
        this.tenantCode = code;
        _env.logger.info('HttpClient.setTenantCode:', code);
        if (typeof window !== 'undefined') {
            if (code) {
                localStorage.setItem('current_tenant_code', code);
            } else {
                localStorage.removeItem('current_tenant_code');
            }
        }
    }
    // Get tenant code
    getTenantCode() {
        return this.tenantCode;
    }
    getTenantId() {
        return this.tenantId;
    }
    getHeaders() {
        // Set secure request headers
        const csrfToken = _security.security.csrf.getTokenFromMeta();
        const headers = {
            ..._security.security.network.getSecureHeaders(csrfToken || undefined)
        };
        // Dynamically get the latest token and tenantId
        const currentToken = typeof window !== 'undefined' ? localStorage.getItem('access_token') : this.token;
        const currentTenantId = typeof window !== 'undefined' ? localStorage.getItem('current_tenant_id') : this.tenantId;
        if (currentToken) {
            headers['Authorization'] = `Bearer ${currentToken}`;
        }
        if (currentTenantId) {
            headers['X-Tenant-ID'] = currentTenantId.toString();
        }
        const currentTenantCode = typeof window !== 'undefined' ? localStorage.getItem('current_tenant_code') : this.tenantCode;
        if (currentTenantCode) {
            headers['X-Tenant-Code'] = currentTenantCode;
        }
        return headers;
    }
    // Independent token refresh method to avoid circular dependencies
    async refreshTokenInternal() {
        const refreshToken = typeof window !== 'undefined' ? localStorage.getItem('refresh_token') : null;
        if (!refreshToken) {
            return false;
        }
        try {
            const response = await fetch(`${this.baseURL}/api/v1/refresh-token`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    refresh_token: refreshToken
                })
            });
            if (response.ok) {
                const data = await response.json();
                if (data.code === 0) {
                    // Update access token
                    this.setToken(data.data.access_token);
                    // Also update instance variable
                    this.token = data.data.access_token;
                    return true;
                }
            }
            return false;
        } catch (error) {
            _env.logger.error('Token refresh failed:', error);
            return false;
        }
    }
    // Request method using fetch API
    async request(endpoint, config) {
        const url = `${this.baseURL}${endpoint}`;
        const headers = this.getHeaders();
        const requestConfig = {
            method: config.method,
            headers: {
                ...headers,
                ...config.headers
            },
            body: config.body
        };
        // 仅在开发环境输出调试日志
        if (process.env.NODE_ENV === 'development' && process.env.NEXT_PUBLIC_DEBUG_API === 'true') {
            _env.logger.debug('HTTP Client Request:', {
                url,
                method: config.method,
                headers,
                body: config.body
            });
        }
        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(()=>controller.abort(), this.timeout);
            const response = await fetch(url, {
                ...requestConfig,
                signal: controller.signal
            });
            clearTimeout(timeoutId);
            // 仅在开发环境输出调试日志
            if (process.env.NODE_ENV === 'development' && process.env.NEXT_PUBLIC_DEBUG_API === 'true') {
                _env.logger.debug('HTTP Client Response:', {
                    status: response.status,
                    statusText: response.statusText,
                    headers: response.headers ? Object.fromEntries(response.headers.entries()) : {}
                });
            }
            // If 401 error, try to refresh token
            if (response.status === 401) {
                const refreshSuccess = await this.refreshTokenInternal();
                if (refreshSuccess) {
                    // Retry original request
                    const retryConfig = {
                        ...requestConfig,
                        headers: {
                            ...this.getHeaders(),
                            ...config.headers
                        }
                    };
                    const retryResponse = await fetch(url, retryConfig);
                    if (!retryResponse.ok) {
                        const rid = retryResponse.headers.get('X-Request-Id') || '';
                        const suffix = rid ? ` [RID: ${rid}]` : '';
                        throw new Error(`HTTP error! status: ${retryResponse.status}${suffix}`);
                    }
                    const retryData = await retryResponse.json();
                    _env.logger.debug('HTTP Client Retry Response Data:', retryData);
                    // Check response code
                    if (retryData.code !== 0) {
                        const rid = retryResponse.headers.get('X-Request-Id') || '';
                        const suffix = rid ? ` [RID: ${rid}]` : '';
                        throw new Error((retryData.message || 'Request failed') + suffix);
                    }
                    return retryData.data;
                } else {
                    // Refresh failed, clear token and redirect to login
                    this.clearToken();
                    if (typeof window !== 'undefined') {
                        localStorage.removeItem('refresh_token');
                        window.location.href = '/login';
                    }
                    throw new Error('Authentication failed');
                }
            }
            if (!response.ok) {
                const rid = response.headers.get('X-Request-Id') || '';
                const suffix = rid ? ` [RID: ${rid}]` : '';
                throw new Error(`HTTP error! status: ${response.status}${suffix}`);
            }
            const responseData = await response.json();
            // 仅在开发环境输出调试日志
            if (process.env.NODE_ENV === 'development' && process.env.NEXT_PUBLIC_DEBUG_API === 'true') {
                _env.logger.debug('HTTP Client Raw Response Data:', responseData);
                _env.logger.debug('HTTP Client Response Code:', responseData.code);
                _env.logger.debug('HTTP Client Response Message:', responseData.message);
                _env.logger.debug('HTTP Client Response Data Type:', typeof responseData.data);
            }
            // Check response code
            if (responseData.code !== 0) {
                const rid = response.headers && response.headers.get('X-Request-Id') || '';
                const suffix = rid ? ` [RID: ${rid}]` : '';
                const errorMessage = responseData.message || 'Request failed';
                _env.logger.error('API Error:', {
                    code: responseData.code,
                    message: errorMessage,
                    endpoint,
                    url,
                    responseData
                });
                throw new Error(errorMessage + suffix);
            }
            // 验证data字段存在
            if (responseData.data === undefined || responseData.data === null) {
                _env.logger.error('API Response data is undefined or null:', responseData);
                throw new Error('API响应数据为空');
            }
            return responseData.data;
        } catch (error) {
            _env.logger.error('Request failed:', {
                error,
                endpoint,
                url: `${this.baseURL}${endpoint}`,
                method: config.method
            });
            if (error instanceof Error) {
                if (error.name === 'AbortError') {
                    throw new Error('Request timeout, please try again later');
                }
                // 如果是网络错误，提供更友好的错误信息
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    throw new Error('无法连接到服务器，请检查网络连接或确保后端服务正在运行');
                }
                throw error;
            }
            throw new Error('Unknown error occurred');
        }
    }
    async get(endpoint, params) {
        let url = endpoint;
        if (params) {
            const searchParams = new URLSearchParams();
            Object.entries(params).forEach(([key, value])=>{
                if (value !== undefined && value !== null) {
                    searchParams.append(key, String(value));
                }
            });
            url += `?${searchParams.toString()}`;
        }
        return this.request(url, {
            method: 'GET'
        });
    }
    async post(endpoint, data) {
        return this.request(endpoint, {
            method: 'POST',
            body: data ? JSON.stringify(data) : undefined
        });
    }
    async put(endpoint, data) {
        return this.request(endpoint, {
            method: 'PUT',
            body: data ? JSON.stringify(data) : undefined
        });
    }
    async patch(endpoint, data) {
        return this.request(endpoint, {
            method: 'PATCH',
            body: data ? JSON.stringify(data) : undefined
        });
    }
    async delete(endpoint) {
        return this.request(endpoint, {
            method: 'DELETE'
        });
    }
}
const httpClient = new HttpClient();
const _default = HttpClient;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9oZWlkc29mdC9Eb3dubG9hZHMvcmVzZWFyY2gvaXRzbS9pdHNtLWZyb250ZW5kL3NyYy9hcHAvbGliL2h0dHAtY2xpZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFQSV9CQVNFX1VSTCB9IGZyb20gJy4vYXBpLWNvbmZpZyc7XG5pbXBvcnQgeyBzZWN1cml0eSB9IGZyb20gJy4vc2VjdXJpdHknO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQC9saWIvZW52JztcblxuLy8gUmVxdWVzdCBjb25maWd1cmF0aW9uIGludGVyZmFjZVxuaW50ZXJmYWNlIFJlcXVlc3RDb25maWcge1xuICBtZXRob2Q/OiAnR0VUJyB8ICdQT1NUJyB8ICdQVVQnIHwgJ0RFTEVURScgfCAnUEFUQ0gnO1xuICBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgYm9keT86IHN0cmluZztcbiAgdGltZW91dD86IG51bWJlcjtcbn1cblxuLy8gQVBJIHJlc3BvbnNlIGludGVyZmFjZVxuaW50ZXJmYWNlIEFwaVJlc3BvbnNlPFQ+IHtcbiAgY29kZTogbnVtYmVyO1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGRhdGE6IFQ7XG59XG5cbmNsYXNzIEh0dHBDbGllbnQge1xuICBwcml2YXRlIGJhc2VVUkw6IHN0cmluZztcbiAgcHJpdmF0ZSB0b2tlbjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgdGVuYW50SWQ6IG51bWJlciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHRlbmFudENvZGU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHJlYWRvbmx5IHRpbWVvdXQ6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihiYXNlVVJMOiBzdHJpbmcgPSBBUElfQkFTRV9VUkwpIHtcbiAgICB0aGlzLmJhc2VVUkwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUElfVVJMIHx8IGJhc2VVUkw7XG4gICAgdGhpcy50aW1lb3V0ID0gcGFyc2VJbnQocHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBJX1RJTUVPVVQgfHwgJzMwMDAwJyk7XG4gICAgLy8gR2V0IHRva2VuIGFuZCB0ZW5hbnQgSUQgZnJvbSBsb2NhbFN0b3JhZ2VcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMudG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWNjZXNzX3Rva2VuJyk7IC8vIENoYW5nZWQgdG8gYWNjZXNzX3Rva2VuXG4gICAgICBjb25zdCBzdG9yZWRUZW5hbnRJZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjdXJyZW50X3RlbmFudF9pZCcpO1xuICAgICAgdGhpcy50ZW5hbnRJZCA9IHN0b3JlZFRlbmFudElkID8gcGFyc2VJbnQoc3RvcmVkVGVuYW50SWQpIDogbnVsbDtcbiAgICAgIHRoaXMudGVuYW50Q29kZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjdXJyZW50X3RlbmFudF9jb2RlJykgfHwgbnVsbDtcbiAgICB9XG4gIH1cblxuICBzZXRUb2tlbih0b2tlbjogc3RyaW5nKSB7XG4gICAgdGhpcy50b2tlbiA9IHRva2VuO1xuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2FjY2Vzc190b2tlbicsIHRva2VuKTsgLy8gQ2hhbmdlZCB0byBhY2Nlc3NfdG9rZW5cbiAgICAgIC8vIOWQjOatpeabtOaWsCBDb29raWXvvIzmnInmlYjmnJ8gMTUg5YiG6ZKfXG4gICAgICBkb2N1bWVudC5jb29raWUgPSBgYXV0aC10b2tlbj0ke3Rva2VufTsgcGF0aD0vOyBtYXgtYWdlPTkwMDsgU2FtZVNpdGU9TGF4YDtcbiAgICB9XG4gIH1cblxuICBjbGVhclRva2VuKCkge1xuICAgIHRoaXMudG9rZW4gPSBudWxsO1xuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2FjY2Vzc190b2tlbicpOyAvLyBDaGFuZ2VkIHRvIGFjY2Vzc190b2tlblxuICAgICAgLy8g5riF6ZmkIENvb2tpZVxuICAgICAgZG9jdW1lbnQuY29va2llID0gJ2F1dGgtdG9rZW49OyBwYXRoPS87IGV4cGlyZXM9VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMSBHTVQ7JztcbiAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICdyZWZyZXNoLXRva2VuPTsgcGF0aD0vOyBleHBpcmVzPVRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDEgR01UOyc7XG4gICAgfVxuICB9XG5cbiAgc2V0VGVuYW50SWQodGVuYW50SWQ6IG51bWJlciB8IG51bGwpIHtcbiAgICB0aGlzLnRlbmFudElkID0gdGVuYW50SWQ7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBpZiAodGVuYW50SWQpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2N1cnJlbnRfdGVuYW50X2lkJywgdGVuYW50SWQudG9TdHJpbmcoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY3VycmVudF90ZW5hbnRfaWQnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzZXRUZW5hbnRDb2RlKGNvZGU6IHN0cmluZyB8IG51bGwpIHtcbiAgICB0aGlzLnRlbmFudENvZGUgPSBjb2RlO1xuICAgIGxvZ2dlci5pbmZvKCdIdHRwQ2xpZW50LnNldFRlbmFudENvZGU6JywgY29kZSk7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBpZiAoY29kZSkge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY3VycmVudF90ZW5hbnRfY29kZScsIGNvZGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2N1cnJlbnRfdGVuYW50X2NvZGUnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBHZXQgdGVuYW50IGNvZGVcbiAgZ2V0VGVuYW50Q29kZSgpOiBzdHJpbmcgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy50ZW5hbnRDb2RlO1xuICB9XG5cbiAgZ2V0VGVuYW50SWQoKTogbnVtYmVyIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMudGVuYW50SWQ7XG4gIH1cblxuICBwcml2YXRlIGdldEhlYWRlcnMoKTogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB7XG4gICAgLy8gU2V0IHNlY3VyZSByZXF1ZXN0IGhlYWRlcnNcbiAgICBjb25zdCBjc3JmVG9rZW4gPSBzZWN1cml0eS5jc3JmLmdldFRva2VuRnJvbU1ldGEoKTtcbiAgICBjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgLi4uc2VjdXJpdHkubmV0d29yay5nZXRTZWN1cmVIZWFkZXJzKGNzcmZUb2tlbiB8fCB1bmRlZmluZWQpLFxuICAgIH07XG5cbiAgICAvLyBEeW5hbWljYWxseSBnZXQgdGhlIGxhdGVzdCB0b2tlbiBhbmQgdGVuYW50SWRcbiAgICBjb25zdCBjdXJyZW50VG9rZW4gPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhY2Nlc3NfdG9rZW4nKSA6IHRoaXMudG9rZW47XG4gICAgY29uc3QgY3VycmVudFRlbmFudElkID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3VycmVudF90ZW5hbnRfaWQnKSA6IHRoaXMudGVuYW50SWQ7XG5cbiAgICBpZiAoY3VycmVudFRva2VuKSB7XG4gICAgICBoZWFkZXJzWydBdXRob3JpemF0aW9uJ10gPSBgQmVhcmVyICR7Y3VycmVudFRva2VufWA7XG4gICAgfVxuXG4gICAgaWYgKGN1cnJlbnRUZW5hbnRJZCkge1xuICAgICAgaGVhZGVyc1snWC1UZW5hbnQtSUQnXSA9IGN1cnJlbnRUZW5hbnRJZC50b1N0cmluZygpO1xuICAgIH1cbiAgICBjb25zdCBjdXJyZW50VGVuYW50Q29kZSA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2N1cnJlbnRfdGVuYW50X2NvZGUnKSA6IHRoaXMudGVuYW50Q29kZTtcbiAgICBpZiAoY3VycmVudFRlbmFudENvZGUpIHtcbiAgICAgIGhlYWRlcnNbJ1gtVGVuYW50LUNvZGUnXSA9IGN1cnJlbnRUZW5hbnRDb2RlO1xuICAgIH1cblxuICAgIHJldHVybiBoZWFkZXJzO1xuICB9XG5cbiAgLy8gSW5kZXBlbmRlbnQgdG9rZW4gcmVmcmVzaCBtZXRob2QgdG8gYXZvaWQgY2lyY3VsYXIgZGVwZW5kZW5jaWVzXG4gIHByaXZhdGUgYXN5bmMgcmVmcmVzaFRva2VuSW50ZXJuYWwoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcmVmcmVzaFRva2VuID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncmVmcmVzaF90b2tlbicpIDogbnVsbDtcbiAgICBpZiAoIXJlZnJlc2hUb2tlbikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuYmFzZVVSTH0vYXBpL3YxL3JlZnJlc2gtdG9rZW5gLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHJlZnJlc2hfdG9rZW46IHJlZnJlc2hUb2tlbixcbiAgICAgICAgfSksXG4gICAgICB9KTtcblxuICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIGlmIChkYXRhLmNvZGUgPT09IDApIHtcbiAgICAgICAgICAvLyBVcGRhdGUgYWNjZXNzIHRva2VuXG4gICAgICAgICAgdGhpcy5zZXRUb2tlbihkYXRhLmRhdGEuYWNjZXNzX3Rva2VuKTtcbiAgICAgICAgICAvLyBBbHNvIHVwZGF0ZSBpbnN0YW5jZSB2YXJpYWJsZVxuICAgICAgICAgIHRoaXMudG9rZW4gPSBkYXRhLmRhdGEuYWNjZXNzX3Rva2VuO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignVG9rZW4gcmVmcmVzaCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIFJlcXVlc3QgbWV0aG9kIHVzaW5nIGZldGNoIEFQSVxuICBwcml2YXRlIGFzeW5jIHJlcXVlc3Q8VD4oZW5kcG9pbnQ6IHN0cmluZywgY29uZmlnOiBSZXF1ZXN0Q29uZmlnKTogUHJvbWlzZTxUPiB7XG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVVJMfSR7ZW5kcG9pbnR9YDtcbiAgICBjb25zdCBoZWFkZXJzID0gdGhpcy5nZXRIZWFkZXJzKCk7XG4gICAgY29uc3QgcmVxdWVzdENvbmZpZzogUmVxdWVzdEluaXQgPSB7XG4gICAgICBtZXRob2Q6IGNvbmZpZy5tZXRob2QsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIC4uLmhlYWRlcnMsXG4gICAgICAgIC4uLmNvbmZpZy5oZWFkZXJzLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IGNvbmZpZy5ib2R5LFxuICAgIH07XG5cbiAgICAvLyDku4XlnKjlvIDlj5Hnjq/looPovpPlh7rosIPor5Xml6Xlv5dcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgJiYgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfREVCVUdfQVBJID09PSAndHJ1ZScpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnSFRUUCBDbGllbnQgUmVxdWVzdDonLCB7XG4gICAgICAgIHVybCxcbiAgICAgICAgbWV0aG9kOiBjb25maWcubWV0aG9kLFxuICAgICAgICBoZWFkZXJzLFxuICAgICAgICBib2R5OiBjb25maWcuYm9keVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gICAgICBjb25zdCB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IGNvbnRyb2xsZXIuYWJvcnQoKSwgdGhpcy50aW1lb3V0KTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgICAgLi4ucmVxdWVzdENvbmZpZyxcbiAgICAgICAgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbCxcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgIFxuICAgICAgLy8g5LuF5Zyo5byA5Y+R546v5aKD6L6T5Ye66LCD6K+V5pel5b+XXG4gICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgJiYgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfREVCVUdfQVBJID09PSAndHJ1ZScpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdIVFRQIENsaWVudCBSZXNwb25zZTonLCB7XG4gICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgICAgICBoZWFkZXJzOiByZXNwb25zZS5oZWFkZXJzID8gT2JqZWN0LmZyb21FbnRyaWVzKHJlc3BvbnNlLmhlYWRlcnMuZW50cmllcygpKSA6IHt9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBJZiA0MDEgZXJyb3IsIHRyeSB0byByZWZyZXNoIHRva2VuXG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgY29uc3QgcmVmcmVzaFN1Y2Nlc3MgPSBhd2FpdCB0aGlzLnJlZnJlc2hUb2tlbkludGVybmFsKCk7XG4gICAgICAgIGlmIChyZWZyZXNoU3VjY2Vzcykge1xuICAgICAgICAgIC8vIFJldHJ5IG9yaWdpbmFsIHJlcXVlc3RcbiAgICAgICAgICBjb25zdCByZXRyeUNvbmZpZzogUmVxdWVzdEluaXQgPSB7XG4gICAgICAgICAgICAuLi5yZXF1ZXN0Q29uZmlnLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAuLi50aGlzLmdldEhlYWRlcnMoKSxcbiAgICAgICAgICAgICAgLi4uY29uZmlnLmhlYWRlcnMsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH07XG4gICAgICAgICAgY29uc3QgcmV0cnlSZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgcmV0cnlDb25maWcpO1xuICAgICAgICAgIGlmICghcmV0cnlSZXNwb25zZS5vaykge1xuICAgICAgICAgICAgY29uc3QgcmlkID0gcmV0cnlSZXNwb25zZS5oZWFkZXJzLmdldCgnWC1SZXF1ZXN0LUlkJykgfHwgJyc7XG4gICAgICAgICAgICBjb25zdCBzdWZmaXggPSByaWQgPyBgIFtSSUQ6ICR7cmlkfV1gIDogJyc7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhUVFAgZXJyb3IhIHN0YXR1czogJHtyZXRyeVJlc3BvbnNlLnN0YXR1c30ke3N1ZmZpeH1gKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgcmV0cnlEYXRhID0gYXdhaXQgcmV0cnlSZXNwb25zZS5qc29uKCkgYXMgQXBpUmVzcG9uc2U8VD47XG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKCdIVFRQIENsaWVudCBSZXRyeSBSZXNwb25zZSBEYXRhOicsIHJldHJ5RGF0YSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQ2hlY2sgcmVzcG9uc2UgY29kZVxuICAgICAgICAgIGlmIChyZXRyeURhdGEuY29kZSAhPT0gMCkge1xuICAgICAgICAgICAgY29uc3QgcmlkID0gcmV0cnlSZXNwb25zZS5oZWFkZXJzLmdldCgnWC1SZXF1ZXN0LUlkJykgfHwgJyc7XG4gICAgICAgICAgICBjb25zdCBzdWZmaXggPSByaWQgPyBgIFtSSUQ6ICR7cmlkfV1gIDogJyc7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKHJldHJ5RGF0YS5tZXNzYWdlIHx8ICdSZXF1ZXN0IGZhaWxlZCcpICsgc3VmZml4KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIHJldHJ5RGF0YS5kYXRhO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFJlZnJlc2ggZmFpbGVkLCBjbGVhciB0b2tlbiBhbmQgcmVkaXJlY3QgdG8gbG9naW5cbiAgICAgICAgICB0aGlzLmNsZWFyVG9rZW4oKTtcbiAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdyZWZyZXNoX3Rva2VuJyk7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvbG9naW4nO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZCcpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgY29uc3QgcmlkID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ1gtUmVxdWVzdC1JZCcpIHx8ICcnO1xuICAgICAgICBjb25zdCBzdWZmaXggPSByaWQgPyBgIFtSSUQ6ICR7cmlkfV1gIDogJyc7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCBlcnJvciEgc3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c30ke3N1ZmZpeH1gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzcG9uc2VEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpIGFzIEFwaVJlc3BvbnNlPFQ+O1xuICAgICAgLy8g5LuF5Zyo5byA5Y+R546v5aKD6L6T5Ye66LCD6K+V5pel5b+XXG4gICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgJiYgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfREVCVUdfQVBJID09PSAndHJ1ZScpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdIVFRQIENsaWVudCBSYXcgUmVzcG9uc2UgRGF0YTonLCByZXNwb25zZURhdGEpO1xuICAgICAgICBsb2dnZXIuZGVidWcoJ0hUVFAgQ2xpZW50IFJlc3BvbnNlIENvZGU6JywgcmVzcG9uc2VEYXRhLmNvZGUpO1xuICAgICAgICBsb2dnZXIuZGVidWcoJ0hUVFAgQ2xpZW50IFJlc3BvbnNlIE1lc3NhZ2U6JywgcmVzcG9uc2VEYXRhLm1lc3NhZ2UpO1xuICAgICAgICBsb2dnZXIuZGVidWcoJ0hUVFAgQ2xpZW50IFJlc3BvbnNlIERhdGEgVHlwZTonLCB0eXBlb2YgcmVzcG9uc2VEYXRhLmRhdGEpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDaGVjayByZXNwb25zZSBjb2RlXG4gICAgICBpZiAocmVzcG9uc2VEYXRhLmNvZGUgIT09IDApIHtcbiAgICAgICAgY29uc3QgcmlkID0gKHJlc3BvbnNlLmhlYWRlcnMgJiYgcmVzcG9uc2UuaGVhZGVycy5nZXQoJ1gtUmVxdWVzdC1JZCcpKSB8fCAnJztcbiAgICAgICAgY29uc3Qgc3VmZml4ID0gcmlkID8gYCBbUklEOiAke3JpZH1dYCA6ICcnO1xuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSByZXNwb25zZURhdGEubWVzc2FnZSB8fCAnUmVxdWVzdCBmYWlsZWQnO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ0FQSSBFcnJvcjonLCB7XG4gICAgICAgICAgY29kZTogcmVzcG9uc2VEYXRhLmNvZGUsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3JNZXNzYWdlLFxuICAgICAgICAgIGVuZHBvaW50LFxuICAgICAgICAgIHVybCxcbiAgICAgICAgICByZXNwb25zZURhdGFcbiAgICAgICAgfSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UgKyBzdWZmaXgpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyDpqozor4FkYXRh5a2X5q615a2Y5ZyoXG4gICAgICBpZiAocmVzcG9uc2VEYXRhLmRhdGEgPT09IHVuZGVmaW5lZCB8fCByZXNwb25zZURhdGEuZGF0YSA9PT0gbnVsbCkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ0FQSSBSZXNwb25zZSBkYXRhIGlzIHVuZGVmaW5lZCBvciBudWxsOicsIHJlc3BvbnNlRGF0YSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQVBJ5ZON5bqU5pWw5o2u5Li656m6Jyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiByZXNwb25zZURhdGEuZGF0YTtcbiAgICB9IGNhdGNoIChlcnJvcjogdW5rbm93bikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdSZXF1ZXN0IGZhaWxlZDonLCB7XG4gICAgICAgIGVycm9yLFxuICAgICAgICBlbmRwb2ludCxcbiAgICAgICAgdXJsOiBgJHt0aGlzLmJhc2VVUkx9JHtlbmRwb2ludH1gLFxuICAgICAgICBtZXRob2Q6IGNvbmZpZy5tZXRob2RcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0Fib3J0RXJyb3InKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1ZXN0IHRpbWVvdXQsIHBsZWFzZSB0cnkgYWdhaW4gbGF0ZXInKTtcbiAgICAgICAgfVxuICAgICAgICAvLyDlpoLmnpzmmK/nvZHnu5zplJnor6/vvIzmj5Dkvpvmm7Tlj4vlpb3nmoTplJnor6/kv6Hmga9cbiAgICAgICAgaWYgKGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ0ZhaWxlZCB0byBmZXRjaCcpIHx8IGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ05ldHdvcmtFcnJvcicpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfml6Dms5Xov57mjqXliLDmnI3liqHlmajvvIzor7fmo4Dmn6XnvZHnu5zov57mjqXmiJbnoa7kv53lkI7nq6/mnI3liqHmraPlnKjov5DooYwnKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBlcnJvciBvY2N1cnJlZCcpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldDxUPihlbmRwb2ludDogc3RyaW5nLCBwYXJhbXM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik6IFByb21pc2U8VD4ge1xuICAgIGxldCB1cmwgPSBlbmRwb2ludDtcbiAgICBpZiAocGFyYW1zKSB7XG4gICAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgICBPYmplY3QuZW50cmllcyhwYXJhbXMpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgIHNlYXJjaFBhcmFtcy5hcHBlbmQoa2V5LCBTdHJpbmcodmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB1cmwgKz0gYD8ke3NlYXJjaFBhcmFtcy50b1N0cmluZygpfWA7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8VD4odXJsLCB7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgcG9zdDxUPihlbmRwb2ludDogc3RyaW5nLCBkYXRhPzogdW5rbm93bik6IFByb21pc2U8VD4ge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8VD4oZW5kcG9pbnQsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgYm9keTogZGF0YSA/IEpTT04uc3RyaW5naWZ5KGRhdGEpIDogdW5kZWZpbmVkLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgcHV0PFQ+KGVuZHBvaW50OiBzdHJpbmcsIGRhdGE/OiB1bmtub3duKTogUHJvbWlzZTxUPiB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxUPihlbmRwb2ludCwge1xuICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgIGJvZHk6IGRhdGEgPyBKU09OLnN0cmluZ2lmeShkYXRhKSA6IHVuZGVmaW5lZCxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHBhdGNoPFQ+KGVuZHBvaW50OiBzdHJpbmcsIGRhdGE/OiB1bmtub3duKTogUHJvbWlzZTxUPiB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxUPihlbmRwb2ludCwge1xuICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgYm9keTogZGF0YSA/IEpTT04uc3RyaW5naWZ5KGRhdGEpIDogdW5kZWZpbmVkLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlPFQ+KGVuZHBvaW50OiBzdHJpbmcpOiBQcm9taXNlPFQ+IHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PFQ+KGVuZHBvaW50LCB7XG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBodHRwQ2xpZW50ID0gbmV3IEh0dHBDbGllbnQoKTtcbmV4cG9ydCBkZWZhdWx0IEh0dHBDbGllbnQ7XG4iXSwibmFtZXMiOlsiaHR0cENsaWVudCIsIkh0dHBDbGllbnQiLCJjb25zdHJ1Y3RvciIsImJhc2VVUkwiLCJBUElfQkFTRV9VUkwiLCJ0b2tlbiIsInRlbmFudElkIiwidGVuYW50Q29kZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19BUElfVVJMIiwidGltZW91dCIsInBhcnNlSW50IiwiTkVYVF9QVUJMSUNfQVBJX1RJTUVPVVQiLCJ3aW5kb3ciLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic3RvcmVkVGVuYW50SWQiLCJzZXRUb2tlbiIsInNldEl0ZW0iLCJkb2N1bWVudCIsImNvb2tpZSIsImNsZWFyVG9rZW4iLCJyZW1vdmVJdGVtIiwic2V0VGVuYW50SWQiLCJ0b1N0cmluZyIsInNldFRlbmFudENvZGUiLCJjb2RlIiwibG9nZ2VyIiwiaW5mbyIsImdldFRlbmFudENvZGUiLCJnZXRUZW5hbnRJZCIsImdldEhlYWRlcnMiLCJjc3JmVG9rZW4iLCJzZWN1cml0eSIsImNzcmYiLCJnZXRUb2tlbkZyb21NZXRhIiwiaGVhZGVycyIsIm5ldHdvcmsiLCJnZXRTZWN1cmVIZWFkZXJzIiwidW5kZWZpbmVkIiwiY3VycmVudFRva2VuIiwiY3VycmVudFRlbmFudElkIiwiY3VycmVudFRlbmFudENvZGUiLCJyZWZyZXNoVG9rZW5JbnRlcm5hbCIsInJlZnJlc2hUb2tlbiIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInJlZnJlc2hfdG9rZW4iLCJvayIsImRhdGEiLCJqc29uIiwiYWNjZXNzX3Rva2VuIiwiZXJyb3IiLCJyZXF1ZXN0IiwiZW5kcG9pbnQiLCJjb25maWciLCJ1cmwiLCJyZXF1ZXN0Q29uZmlnIiwiTk9ERV9FTlYiLCJORVhUX1BVQkxJQ19ERUJVR19BUEkiLCJkZWJ1ZyIsImNvbnRyb2xsZXIiLCJBYm9ydENvbnRyb2xsZXIiLCJ0aW1lb3V0SWQiLCJzZXRUaW1lb3V0IiwiYWJvcnQiLCJzaWduYWwiLCJjbGVhclRpbWVvdXQiLCJzdGF0dXMiLCJzdGF0dXNUZXh0IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJlbnRyaWVzIiwicmVmcmVzaFN1Y2Nlc3MiLCJyZXRyeUNvbmZpZyIsInJldHJ5UmVzcG9uc2UiLCJyaWQiLCJnZXQiLCJzdWZmaXgiLCJFcnJvciIsInJldHJ5RGF0YSIsIm1lc3NhZ2UiLCJsb2NhdGlvbiIsImhyZWYiLCJyZXNwb25zZURhdGEiLCJlcnJvck1lc3NhZ2UiLCJuYW1lIiwiaW5jbHVkZXMiLCJwYXJhbXMiLCJzZWFyY2hQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJmb3JFYWNoIiwia2V5IiwidmFsdWUiLCJhcHBlbmQiLCJTdHJpbmciLCJwb3N0IiwicHV0IiwicGF0Y2giLCJkZWxldGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0lBa1ZBLE9BQTBCO2VBQTFCOztJQURhQSxVQUFVO2VBQVZBOzs7MkJBalZnQjswQkFDSjtxQkFDRjtBQWlCdkIsTUFBTUM7SUFPSkMsWUFBWUMsVUFBa0JDLHVCQUFZLENBQUU7YUFMcENDLFFBQXVCO2FBQ3ZCQyxXQUEwQjthQUMxQkMsYUFBNEI7UUFJbEMsSUFBSSxDQUFDSixPQUFPLEdBQUdLLFFBQVFDLEdBQUcsQ0FBQ0MsbUJBQW1CLElBQUlQO1FBQ2xELElBQUksQ0FBQ1EsT0FBTyxHQUFHQyxTQUFTSixRQUFRQyxHQUFHLENBQUNJLHVCQUF1QixJQUFJO1FBQy9ELDRDQUE0QztRQUM1QyxJQUFJLE9BQU9DLFdBQVcsYUFBYTtZQUNqQyxJQUFJLENBQUNULEtBQUssR0FBR1UsYUFBYUMsT0FBTyxDQUFDLGlCQUFpQiwwQkFBMEI7WUFDN0UsTUFBTUMsaUJBQWlCRixhQUFhQyxPQUFPLENBQUM7WUFDNUMsSUFBSSxDQUFDVixRQUFRLEdBQUdXLGlCQUFpQkwsU0FBU0ssa0JBQWtCO1lBQzVELElBQUksQ0FBQ1YsVUFBVSxHQUFHUSxhQUFhQyxPQUFPLENBQUMsMEJBQTBCO1FBQ25FO0lBQ0Y7SUFFQUUsU0FBU2IsS0FBYSxFQUFFO1FBQ3RCLElBQUksQ0FBQ0EsS0FBSyxHQUFHQTtRQUNiLElBQUksT0FBT1MsV0FBVyxhQUFhO1lBQ2pDQyxhQUFhSSxPQUFPLENBQUMsZ0JBQWdCZCxRQUFRLDBCQUEwQjtZQUN2RSx3QkFBd0I7WUFDeEJlLFNBQVNDLE1BQU0sR0FBRyxDQUFDLFdBQVcsRUFBRWhCLE1BQU0sbUNB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