{"version":3,"names":["AuthService","cov_2ar5xlfi8f","f","s","default","_default","setTokens","accessToken","refreshToken","window","b","localStorage","setItem","getAccessToken","getItem","getRefreshToken","isAuthenticated","_store","useAuthStore","getState","console","log","token","startsWith","parts","split","length","payload","JSON","parse","atob","currentTime","Math","floor","Date","now","exp","clearTokens","error","makeRequest","endpoint","options","url","_apiconfig","API_BASE_URL","method","body","response","fetch","headers","status","ok","Error","responseData","json","code","message","data","stringify","refresh_token","access_token","removeItem","logout","login","username","password","tenantCode","tenant_code","u","user","id","Number","String","role","email","name","full_name","type","created_at","toISOString","updated_at"],"sources":["/Users/heidsoft/Downloads/research/itsm/itsm-frontend/src/app/lib/auth-service.ts"],"sourcesContent":["import { API_BASE_URL, Tenant } from './api-config';\nimport { useAuthStore } from './store';\n\nexport class AuthService {\n  // 设置tokens\n  static setTokens(accessToken: string, refreshToken: string) {\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('access_token', accessToken);\n      localStorage.setItem('refresh_token', refreshToken);\n    }\n  }\n\n  // 获取access token\n  static getAccessToken(): string | null {\n    if (typeof window !== 'undefined') {\n      return localStorage.getItem('access_token');\n    }\n    return null;\n  }\n\n  // 获取refresh token\n  static getRefreshToken(): string | null {\n    if (typeof window !== 'undefined') {\n      return localStorage.getItem('refresh_token');\n    }\n    return null;\n  }\n\n  // 检查是否已认证\n  static isAuthenticated(): boolean {\n    // 首先检查Zustand store的状态\n    const { isAuthenticated } = useAuthStore.getState();\n    console.log('AuthService.isAuthenticated - Zustand状态:', { isAuthenticated });\n    if (isAuthenticated) {\n      return true;\n    }\n\n    // 然后检查localStorage中的token\n    const token = this.getAccessToken();\n    console.log('AuthService.isAuthenticated - Token:', token);\n    if (!token) {\n      return false;\n    }\n\n    // 对于开发环境，允许mock token\n    if (token.startsWith('mock_')) {\n      console.log('AuthService.isAuthenticated - Mock token detected');\n      return true;\n    }\n\n    try {\n      // 简单检查token格式（JWT应该有3个部分）\n      const parts = token.split('.');\n      if (parts.length !== 3) {\n        return false;\n      }\n\n      // 检查token是否过期\n      const payload = JSON.parse(atob(parts[1]));\n      const currentTime = Math.floor(Date.now() / 1000);\n      \n      if (payload.exp && payload.exp < currentTime) {\n        // Token已过期，清除它\n        this.clearTokens();\n        return false;\n      }\n\n      return true;\n    } catch (error) {\n      // Token格式无效\n      console.error('Invalid token format:', error);\n      this.clearTokens();\n      return false;\n    }\n  }\n\n  // 直接使用fetch进行HTTP请求，避免循环依赖\n  private static async makeRequest<T>(endpoint: string, options: RequestInit): Promise<T> {\n    const url = `${API_BASE_URL}${endpoint}`;\n    console.log('makeRequest called with:', { url, method: options.method, body: options.body });\n    \n    const response = await fetch(url, {\n      headers: {\n        'Content-Type': 'application/json',\n        ...options.headers,\n      },\n      ...options,\n    });\n\n    console.log('makeRequest response status:', response.status);\n    console.log('makeRequest response headers:', response.headers);\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    const responseData = await response.json() as { code: number; message: string; data: T };\n    console.log('makeRequest response data:', responseData);\n    \n    // 检查响应码\n    if (responseData.code !== 0) {\n      throw new Error(responseData.message || '请求失败');\n    }\n    \n    return responseData.data;\n  }\n\n  // 刷新token\n  static async refreshToken(): Promise<boolean> {\n    const refreshToken = this.getRefreshToken();\n    if (!refreshToken) {\n      return false;\n    }\n\n    try {\n      const data = await this.makeRequest<{\n        access_token: string;\n      }>('/api/v1/refresh-token', {\n        method: 'POST',\n        body: JSON.stringify({\n          refresh_token: refreshToken,\n        }),\n      });\n\n      // 更新access token\n      if (typeof window !== 'undefined') {\n        localStorage.setItem('access_token', data.access_token);\n      }\n      return true;\n    } catch (error) {\n      console.error('Token refresh failed:', error);\n      this.clearTokens();\n      return false;\n    }\n  }\n\n  // 清除所有tokens\n  static clearTokens() {\n    if (typeof window !== 'undefined') {\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('refresh_token');\n    }\n  }\n\n  // 登出方法\n  static logout() {\n    this.clearTokens();\n    const { logout } = useAuthStore.getState();\n    logout();\n  }\n\n  // 修改login方法\n  static async login(username: string, password: string, tenantCode?: string): Promise<boolean> {\n    try {\n      console.log('AuthService.login called with:', { username, password: '***', tenantCode });\n      \n      const data = await this.makeRequest<{\n        access_token: string;\n        refresh_token: string;\n        user: unknown;\n      }>('/api/v1/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          username,\n          password,\n          tenant_code: tenantCode,\n        }),\n      });\n      \n      console.log('AuthService.login response data:', data);\n      \n      // 存储tokens\n      this.setTokens(data.access_token, data.refresh_token);\n      \n      // 使用store管理登录状态\n      const { login } = useAuthStore.getState();\n      console.log('AuthService.login - 调用Zustand login方法');\n      const u = data.user as any;\n      login(\n        {\n          id: Number(u?.id || 0),\n          username: String(u?.username || username),\n          role: String(u?.role || 'end_user'),\n          email: String(u?.email || ''),\n          name: String(u?.name || u?.full_name || ''),\n        },\n        data.access_token,\n        {\n          id: 1,\n          name: '默认租户',\n          code: 'default',\n          type: 'trial',\n          status: 'active',\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString(),\n        } as Tenant\n      );\n      \n      // 验证状态是否正确设置\n      const { isAuthenticated } = useAuthStore.getState();\n      console.log('AuthService.login - 登录后Zustand状态:', { isAuthenticated });\n      \n      console.log('AuthService.login completed successfully');\n      return true;\n    } catch (error) {\n      console.error('Login failed:', error);\n      return false;\n    }\n  }\n}\n\nexport default AuthService;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAGaA,WAAW,WAAAA,CAAA;IAAA;IAAAC,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;WAAXH,WAAA;;EAgNbI,OAA2B,WAAAA,CAAA;IAAA;IAAAH,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;WAA3BE,QAAA;;;;;kCAnNqC;;;kCACR;AAEtB,MAAML,WAAA;EACX;EACA,OAAOM,UAAUC,WAAmB,EAAEC,YAAoB,EAAE;IAAA;IAAAP,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;IAC1D,IAAI,OAAOM,MAAA,KAAW,aAAa;MAAA;MAAAR,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAE,CAAA;MACjCQ,YAAA,CAAaC,OAAO,CAAC,gBAAgBL,WAAA;MAAA;MAAAN,cAAA,GAAAE,CAAA;MACrCQ,YAAA,CAAaC,OAAO,CAAC,iBAAiBJ,YAAA;IACxC;IAAA;IAAA;MAAAP,cAAA,GAAAS,CAAA;IAAA;EACF;EAEA;EACA,OAAOG,eAAA,EAAgC;IAAA;IAAAZ,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;IACrC,IAAI,OAAOM,MAAA,KAAW,aAAa;MAAA;MAAAR,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAE,CAAA;MACjC,OAAOQ,YAAA,CAAaG,OAAO,CAAC;IAC9B;IAAA;IAAA;MAAAb,cAAA,GAAAS,CAAA;IAAA;IAAAT,cAAA,GAAAE,CAAA;IACA,OAAO;EACT;EAEA;EACA,OAAOY,gBAAA,EAAiC;IAAA;IAAAd,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;IACtC,IAAI,OAAOM,MAAA,KAAW,aAAa;MAAA;MAAAR,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAE,CAAA;MACjC,OAAOQ,YAAA,CAAaG,OAAO,CAAC;IAC9B;IAAA;IAAA;MAAAb,cAAA,GAAAS,CAAA;IAAA;IAAAT,cAAA,GAAAE,CAAA;IACA,OAAO;EACT;EAEA;EACA,OAAOa,gBAAA,EAA2B;IAAA;IAAAf,cAAA,GAAAC,CAAA;IAChC;IACA,MAAM;MAAEc;IAAe,CAAE;IAAA;IAAA,CAAAf,cAAA,GAAAE,CAAA,QAAGc,MAAA,CAAAC,YAAY,CAACC,QAAQ;IAAA;IAAAlB,cAAA,GAAAE,CAAA;IACjDiB,OAAA,CAAQC,GAAG,CAAC,4CAA4C;MAAEL;IAAgB;IAAA;IAAAf,cAAA,GAAAE,CAAA;IAC1E,IAAIa,eAAA,EAAiB;MAAA;MAAAf,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAE,CAAA;MACnB,OAAO;IACT;IAAA;IAAA;MAAAF,cAAA,GAAAS,CAAA;IAAA;IAEA;IACA,MAAMY,KAAA;IAAA;IAAA,CAAArB,cAAA,GAAAE,CAAA,QAAQ,IAAI,CAACU,cAAc;IAAA;IAAAZ,cAAA,GAAAE,CAAA;IACjCiB,OAAA,CAAQC,GAAG,CAAC,wCAAwCC,KAAA;IAAA;IAAArB,cAAA,GAAAE,CAAA;IACpD,IAAI,CAACmB,KAAA,EAAO;MAAA;MAAArB,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAE,CAAA;MACV,OAAO;IACT;IAAA;IAAA;MAAAF,cAAA,GAAAS,CAAA;IAAA;IAEA;IAAAT,cAAA,GAAAE,CAAA;IACA,IAAImB,KAAA,CAAMC,UAAU,CAAC,UAAU;MAAA;MAAAtB,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAE,CAAA;MAC7BiB,OAAA,CAAQC,GAAG,CAAC;MAAA;MAAApB,cAAA,GAAAE,CAAA;MACZ,OAAO;IACT;IAAA;IAAA;MAAAF,cAAA,GAAAS,CAAA;IAAA;IAAAT,cAAA,GAAAE,CAAA;IAEA,IAAI;MACF;MACA,MAAMqB,KAAA;MAAA;MAAA,CAAAvB,cAAA,GAAAE,CAAA,QAAQmB,KAAA,CAAMG,KAAK,CAAC;MAAA;MAAAxB,cAAA,GAAAE,CAAA;MAC1B,IAAIqB,KAAA,CAAME,MAAM,KAAK,GAAG;QAAA;QAAAzB,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QACtB,OAAO;MACT;MAAA;MAAA;QAAAF,cAAA,GAAAS,CAAA;MAAA;MAEA;MACA,MAAMiB,OAAA;MAAA;MAAA,CAAA1B,cAAA,GAAAE,CAAA,QAAUyB,IAAA,CAAKC,KAAK,CAACC,IAAA,CAAKN,KAAK,CAAC,EAAE;MACxC,MAAMO,WAAA;MAAA;MAAA,CAAA9B,cAAA,GAAAE,CAAA,QAAc6B,IAAA,CAAKC,KAAK,CAACC,IAAA,CAAKC,GAAG,KAAK;MAAA;MAAAlC,cAAA,GAAAE,CAAA;MAE5C;MAAI;MAAA,CAAAF,cAAA,GAAAS,CAAA,UAAAiB,OAAA,CAAQS,GAAG;MAAA;MAAA,CAAAnC,cAAA,GAAAS,CAAA,UAAIiB,OAAA,CAAQS,GAAG,GAAGL,WAAA,GAAa;QAAA;QAAA9B,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QAC5C;QACA,IAAI,CAACkC,WAAW;QAAA;QAAApC,cAAA,GAAAE,CAAA;QAChB,OAAO;MACT;MAAA;MAAA;QAAAF,cAAA,GAAAS,CAAA;MAAA;MAAAT,cAAA,GAAAE,CAAA;MAEA,OAAO;IACT,EAAE,OAAOmC,KAAA,EAAO;MAAA;MAAArC,cAAA,GAAAE,CAAA;MACd;MACAiB,OAAA,CAAQkB,KAAK,CAAC,yBAAyBA,KAAA;MAAA;MAAArC,cAAA,GAAAE,CAAA;MACvC,IAAI,CAACkC,WAAW;MAAA;MAAApC,cAAA,GAAAE,CAAA;MAChB,OAAO;IACT;EACF;EAEA;EACA,aAAqBoC,YAAeC,QAAgB,EAAEC,OAAoB,EAAc;IAAA;IAAAxC,cAAA,GAAAC,CAAA;IACtF,MAAMwC,GAAA;IAAA;IAAA,CAAAzC,cAAA,GAAAE,CAAA,QAAM,GAAGwC,UAAA,CAAAC,YAAY,GAAGJ,QAAA,EAAU;IAAA;IAAAvC,cAAA,GAAAE,CAAA;IACxCiB,OAAA,CAAQC,GAAG,CAAC,4BAA4B;MAAEqB,GAAA;MAAKG,MAAA,EAAQJ,OAAA,CAAQI,MAAM;MAAEC,IAAA,EAAML,OAAA,CAAQK;IAAK;IAE1F,MAAMC,QAAA;IAAA;IAAA,CAAA9C,cAAA,GAAAE,CAAA,QAAW,MAAM6C,KAAA,CAAMN,GAAA,EAAK;MAChCO,OAAA,EAAS;QACP,gBAAgB;QAChB,GAAGR,OAAA,CAAQQ;MACb;MACA,GAAGR;IACL;IAAA;IAAAxC,cAAA,GAAAE,CAAA;IAEAiB,OAAA,CAAQC,GAAG,CAAC,gCAAgC0B,QAAA,CAASG,MAAM;IAAA;IAAAjD,cAAA,GAAAE,CAAA;IAC3DiB,OAAA,CAAQC,GAAG,CAAC,iCAAiC0B,QAAA,CAASE,OAAO;IAAA;IAAAhD,cAAA,GAAAE,CAAA;IAE7D,IAAI,CAAC4C,QAAA,CAASI,EAAE,EAAE;MAAA;MAAAlD,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAE,CAAA;MAChB,MAAM,IAAIiD,KAAA,CAAM,uBAAuBL,QAAA,CAASG,MAAM,EAAE;IAC1D;IAAA;IAAA;MAAAjD,cAAA,GAAAS,CAAA;IAAA;IAEA,MAAM2C,YAAA;IAAA;IAAA,CAAApD,cAAA,GAAAE,CAAA,QAAe,MAAM4C,QAAA,CAASO,IAAI;IAAA;IAAArD,cAAA,GAAAE,CAAA;IACxCiB,OAAA,CAAQC,GAAG,CAAC,8BAA8BgC,YAAA;IAE1C;IAAA;IAAApD,cAAA,GAAAE,CAAA;IACA,IAAIkD,YAAA,CAAaE,IAAI,KAAK,GAAG;MAAA;MAAAtD,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAE,CAAA;MAC3B,MAAM,IAAIiD,KAAA;MAAM;MAAA,CAAAnD,cAAA,GAAAS,CAAA,WAAA2C,YAAA,CAAaG,OAAO;MAAA;MAAA,CAAAvD,cAAA,GAAAS,CAAA,WAAI;IAC1C;IAAA;IAAA;MAAAT,cAAA,GAAAS,CAAA;IAAA;IAAAT,cAAA,GAAAE,CAAA;IAEA,OAAOkD,YAAA,CAAaI,IAAI;EAC1B;EAEA;EACA,aAAajD,aAAA,EAAiC;IAAA;IAAAP,cAAA,GAAAC,CAAA;IAC5C,MAAMM,YAAA;IAAA;IAAA,CAAAP,cAAA,GAAAE,CAAA,QAAe,IAAI,CAACY,eAAe;IAAA;IAAAd,cAAA,GAAAE,CAAA;IACzC,IAAI,CAACK,YAAA,EAAc;MAAA;MAAAP,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAE,CAAA;MACjB,OAAO;IACT;IAAA;IAAA;MAAAF,cAAA,GAAAS,CAAA;IAAA;IAAAT,cAAA,GAAAE,CAAA;IAEA,IAAI;MACF,MAAMsD,IAAA;MAAA;MAAA,CAAAxD,cAAA,GAAAE,CAAA,QAAO,MAAM,IAAI,CAACoC,WAAW,CAEhC,yBAAyB;QAC1BM,MAAA,EAAQ;QACRC,IAAA,EAAMlB,IAAA,CAAK8B,SAAS,CAAC;UACnBC,aAAA,EAAenD;QACjB;MACF;MAEA;MAAA;MAAAP,cAAA,GAAAE,CAAA;MACA,IAAI,OAAOM,MAAA,KAAW,aAAa;QAAA;QAAAR,cAAA,GAAAS,CAAA;QAAAT,cAAA,GAAAE,CAAA;QACjCQ,YAAA,CAAaC,OAAO,CAAC,gBAAgB6C,IAAA,CAAKG,YAAY;MACxD;MAAA;MAAA;QAAA3D,cAAA,GAAAS,CAAA;MAAA;MAAAT,cAAA,GAAAE,CAAA;MACA,OAAO;IACT,EAAE,OAAOmC,KAAA,EAAO;MAAA;MAAArC,cAAA,GAAAE,CAAA;MACdiB,OAAA,CAAQkB,KAAK,CAAC,yBAAyBA,KAAA;MAAA;MAAArC,cAAA,GAAAE,CAAA;MACvC,IAAI,CAACkC,WAAW;MAAA;MAAApC,cAAA,GAAAE,CAAA;MAChB,OAAO;IACT;EACF;EAEA;EACA,OAAOkC,YAAA,EAAc;IAAA;IAAApC,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;IACnB,IAAI,OAAOM,MAAA,KAAW,aAAa;MAAA;MAAAR,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAE,CAAA;MACjCQ,YAAA,CAAakD,UAAU,CAAC;MAAA;MAAA5D,cAAA,GAAAE,CAAA;MACxBQ,YAAA,CAAakD,UAAU,CAAC;IAC1B;IAAA;IAAA;MAAA5D,cAAA,GAAAS,CAAA;IAAA;EACF;EAEA;EACA,OAAOoD,OAAA,EAAS;IAAA;IAAA7D,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;IACd,IAAI,CAACkC,WAAW;IAChB,MAAM;MAAEyB;IAAM,CAAE;IAAA;IAAA,CAAA7D,cAAA,GAAAE,CAAA,QAAGc,MAAA,CAAAC,YAAY,CAACC,QAAQ;IAAA;IAAAlB,cAAA,GAAAE,CAAA;IACxC2D,MAAA;EACF;EAEA;EACA,aAAaC,MAAMC,QAAgB,EAAEC,QAAgB,EAAEC,UAAmB,EAAoB;IAAA;IAAAjE,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;IAC5F,IAAI;MAAA;MAAAF,cAAA,GAAAE,CAAA;MACFiB,OAAA,CAAQC,GAAG,CAAC,kCAAkC;QAAE2C,QAAA;QAAUC,QAAA,EAAU;QAAOC;MAAW;MAEtF,MAAMT,IAAA;MAAA;MAAA,CAAAxD,cAAA,GAAAE,CAAA,QAAO,MAAM,IAAI,CAACoC,WAAW,CAIhC,sBAAsB;QACvBM,MAAA,EAAQ;QACRC,IAAA,EAAMlB,IAAA,CAAK8B,SAAS,CAAC;UACnBM,QAAA;UACAC,QAAA;UACAE,WAAA,EAAaD;QACf;MACF;MAAA;MAAAjE,cAAA,GAAAE,CAAA;MAEAiB,OAAA,CAAQC,GAAG,CAAC,oCAAoCoC,IAAA;MAEhD;MAAA;MAAAxD,cAAA,GAAAE,CAAA;MACA,IAAI,CAACG,SAAS,CAACmD,IAAA,CAAKG,YAAY,EAAEH,IAAA,CAAKE,aAAa;MAEpD;MACA,MAAM;QAAEI;MAAK,CAAE;MAAA;MAAA,CAAA9D,cAAA,GAAAE,CAAA,QAAGc,MAAA,CAAAC,YAAY,CAACC,QAAQ;MAAA;MAAAlB,cAAA,GAAAE,CAAA;MACvCiB,OAAA,CAAQC,GAAG,CAAC;MACZ,MAAM+C,CAAA;MAAA;MAAA,CAAAnE,cAAA,GAAAE,CAAA,QAAIsD,IAAA,CAAKY,IAAI;MAAA;MAAApE,cAAA,GAAAE,CAAA;MACnB4D,KAAA,CACE;QACEO,EAAA,EAAIC,MAAA;QAAO;QAAA,CAAAtE,cAAA,GAAAS,CAAA,WAAA0D,CAAA,EAAGE,EAAA;QAAA;QAAA,CAAArE,cAAA,GAAAS,CAAA,WAAM;QACpBsD,QAAA,EAAUQ,MAAA;QAAO;QAAA,CAAAvE,cAAA,GAAAS,CAAA,WAAA0D,CAAA,EAAGJ,QAAA;QAAA;QAAA,CAAA/D,cAAA,GAAAS,CAAA,WAAYsD,QAAA;QAChCS,IAAA,EAAMD,MAAA;QAAO;QAAA,CAAAvE,cAAA,GAAAS,CAAA,WAAA0D,CAAA,EAAGK,IAAA;QAAA;QAAA,CAAAxE,cAAA,GAAAS,CAAA,WAAQ;QACxBgE,KAAA,EAAOF,MAAA;QAAO;QAAA,CAAAvE,cAAA,GAAAS,CAAA,WAAA0D,CAAA,EAAGM,KAAA;QAAA;QAAA,CAAAzE,cAAA,GAAAS,CAAA,WAAS;QAC1BiE,IAAA,EAAMH,MAAA;QAAO;QAAA,CAAAvE,cAAA,GAAAS,CAAA,WAAA0D,CAAA,EAAGO,IAAA;QAAA;QAAA,CAAA1E,cAAA,GAAAS,CAAA,WAAQ0D,CAAA,EAAGQ,SAAA;QAAA;QAAA,CAAA3E,cAAA,GAAAS,CAAA,WAAa;MAC1C,GACA+C,IAAA,CAAKG,YAAY,EACjB;QACEU,EAAA,EAAI;QACJK,IAAA,EAAM;QACNpB,IAAA,EAAM;QACNsB,IAAA,EAAM;QACN3B,MAAA,EAAQ;QACR4B,UAAA,EAAY,IAAI5C,IAAA,GAAO6C,WAAW;QAClCC,UAAA,EAAY,IAAI9C,IAAA,GAAO6C,WAAW;MACpC;MAGF;MACA,MAAM;QAAE/D;MAAe,CAAE;MAAA;MAAA,CAAAf,cAAA,GAAAE,CAAA,QAAGc,MAAA,CAAAC,YAAY,CAACC,QAAQ;MAAA;MAAAlB,cAAA,GAAAE,CAAA;MACjDiB,OAAA,CAAQC,GAAG,CAAC,qCAAqC;QAAEL;MAAgB;MAAA;MAAAf,cAAA,GAAAE,CAAA;MAEnEiB,OAAA,CAAQC,GAAG,CAAC;MAAA;MAAApB,cAAA,GAAAE,CAAA;MACZ,OAAO;IACT,EAAE,OAAOmC,KAAA,EAAO;MAAA;MAAArC,cAAA,GAAAE,CAAA;MACdiB,OAAA,CAAQkB,KAAK,CAAC,iBAAiBA,KAAA;MAAA;MAAArC,cAAA,GAAAE,CAAA;MAC/B,OAAO;IACT;EACF;AACF;MAEAE,QAAA;AAAA;AAAA,CAAAJ,cAAA,GAAAE,CAAA,QAAeH,WAAA","ignoreList":[]}