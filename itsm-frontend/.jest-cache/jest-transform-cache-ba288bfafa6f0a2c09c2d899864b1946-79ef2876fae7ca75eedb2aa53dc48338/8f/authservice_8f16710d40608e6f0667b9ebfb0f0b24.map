{"version":3,"names":["AuthService","cov_1z9254cxgf","f","s","default","_default","setTokens","accessToken","refreshToken","window","b","localStorage","setItem","getAccessToken","getItem","getToken","getCurrentUser","user","_authstore","useAuthStore","getState","getRefreshToken","isAuthenticated","console","log","token","startsWith","parts","split","length","payload","JSON","parse","atob","currentTime","Math","floor","Date","now","exp","clearTokens","error","makeRequest","endpoint","options","url","_apiconfig","API_BASE_URL","method","body","response","fetch","headers","status","ok","Error","responseData","json","code","message","data","stringify","refresh_token","access_token","removeItem","logout","login","username","password","tenantCode","tenant_code","u","id","Number","String","role","email","name","full_name"],"sources":["/Users/heidsoft/Downloads/research/itsm/itsm-frontend/src/lib/services/auth-service.ts"],"sourcesContent":["import { API_BASE_URL, Tenant } from '@/app/lib/api-config';\nimport { useAuthStore } from '@/lib/store/auth-store';\n\nexport class AuthService {\n  // 设置tokens\n  static setTokens(accessToken: string, refreshToken: string) {\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('access_token', accessToken);\n      localStorage.setItem('refresh_token', refreshToken);\n    }\n  }\n\n  // 获取access token\n  static getAccessToken(): string | null {\n    if (typeof window !== 'undefined') {\n      return localStorage.getItem('access_token');\n    }\n    return null;\n  }\n\n  // Backward-compatible helpers used by some UI providers\n  static getToken(): string | null {\n    return this.getAccessToken();\n  }\n\n  static getCurrentUser() {\n    const { user } = useAuthStore.getState();\n    return user;\n  }\n\n  // 获取refresh token\n  static getRefreshToken(): string | null {\n    if (typeof window !== 'undefined') {\n      return localStorage.getItem('refresh_token');\n    }\n    return null;\n  }\n\n  // 检查是否已认证\n  static isAuthenticated(): boolean {\n    // 首先检查Zustand store的状态\n    const { isAuthenticated } = useAuthStore.getState();\n    console.log('AuthService.isAuthenticated - Zustand状态:', { isAuthenticated });\n    if (isAuthenticated) {\n      return true;\n    }\n\n    // 然后检查localStorage中的token\n    const token = this.getAccessToken();\n    console.log('AuthService.isAuthenticated - Token:', token);\n    if (!token) {\n      return false;\n    }\n\n    // 对于开发环境，允许mock token\n    if (token.startsWith('mock_')) {\n      console.log('AuthService.isAuthenticated - Mock token detected');\n      return true;\n    }\n\n    try {\n      // 简单检查token格式（JWT应该有3个部分）\n      const parts = token.split('.');\n      if (parts.length !== 3) {\n        return false;\n      }\n\n      // 检查token是否过期\n      const payload = JSON.parse(atob(parts[1]));\n      const currentTime = Math.floor(Date.now() / 1000);\n      \n      if (payload.exp && payload.exp < currentTime) {\n        // Token已过期，清除它\n        this.clearTokens();\n        return false;\n      }\n\n      return true;\n    } catch (error) {\n      // Token格式无效\n      console.error('Invalid token format:', error);\n      this.clearTokens();\n      return false;\n    }\n  }\n\n  // 直接使用fetch进行HTTP请求，避免循环依赖\n  private static async makeRequest<T>(endpoint: string, options: RequestInit): Promise<T> {\n    const url = `${API_BASE_URL}${endpoint}`;\n    console.log('makeRequest called with:', { url, method: options.method, body: options.body });\n    \n    const response = await fetch(url, {\n      headers: {\n        'Content-Type': 'application/json',\n        ...options.headers,\n      },\n      ...options,\n    });\n\n    console.log('makeRequest response status:', response.status);\n    console.log('makeRequest response headers:', response.headers);\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    const responseData = await response.json() as { code: number; message: string; data: T };\n    console.log('makeRequest response data:', responseData);\n    \n    // 检查响应码\n    if (responseData.code !== 0) {\n      throw new Error(responseData.message || '请求失败');\n    }\n    \n    return responseData.data;\n  }\n\n  // 刷新token\n  static async refreshToken(): Promise<boolean> {\n    const refreshToken = this.getRefreshToken();\n    if (!refreshToken) {\n      return false;\n    }\n\n    try {\n      const data = await this.makeRequest<{\n        access_token: string;\n      }>('/api/v1/refresh-token', {\n        method: 'POST',\n        body: JSON.stringify({\n          refresh_token: refreshToken,\n        }),\n      });\n\n      // 更新access token\n      if (typeof window !== 'undefined') {\n        localStorage.setItem('access_token', data.access_token);\n      }\n      return true;\n    } catch (error) {\n      console.error('Token refresh failed:', error);\n      this.clearTokens();\n      return false;\n    }\n  }\n\n  // 清除所有tokens\n  static clearTokens() {\n    if (typeof window !== 'undefined') {\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('refresh_token');\n    }\n  }\n\n  // 登出方法\n  static logout() {\n    this.clearTokens();\n    const { logout } = useAuthStore.getState();\n    logout();\n  }\n\n  // 修改login方法\n  static async login(username: string, password: string, tenantCode?: string): Promise<boolean> {\n    try {\n      console.log('AuthService.login called with:', { username, password: '***', tenantCode });\n      \n      const data = await this.makeRequest<{\n        access_token: string;\n        refresh_token: string;\n        user: unknown;\n      }>('/api/v1/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          username,\n          password,\n          tenant_code: tenantCode,\n        }),\n      });\n      \n      console.log('AuthService.login response data:', data);\n      \n      // 存储tokens\n      this.setTokens(data.access_token, data.refresh_token);\n      \n      // 使用store管理登录状态\n      const { login } = useAuthStore.getState();\n      console.log('AuthService.login - 调用Zustand login方法');\n      const u = data.user as any;\n      login(\n        {\n          id: Number(u?.id || 0),\n          username: String(u?.username || username),\n          role: String(u?.role || 'end_user'),\n          email: String(u?.email || ''),\n          name: String(u?.name || u?.full_name || ''),\n        },\n        data.access_token,\n        { id: 1, name: \"默认租户\", code: \"default\" } as Tenant\n      );\n      \n      // 验证状态是否正确设置\n      const { isAuthenticated } = useAuthStore.getState();\n      console.log('AuthService.login - 登录后Zustand状态:', { isAuthenticated });\n      \n      console.log('AuthService.login completed successfully');\n      return true;\n    } catch (error) {\n      console.error('Login failed:', error);\n      return false;\n    }\n  }\n}\n\nexport default AuthService;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}