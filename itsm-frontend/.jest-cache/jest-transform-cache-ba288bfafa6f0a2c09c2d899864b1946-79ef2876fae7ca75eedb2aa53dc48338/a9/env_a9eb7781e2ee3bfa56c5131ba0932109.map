{"version":3,"sources":["/Users/heidsoft/Downloads/research/itsm/itsm-frontend/src/lib/env.ts"],"sourcesContent":["// 环境配置工具\n\n// 环境类型\nexport type Environment = 'development' | 'production' | 'test';\n\n// 获取当前环境\nexport const getEnvironment = (): Environment => {\n  if (typeof window !== 'undefined') {\n    // 客户端环境\n    return (process.env.NODE_ENV as Environment) || 'development';\n  }\n  // 服务端环境\n  return (process.env.NODE_ENV as Environment) || 'development';\n};\n\n// 环境配置\nexport const env = {\n  isDevelopment: getEnvironment() === 'development',\n  isProduction: getEnvironment() === 'production',\n  isTest: getEnvironment() === 'test',\n  \n  // 功能开关\n  features: {\n    debugMode: getEnvironment() === 'development',\n    performanceMonitoring: getEnvironment() === 'production',\n    errorReporting: getEnvironment() === 'production',\n    consoleLogs: getEnvironment() === 'development',\n  },\n  \n  // API配置\n  api: {\n    baseUrl: process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:8080',\n    timeout: parseInt(process.env.NEXT_PUBLIC_API_TIMEOUT || '10000'),\n    retryCount: parseInt(process.env.NEXT_PUBLIC_API_RETRY_COUNT || '3'),\n  },\n  \n  // 应用配置\n  app: {\n    name: 'ITSM Platform',\n    version: process.env.NEXT_PUBLIC_APP_VERSION || '1.0.0',\n    buildTime: process.env.NEXT_PUBLIC_BUILD_TIME || '',\n  },\n};\n\n// 日志工具\nexport const logger = {\n  // 开发环境日志\n  debug: (...args: unknown[]) => {\n    if (env.features.consoleLogs) {\n      console.log('[DEBUG]', ...args);\n    }\n  },\n  \n  // 信息日志\n  info: (...args: unknown[]) => {\n    if (env.features.consoleLogs) {\n      console.info('[INFO]', ...args);\n    }\n  },\n  \n  // 警告日志\n  warn: (...args: unknown[]) => {\n    if (env.features.consoleLogs) {\n      console.warn('[WARN]', ...args);\n    }\n  },\n  \n  // 错误日志（生产环境也会输出）\n  error: (...args: unknown[]) => {\n    console.error('[ERROR]', ...args);\n    \n    // 生产环境错误上报\n    if (env.features.errorReporting) {\n      // 这里可以集成错误上报服务\n      // reportError(args);\n    }\n  },\n  \n  // 性能日志\n  performance: (label: string, data: Record<string, unknown>) => {\n    if (env.features.performanceMonitoring) {\n      console.log(`[PERFORMANCE] ${label}:`, data);\n    }\n  },\n  \n  // 安全日志\n  security: (event: string, data: Record<string, unknown>) => {\n    if (env.features.consoleLogs) {\n      console.log('[SECURITY]', event, data);\n    }\n    \n    // 生产环境安全事件上报\n    if (env.features.errorReporting) {\n      // reportSecurityEvent(event, data);\n    }\n  },\n};\n\n// 性能监控工具\nexport const performance = {\n  // 开始计时\n  start: (label: string) => {\n    if (env.features.performanceMonitoring) {\n      console.time(`[PERF] ${label}`);\n      return label;\n    }\n    return null;\n  },\n  \n  // 结束计时\n  end: (label: string) => {\n    if (env.features.performanceMonitoring) {\n      console.timeEnd(`[PERF] ${label}`);\n    }\n  },\n  \n  // 测量函数执行时间\n  measure: <T>(label: string, fn: () => T): T => {\n    if (env.features.performanceMonitoring) {\n      const start = Date.now();\n      const result = fn();\n      const end = Date.now();\n      logger.performance(label, { duration: `${end - start}ms` });\n      return result;\n    }\n    return fn();\n  },\n  \n  // 异步函数性能测量\n  measureAsync: async <T>(label: string, fn: () => Promise<T>): Promise<T> => {\n    if (env.features.performanceMonitoring) {\n      const start = Date.now();\n      const result = await fn();\n      const end = Date.now();\n      logger.performance(label, { duration: `${end - start}ms` });\n      return result;\n    }\n    return fn();\n  },\n};\n\n// 错误处理工具\nexport const errorHandler = {\n  // 处理API错误\n  handleApiError: (error: unknown, context?: string) => {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    const errorContext = context ? `[${context}]` : '';\n    \n    logger.error(`${errorContext} API Error:`, errorMessage);\n    \n    // 生产环境错误上报\n    if (env.features.errorReporting) {\n      // reportApiError(error, context);\n    }\n    \n    return {\n      success: false,\n      error: errorMessage,\n      context,\n    };\n  },\n  \n  // 处理表单验证错误\n  handleValidationError: (errors: Record<string, string[]>) => {\n    logger.warn('Form validation errors:', errors);\n    \n    return {\n      success: false,\n      errors,\n      message: '表单验证失败',\n    };\n  },\n  \n  // 处理网络错误\n  handleNetworkError: (error: unknown) => {\n    const isNetworkError = error instanceof Error && \n      (error.message.includes('Network Error') || \n       error.message.includes('Failed to fetch'));\n    \n    if (isNetworkError) {\n      logger.error('Network error detected:', error);\n      \n      // 生产环境网络错误上报\n      if (env.features.errorReporting) {\n        // reportNetworkError(error);\n      }\n      \n      return {\n        success: false,\n        error: '网络连接失败，请检查网络设置',\n        type: 'network',\n      };\n    }\n    \n    return {\n      success: false,\n      error: '未知错误',\n      type: 'unknown',\n    };\n  },\n};\n\n// 开发工具\nexport const devTools = {\n  // 只在开发环境执行的函数\n  onlyInDev: <T>(fn: () => T, fallback?: T): T | undefined => {\n    if (env.isDevelopment) {\n      return fn();\n    }\n    return fallback;\n  },\n  \n  // 开发环境调试信息\n  debugInfo: (component: string, data: unknown) => {\n    if (env.isDevelopment) {\n      logger.debug(`[${component}]`, data);\n    }\n  },\n  \n  // 开发环境性能标记\n  mark: (name: string) => {\n    if (env.isDevelopment && typeof window !== 'undefined' && window.performance) {\n      window.performance.mark(name);\n    }\n  },\n  \n  // 开发环境性能测量\n  measure: (name: string, startMark: string, endMark: string) => {\n    if (env.isDevelopment && typeof window !== 'undefined' && window.performance) {\n      try {\n        const measure = window.performance.measure(name, startMark, endMark);\n        logger.debug(`Performance measure [${name}]:`, measure.duration);\n      } catch (error) {\n        logger.warn(`Failed to measure performance [${name}]:`, error);\n      }\n    }\n  },\n};\n\n// 导出默认配置\nexport default env;\n"],"names":["devTools","env","errorHandler","getEnvironment","logger","performance","window","process","NODE_ENV","isDevelopment","isProduction","isTest","features","debugMode","performanceMonitoring","errorReporting","consoleLogs","api","baseUrl","NEXT_PUBLIC_API_BASE_URL","timeout","parseInt","NEXT_PUBLIC_API_TIMEOUT","retryCount","NEXT_PUBLIC_API_RETRY_COUNT","app","name","version","NEXT_PUBLIC_APP_VERSION","buildTime","NEXT_PUBLIC_BUILD_TIME","debug","args","console","log","info","warn","error","label","data","security","event","start","time","end","timeEnd","measure","fn","Date","now","result","duration","measureAsync","handleApiError","context","errorMessage","Error","message","String","errorContext","success","handleValidationError","errors","handleNetworkError","isNetworkError","includes","type","onlyInDev","fallback","debugInfo","component","mark","startMark","endMark"],"mappings":"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"}