{"version":3,"sources":["/Users/heidsoft/Downloads/research/itsm/itsm-frontend/src/app/(main)/cmdb/cis/create/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { Breadcrumb, Button, Card, Form, Input, Select, Space, message } from 'antd';\n\nimport { CMDBApi } from '@/modules/cmdb/api';\nimport { CIStatus, CIStatusLabels } from '@/modules/cmdb/constants';\nimport type { CIType } from '@/modules/cmdb/types';\n\nconst { TextArea } = Input;\n\nconst statusOptions = [\n  CIStatus.ACTIVE,\n  CIStatus.INACTIVE,\n  CIStatus.MAINTENANCE,\n];\n\nconst CreateCIPage: React.FC = () => {\n  const router = useRouter();\n  const [form] = Form.useForm();\n  const [types, setTypes] = useState<CIType[]>([]);\n  const [typesLoading, setTypesLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n\n  useEffect(() => {\n    const loadTypes = async () => {\n      try {\n        const res = await CMDBApi.getTypes();\n        setTypes(res || []);\n      } catch (error) {\n        message.error('加载资产类型失败');\n      } finally {\n        setTypesLoading(false);\n      }\n    };\n    loadTypes();\n  }, []);\n\n  const handleSubmit = async (values: {\n    name: string;\n    ci_type_id: number;\n    status: CIStatus;\n    description?: string;\n    attributes?: string;\n    serial_number?: string;\n    model?: string;\n    vendor?: string;\n    location?: string;\n    asset_tag?: string;\n    assigned_to?: string;\n    owned_by?: string;\n    environment?: string;\n    criticality?: string;\n    discovery_source?: string;\n  }) => {\n    try {\n      let attributes: Record<string, any> | undefined;\n      if (values.attributes) {\n        try {\n          attributes =\n            typeof values.attributes === 'string'\n              ? JSON.parse(values.attributes)\n              : values.attributes;\n        } catch (parseError) {\n          message.error('扩展属性需要是有效的 JSON');\n          return;\n        }\n      }\n      setSaving(true);\n      await CMDBApi.createCI({\n        name: values.name,\n        ci_type_id: values.ci_type_id,\n        status: values.status,\n        description: values.description,\n        attributes,\n        serial_number: values.serial_number,\n        model: values.model,\n        vendor: values.vendor,\n        location: values.location,\n        asset_tag: values.asset_tag,\n        assigned_to: values.assigned_to,\n        owned_by: values.owned_by,\n        environment: values.environment,\n        criticality: values.criticality,\n        discovery_source: values.discovery_source,\n      });\n      message.success('配置项创建成功');\n      router.push('/cmdb');\n    } catch (error) {\n      if (error instanceof Error) {\n        message.error(error.message || '创建配置项失败');\n      } else {\n        message.error('创建配置项失败');\n      }\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <Card variant=\"borderless\">\n      <Breadcrumb\n        style={{ marginBottom: 16 }}\n        items={[\n          { title: '首页' },\n          { title: '配置管理' },\n          { title: <a onClick={() => router.push('/cmdb')}>配置项列表</a> },\n          { title: '录入资产' },\n        ]}\n      />\n\n      <Form form={form} layout=\"vertical\" onFinish={handleSubmit}>\n        <Form.Item\n          label=\"资产名称\"\n          name=\"name\"\n          rules={[{ required: true, message: '请输入资产名称' }]}\n        >\n          <Input placeholder=\"请输入资产名称\" />\n        </Form.Item>\n\n        <Form.Item\n          label=\"资产类型\"\n          name=\"ci_type_id\"\n          rules={[{ required: true, message: '请选择资产类型' }]}\n        >\n          <Select placeholder=\"请选择资产类型\" loading={typesLoading}>\n            {types.map((type) => (\n              <Select.Option key={type.id} value={type.id}>\n                {type.name}\n              </Select.Option>\n            ))}\n          </Select>\n        </Form.Item>\n\n        <Form.Item\n          label=\"状态\"\n          name=\"status\"\n          rules={[{ required: true, message: '请选择资产状态' }]}\n        >\n          <Select placeholder=\"请选择资产状态\">\n            {statusOptions.map((status) => (\n              <Select.Option key={status} value={status}>\n                {CIStatusLabels[status]}\n              </Select.Option>\n            ))}\n          </Select>\n        </Form.Item>\n\n        <Form.Item label=\"描述\" name=\"description\">\n          <TextArea rows={4} placeholder=\"补充描述信息（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"序列号\" name=\"serial_number\">\n          <Input placeholder=\"请输入序列号（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"型号\" name=\"model\">\n          <Input placeholder=\"请输入型号（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"厂商\" name=\"vendor\">\n          <Input placeholder=\"请输入厂商（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"位置\" name=\"location\">\n          <Input placeholder=\"请输入位置（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"资产标签\" name=\"asset_tag\">\n          <Input placeholder=\"请输入资产标签（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"分配给\" name=\"assigned_to\">\n          <Input placeholder=\"请输入分配人（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"拥有者\" name=\"owned_by\">\n          <Input placeholder=\"请输入拥有者（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"环境\" name=\"environment\">\n          <Select placeholder=\"请选择环境\" allowClear>\n            <Select.Option value=\"production\">生产</Select.Option>\n            <Select.Option value=\"staging\">预发布</Select.Option>\n            <Select.Option value=\"development\">开发</Select.Option>\n          </Select>\n        </Form.Item>\n\n        <Form.Item label=\"重要性\" name=\"criticality\">\n          <Select placeholder=\"请选择重要性\" allowClear>\n            <Select.Option value=\"low\">低</Select.Option>\n            <Select.Option value=\"medium\">中</Select.Option>\n            <Select.Option value=\"high\">高</Select.Option>\n            <Select.Option value=\"critical\">关键</Select.Option>\n          </Select>\n        </Form.Item>\n\n        <Form.Item label=\"发现源\" name=\"discovery_source\">\n          <Input placeholder=\"请输入发现源（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"扩展属性\" name=\"attributes\">\n          <TextArea rows={4} placeholder='请输入扩展属性 JSON（可选）' />\n        </Form.Item>\n\n        <Space>\n          <Button onClick={() => router.back()}>取消</Button>\n          <Button type=\"primary\" htmlType=\"submit\" loading={saving}>\n            保存\n          </Button>\n        </Space>\n      </Form>\n    </Card>\n  );\n};\n\nexport default CreateCIPage;\n"],"names":["TextArea","Input","statusOptions","CIStatus","ACTIVE","INACTIVE","MAINTENANCE","CreateCIPage","router","useRouter","form","Form","useForm","types","setTypes","useState","typesLoading","setTypesLoading","saving","setSaving","useEffect","loadTypes","res","CMDBApi","getTypes","error","message","handleSubmit","values","attributes","JSON","parse","parseError","createCI","name","ci_type_id","status","description","serial_number","model","vendor","location","asset_tag","assigned_to","owned_by","environment","criticality","discovery_source","success","push","Error","Card","variant","Breadcrumb","style","marginBottom","items","title","a","onClick","layout","onFinish","Item","label","rules","required","placeholder","Select","loading","map","type","Option","value","id","CIStatusLabels","rows","allowClear","Space","Button","back","htmlType"],"mappings":"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"}