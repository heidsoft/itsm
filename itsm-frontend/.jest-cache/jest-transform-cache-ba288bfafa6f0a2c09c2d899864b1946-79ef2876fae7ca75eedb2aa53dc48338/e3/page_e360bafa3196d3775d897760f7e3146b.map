{"version":3,"sources":["/Users/heidsoft/Downloads/research/itsm/itsm-frontend/src/app/(main)/cmdb/cis/create/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { Breadcrumb, Button, Card, Divider, Form, Input, Select, Space, message } from 'antd';\n\nimport { CMDBApi } from '@/modules/cmdb/api';\nimport { CIStatus, CIStatusLabels } from '@/modules/cmdb/constants';\nimport type { CIType } from '@/modules/cmdb/types';\n\nconst { TextArea } = Input;\n\nconst statusOptions = [\n  CIStatus.ACTIVE,\n  CIStatus.INACTIVE,\n  CIStatus.MAINTENANCE,\n];\n\nconst CreateCIPage: React.FC = () => {\n  const router = useRouter();\n  const [form] = Form.useForm();\n  const [types, setTypes] = useState<CIType[]>([]);\n  const [typesLoading, setTypesLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n\n  useEffect(() => {\n    const loadTypes = async () => {\n      try {\n        const res = await CMDBApi.getTypes();\n        setTypes(res || []);\n      } catch (error) {\n        message.error('加载资产类型失败');\n      } finally {\n        setTypesLoading(false);\n      }\n    };\n    loadTypes();\n  }, []);\n\n  const handleSubmit = async (values: {\n    name: string;\n    ci_type_id: number;\n    status: CIStatus;\n    description?: string;\n    attributes?: string;\n    serial_number?: string;\n    model?: string;\n    vendor?: string;\n    location?: string;\n    asset_tag?: string;\n    assigned_to?: string;\n    owned_by?: string;\n    environment?: string;\n    criticality?: string;\n    discovery_source?: string;\n    source?: string;\n    cloud_provider?: string;\n    cloud_account_id?: string;\n    cloud_region?: string;\n    cloud_zone?: string;\n    cloud_resource_id?: string;\n    cloud_resource_type?: string;\n    cloud_sync_status?: string;\n  }) => {\n    try {\n      let attributes: Record<string, any> | undefined;\n      if (values.attributes) {\n        try {\n          attributes =\n            typeof values.attributes === 'string'\n              ? JSON.parse(values.attributes)\n              : values.attributes;\n        } catch (parseError) {\n          message.error('扩展属性需要是有效的 JSON');\n          return;\n        }\n      }\n      setSaving(true);\n      await CMDBApi.createCI({\n        name: values.name,\n        ci_type_id: values.ci_type_id,\n        status: values.status,\n        description: values.description,\n        attributes,\n        serial_number: values.serial_number,\n        model: values.model,\n        vendor: values.vendor,\n        location: values.location,\n        asset_tag: values.asset_tag,\n        assigned_to: values.assigned_to,\n        owned_by: values.owned_by,\n        environment: values.environment,\n        criticality: values.criticality,\n        discovery_source: values.discovery_source,\n        source: values.source,\n        cloud_provider: values.cloud_provider,\n        cloud_account_id: values.cloud_account_id,\n        cloud_region: values.cloud_region,\n        cloud_zone: values.cloud_zone,\n        cloud_resource_id: values.cloud_resource_id,\n        cloud_resource_type: values.cloud_resource_type,\n        cloud_sync_status: values.cloud_sync_status,\n      });\n      message.success('配置项创建成功');\n      router.push('/cmdb');\n    } catch (error) {\n      if (error instanceof Error) {\n        message.error(error.message || '创建配置项失败');\n      } else {\n        message.error('创建配置项失败');\n      }\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <Card variant=\"borderless\">\n      <Breadcrumb\n        style={{ marginBottom: 16 }}\n        items={[\n          { title: '首页' },\n          { title: '配置管理' },\n          { title: <a onClick={() => router.push('/cmdb')}>配置项列表</a> },\n          { title: '录入资产' },\n        ]}\n      />\n\n      <Form form={form} layout=\"vertical\" onFinish={handleSubmit}>\n        <Form.Item\n          label=\"资产名称\"\n          name=\"name\"\n          rules={[{ required: true, message: '请输入资产名称' }]}\n        >\n          <Input placeholder=\"请输入资产名称\" />\n        </Form.Item>\n\n        <Form.Item\n          label=\"资产类型\"\n          name=\"ci_type_id\"\n          rules={[{ required: true, message: '请选择资产类型' }]}\n        >\n          <Select placeholder=\"请选择资产类型\" loading={typesLoading}>\n            {types.map((type) => (\n              <Select.Option key={type.id} value={type.id}>\n                {type.name}\n              </Select.Option>\n            ))}\n          </Select>\n        </Form.Item>\n\n        <Form.Item\n          label=\"状态\"\n          name=\"status\"\n          rules={[{ required: true, message: '请选择资产状态' }]}\n        >\n          <Select placeholder=\"请选择资产状态\">\n            {statusOptions.map((status) => (\n              <Select.Option key={status} value={status}>\n                {CIStatusLabels[status]}\n              </Select.Option>\n            ))}\n          </Select>\n        </Form.Item>\n\n        <Form.Item label=\"描述\" name=\"description\">\n          <TextArea rows={4} placeholder=\"补充描述信息（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"序列号\" name=\"serial_number\">\n          <Input placeholder=\"请输入序列号（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"型号\" name=\"model\">\n          <Input placeholder=\"请输入型号（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"厂商\" name=\"vendor\">\n          <Input placeholder=\"请输入厂商（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"位置\" name=\"location\">\n          <Input placeholder=\"请输入位置（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"资产标签\" name=\"asset_tag\">\n          <Input placeholder=\"请输入资产标签（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"分配给\" name=\"assigned_to\">\n          <Input placeholder=\"请输入分配人（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"拥有者\" name=\"owned_by\">\n          <Input placeholder=\"请输入拥有者（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"环境\" name=\"environment\">\n          <Select placeholder=\"请选择环境\" allowClear>\n            <Select.Option value=\"production\">生产</Select.Option>\n            <Select.Option value=\"staging\">预发布</Select.Option>\n            <Select.Option value=\"development\">开发</Select.Option>\n          </Select>\n        </Form.Item>\n\n        <Form.Item label=\"重要性\" name=\"criticality\">\n          <Select placeholder=\"请选择重要性\" allowClear>\n            <Select.Option value=\"low\">低</Select.Option>\n            <Select.Option value=\"medium\">中</Select.Option>\n            <Select.Option value=\"high\">高</Select.Option>\n            <Select.Option value=\"critical\">关键</Select.Option>\n          </Select>\n        </Form.Item>\n\n        <Form.Item label=\"发现源\" name=\"discovery_source\">\n          <Input placeholder=\"请输入发现源（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"数据来源\" name=\"source\">\n          <Select placeholder=\"请选择数据来源\" allowClear>\n            <Select.Option value=\"manual\">手工录入</Select.Option>\n            <Select.Option value=\"discovery\">自动发现</Select.Option>\n            <Select.Option value=\"import\">批量导入</Select.Option>\n          </Select>\n        </Form.Item>\n\n        <Divider orientation=\"left\">云资源信息</Divider>\n\n        <Form.Item label=\"云厂商\" name=\"cloud_provider\">\n          <Select placeholder=\"请选择云厂商\" allowClear>\n            <Select.Option value=\"aliyun\">阿里云</Select.Option>\n            <Select.Option value=\"huawei\">华为云</Select.Option>\n            <Select.Option value=\"tencent\">腾讯云</Select.Option>\n            <Select.Option value=\"azure\">Azure</Select.Option>\n            <Select.Option value=\"onprem\">私有云</Select.Option>\n          </Select>\n        </Form.Item>\n\n        <Form.Item label=\"云账号ID\" name=\"cloud_account_id\">\n          <Input placeholder=\"请输入云账号ID（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"Region\" name=\"cloud_region\">\n          <Input placeholder=\"请输入Region（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"Zone\" name=\"cloud_zone\">\n          <Input placeholder=\"请输入Zone（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"云资源ID\" name=\"cloud_resource_id\">\n          <Input placeholder=\"请输入云资源ID（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"云资源类型\" name=\"cloud_resource_type\">\n          <Input placeholder=\"请输入云资源类型（可选）\" />\n        </Form.Item>\n\n        <Form.Item label=\"同步状态\" name=\"cloud_sync_status\">\n          <Select placeholder=\"请选择同步状态\" allowClear>\n            <Select.Option value=\"success\">成功</Select.Option>\n            <Select.Option value=\"failed\">失败</Select.Option>\n            <Select.Option value=\"unknown\">未知</Select.Option>\n          </Select>\n        </Form.Item>\n\n        <Form.Item label=\"扩展属性\" name=\"attributes\">\n          <TextArea rows={4} placeholder='请输入扩展属性 JSON（可选）' />\n        </Form.Item>\n\n        <Space>\n          <Button onClick={() => router.back()}>取消</Button>\n          <Button type=\"primary\" htmlType=\"submit\" loading={saving}>\n            保存\n          </Button>\n        </Space>\n      </Form>\n    </Card>\n  );\n};\n\nexport default CreateCIPage;\n"],"names":["TextArea","Input","statusOptions","CIStatus","ACTIVE","INACTIVE","MAINTENANCE","CreateCIPage","router","useRouter","form","Form","useForm","types","setTypes","useState","typesLoading","setTypesLoading","saving","setSaving","useEffect","loadTypes","res","CMDBApi","getTypes","error","message","handleSubmit","values","attributes","JSON","parse","parseError","createCI","name","ci_type_id","status","description","serial_number","model","vendor","location","asset_tag","assigned_to","owned_by","environment","criticality","discovery_source","source","cloud_provider","cloud_account_id","cloud_region","cloud_zone","cloud_resource_id","cloud_resource_type","cloud_sync_status","success","push","Error","Card","variant","Breadcrumb","style","marginBottom","items","title","a","onClick","layout","onFinish","Item","label","rules","required","placeholder","Select","loading","map","type","Option","value","id","CIStatusLabels","rows","allowClear","Divider","orientation","Space","Button","back","htmlType"],"mappings":"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"}