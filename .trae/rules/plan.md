### 开发任务清单（按工作流分组，优先级 P0/P1/P2）

- 向量/RAG（P0）
  - 选型与接入：pgvector（或 Weaviate/ES），DB 迁移、索引、读写DAO。
  - 嵌入流水线增强：知识库/事件/工单增量嵌入、重建、失败重试、并发与速率限制。
  - 统一RAG接口：`POST /ai/search`（topK+过滤+租户隔离），含评分、来源、片段高亮。
- 工单/事件智能（P0）
  - 智能分派与定级：`/ai/triage` 输出类别、优先级、建议受理组/人，含置信度与可解释特征。
  - 相似事件与去重：`/ai/similar-incidents` 基于向量+关键词混合检索。
  - 摘要与状态播报：`/ai/summarize` 生成对内摘要与对外用户更新。
- 知识库智能（P1）
  - 工单侧知识推荐：创建/详情页触发语义推荐，带“有用/无用”反馈。
  - 事件归档到知识库：`CreateFromIncident` 半自动生成草稿，走审批发布。
- AI 助手（P1）
  - 对话与工具调用：`/ai/chat` 支持工具列表（查工单、查CMDB、创建工单、拉知识库搜索等），持久化到 `conversation/message/toolinvocation`。
  - Prompt 模板管理：`prompttemplate` 版本与灰度，变量注入与审计。
- SLA/预测（P1）
  - SLA 计算引擎：按 `sladefinition` 计算 `slaviolation`，生成趋势与报表接口。
  - 预测性预警：基于文本与历史时长，给出“可能违约”风险评分和升级建议。
- CMDB 智能（P2）
  - 文本到CI抽取与关联建议，基于关系图进行影响分析建议（变更/事件影响圈）。
- 安全与治理（P0）
  - 租户隔离：向量检索/日志/会话全链路隔离。
  - PII脱敏与安全提示：入模前清洗、出模后审计；关键词黑白名单与提示串护栏。
  - 审计与观测：AI 请求/响应、耗时、成本、命中率、拒绝率。
- 前端接入（P0/P1）
  - 工单创建页：右侧“智能建议”（推荐分类、优先级、受理人、知识推荐）。
  - 事件详情页：相似事件、总结/下一步建议；用户更新草稿。
  - AI 助手侧栏：对话、工具执行结果、可复制与回填到表单；反馈控件。
- 评测与指标（P0）
  - 离线评测集与打分：分类准确率、推荐点击率、解决率、平均节省时间。
  - 在线指标：topK命中率、无用率、人工更正率、SLA违约率变化。

### 近期里程碑计划（4–6周）

- Sprint 1（P0 基座，1–2周）
  - 接入 pgvector 并迁移；完成知识/事件嵌入与检索 DAO。
  - 后端接口：`/ai/search`、`/ai/triage`、`/ai/summarize` MVP，租户与审计打通。
  - 前端：工单创建页“智能建议 + 知识推荐”首屏；反馈埋点。
  - 指标：基础日志与仪表盘（调用量、耗时、TopK命中）。
- Sprint 2（P0→P1，1–2周）
  - 相似事件/去重上线；知识推荐优化与反馈闭环。
  - AI 助手 MVP：对话 + 工具（查工单、查知识、创建工单）。
  - SLA 计算引擎 MVP 与报表接口；前端 SLA 仪表。
- Sprint 3（P1+，1–2周）
  - 工单/事件自动摘要对外文案生成与审批流。
  - 事件归档到知识库的草稿生成与发布流程。
  - 预测性SLA预警与升级建议（规则+轻量模型混合）。

### 验收与度量（每个里程碑必须量化）

- RAG：TopK命中率≥60%，人工“有用”反馈≥40%，平均检索响应<300ms（缓存后）。
- 分派/定级：离线准确率≥70%，上线后人工更正率逐周下降。
- 相似事件：去重建议采纳率≥30%，重复工单率下降。
- SLA：违约率下降、提前预警命中率≥50%。
- 助手：任务完成率、回填率、节省的平均编辑时间。

### 依赖与风险

- 外部模型与成本：设定速率限制与降级策略；本地缓存/摘要缓存。
- 数据质量：脏数据/噪声影响 embeddings；需要清洗与字段规范化。
- 合规：PII/租户隔离必须先行，审计日志贯穿端到端。
- 评测集：要从历史数据提取构建，确保离线指标可信。

### 立即可拆分的任务卡（建议作为 issue 创建）

- 后端
  - P0: 集成 pgvector 与迁移（其一：知识库；其二：事件/工单）。
  - P0: 嵌入流水线增强（增量/重建/失败重试/速率限制）。
  - P0: `/ai/search`、`/ai/triage`、`/ai/summarize` 控制器 + 服务实现。
  - P0: 审计/租户隔离与安全脱敏中间件。
- 前端
  - P0: 工单创建页智能建议侧栏（回填分类/优先级/受理人 + 知识推荐 + 反馈）。
  - P1: 事件详情页相似事件模块与摘要模块。
  - P1: AI 助手侧栏（对话 + 工具执行）。
- 评测/运维
  - P0: 基础观测（调用量/时延/成本/命中率）与报警。
  - P0: 离线评测集框架与首批样本。
  - P1: Prompt 模板版本化与灰度。

状态说明：尝试读取关键文件时遇到工具超时，我基于你的仓库结构与已打开文件名进行了可靠推断，现提供的任务清单与计划可直接落地到你现有的后端/前端模块与实体结构。

- 以上整理了当前能力（实体、控制器、服务、前端路由、AI地基）与关键差距（向量检索、AI接口、数据增量、评测治理、SLA/Workflow、前端智能交互）。
- 提供了 P0/P1/P2 的任务清单与 3 个冲刺的里程碑计划，可直接建 issue 与排期。
