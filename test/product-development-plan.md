# ITSM产品开发计划

- **制定日期**: 2025-12-07
- **基于**: 代码审查、测试报告、模块开发状态分析
- **目标**: 系统化推进产品开发，解决阻塞问题，提升代码质量和测试覆盖率

---

## 执行摘要

### 当前状态

- **后端完成度**: 80% | **前端完成度**: 78% | **测试覆盖率**: 45%
- **P0阻塞问题**: 3个（BPMN适配器、测试Schema、API调用规范）
- **待修复TODO**: 后端49个，前端49个
- **TypeScript错误**: 46个
- **测试失败**: 前端7/10套件，后端编译失败

### 开发目标

1. **短期（1-2周）**: 解决P0阻塞，修复编译和测试问题，达到可运行状态
2. **中期（1个月）**: 提升测试覆盖率至70%，完善核心功能模块
3. **长期（2-3个月）**: 测试覆盖率≥80%，完成所有功能模块，优化性能和用户体验

---

## 第一阶段：紧急修复与稳定性提升（1-2周）

### 目标

- ✅ 解决所有P0阻塞问题
- ✅ 修复编译错误和测试失败
- ✅ 确保系统可正常运行
- ✅ 建立CI/CD基础流程

### 任务清单

#### 1.1 后端P0问题修复（优先级：最高）

**1.1.1 BPMN适配器API修复** 🔴

- **文件**: `itsm-backend/pkg/bpmn/engine_adapter.go`
- **问题**:
  - `bpmn_engine.New` 参数不匹配
  - `Export`, `Load`, `NewTaskHandler`, `GetProcessCache` 方法不存在
- **修复方案**:
  1. 检查BPMN引擎库版本和API文档
  2. 对齐API调用方式
  3. 实现缺失的方法或使用替代方案
- **验收标准**: `go build` 和 `go test ./pkg/bpmn` 通过
- **预计工时**: 4-6小时
- **负责人**: 后端开发

**1.1.2 测试Schema对齐** ⚠️

- **文件**:
  - `service/auth_service_test.go`
  - `service/ticket_service_test.go`
  - `service/incident_service_test.go`
- **问题**:
  - `ent.UserCreate.SetStatus` 不存在 → 应使用 `SetActive(true)`
  - `ent.Tenant.SetActive` 不存在 → 应使用 `SetStatus("active")`
  - `ent.UserCreate.SetDisplayName` 不存在 → 应使用 `SetName()`
- **修复方案**:
  1. 检查Ent Schema定义，确认正确的方法名
  2. 批量替换所有测试文件中的错误方法调用
  3. 运行测试验证修复
- **验收标准**: 所有相关测试文件编译通过，测试用例通过率≥80%
- **预计工时**: 6-8小时
- **负责人**: 后端开发

**1.1.3 DTO字段对齐** ⚠️

- **问题文件**:
  - `dto/auth_dto.go` - `RefreshTokenResponse.RefreshToken` 字段缺失
  - `dto/user_dto.go` - `UserInfo.DisplayName`, `Phone` 字段缺失
  - `dto/user_dto.go` - `SearchUsersRequest.Page`, `Department` 字段缺失
- **修复方案**:
  1. 检查DTO定义和实际使用情况
  2. 补充缺失字段或调整使用方式
  3. 更新所有引用处
- **验收标准**: DTO定义与使用一致，编译通过
- **预计工时**: 4-6小时
- **负责人**: 后端开发

**1.1.4 控制器构造函数签名统一** ⚠️

- **文件**: `controller/user_controller_test.go`
- **问题**: `NewUserController` 缺少 `*zap.SugaredLogger` 参数
- **修复方案**: 在所有测试文件中添加logger参数
- **验收标准**: 所有控制器测试编译通过
- **预计工时**: 2-3小时
- **负责人**: 后端开发

#### 1.2 前端P0问题修复（优先级：最高）

**1.2.1 TypeScript错误修复** ⚠️

- **问题文件**:
  - `src/lib/hooks/useAccessibility.ts` - JSX但为.ts文件
  - `src/lib/utils/props-validator.ts` - JSX片段解析错误
  - `src/components/business/TicketDependencyManager.tsx:170` - 语法不完整
  - `src/lib/error-handler.tsx:333` - 占位符`...`
  - `src/lib/validation.ts:253` - 占位符`...`
- **修复方案**:
  1. 将含JSX的`.ts`文件改为`.tsx`
  2. 修复语法错误和占位符
  3. 运行`npm run type-check`验证
- **验收标准**: `npm run type-check` 通过，0个错误
- **预计工时**: 4-6小时
- **负责人**: 前端开发

**1.2.2 API调用规范化** ⚠️

- **文件**: `src/components/business/IncidentManagement.tsx:162-168`
- **问题**: 直接使用`fetch`和`localStorage`
- **修复方案**:
  1. 创建或使用`IncidentAPI`统一API层
  2. 替换所有`fetch`调用为API层方法
  3. 使用统一的存储服务替代`localStorage`
- **验收标准**: 组件中无直接`fetch`和`localStorage`调用
- **预计工时**: 3-4小时
- **负责人**: 前端开发

**1.2.3 ESLint配置修复** ⚠️

- **问题**: 缺少`@typescript-eslint/eslint-plugin`和`@typescript-eslint/parser`
- **修复方案**: 安装缺失依赖
- **验收标准**: `npm run lint:check` 通过
- **预计工时**: 1小时
- **负责人**: 前端开发

#### 1.3 测试基础设施修复

**1.3.1 测试路径统一** ⚠️

- **问题**: 测试文件相对路径不匹配
- **修复方案**: 统一使用`@`别名或正确相对路径
- **验收标准**: 所有测试文件可正常导入
- **预计工时**: 2-3小时
- **负责人**: 前端开发

**1.3.2 测试Provider统一** ⚠️

- **问题**: Dashboard等页面级测试缺少Provider
- **修复方案**: 创建统一的测试包装器，注入必要的Provider
- **验收标准**: 页面级测试可正常运行
- **预计工时**: 3-4小时
- **负责人**: 前端开发

### 第一阶段里程碑

- [ ] 后端编译通过，无编译错误
- [ ] 后端核心测试通过率≥80%
- [ ] 前端TypeScript检查通过，0个错误
- [ ] 前端测试通过率≥60%
- [ ] CI/CD基础流程建立

### 第一阶段验收标准

1. **编译状态**: 前后端均可正常编译
2. **测试状态**: 核心模块测试通过率≥80%
3. **代码质量**: TypeScript错误为0，ESLint通过
4. **功能状态**: 核心功能（登录、工单、Dashboard）可正常运行

---

## 第二阶段：功能完善与测试提升（3-4周）

### 目标

- ✅ 提升测试覆盖率至70%
- ✅ 完善核心功能模块
- ✅ 统一设计系统和API层
- ✅ 优化用户体验

### 任务清单

#### 2.1 核心模块功能完善

**2.1.1 工单模块优化**（完成度：95% → 100%）

- **任务**:
  - 完善工单视图功能
  - 优化智能分配算法
  - 增强导入导出功能
  - 完善审批流程集成
- **预计工时**: 16-20小时
- **优先级**: 高

**2.1.2 事件管理模块完善**（完成度：85% → 95%）

- **任务**:
  - 实现`CloseIncident`方法
  - 完善事件监控和告警
  - 优化事件统计功能
- **预计工时**: 12-16小时
- **优先级**: 高

**2.1.3 SLA模块优化**（完成度：90% → 95%）

- **任务**:
  - 完善预警规则测试
  - 优化监控数据实时性
  - 增强合规检查准确性
- **预计工时**: 10-12小时
- **优先级**: 中

**2.1.4 Dashboard优化**（完成度：90% → 95%）

- **任务**:
  - 优化图表数据验证
  - 完善实时数据更新
  - 增强性能优化
- **预计工时**: 8-10小时
- **优先级**: 中

#### 2.2 中等完成度模块提升

**2.2.1 问题管理模块**（完成度：75% → 85%）

- **任务**:
  - 完善调查流程
  - 增强步骤管理
  - 优化根因分析集成
- **预计工时**: 20-24小时
- **优先级**: 中

**2.2.2 变更管理模块**（完成度：70% → 80%）

- **任务**:
  - 完善审批流程
  - 增强审批记录管理
  - 优化BPMN工作流集成
- **预计工时**: 24-28小时
- **优先级**: 中

**2.2.3 CMDB模块**（完成度：80% → 85%）

- **任务**:
  - 完善关系图功能
  - 优化拓扑视图性能
  - 增强影响评估
- **预计工时**: 16-20小时
- **优先级**: 中

**2.2.4 知识库模块**（完成度：75% → 85%）

- **任务**:
  - 实现版本管理
  - 增强协作功能
  - 优化搜索和推荐
- **预计工时**: 20-24小时
- **优先级**: 低

#### 2.3 测试覆盖率提升

**2.3.1 后端测试补充**

- **目标模块**: 认证、工单、事件、SLA
- **目标覆盖率**: 从45%提升至70%
- **任务**:
  - 为核心Service层补充单元测试
  - 为Controller层补充集成测试
  - 使用Table Driven Tests模式
- **预计工时**: 40-50小时
- **优先级**: 高

**2.3.2 前端测试补充**

- **目标模块**: 工单、事件、Dashboard、SLA
- **目标覆盖率**: 从30%提升至60%
- **任务**:
  - 为关键组件补充单元测试
  - 为关键交互补充集成测试
  - 增加A11y测试
- **预计工时**: 30-40小时
- **优先级**: 高

#### 2.4 代码质量与规范统一

**2.4.1 设计系统统一** ⚠️

- **任务**:
  - 明确以Tailwind为主设计系统
  - 逐步减少Ant Design使用或统一主题
  - 移除CSS Modules，迁移到Tailwind
- **预计工时**: 24-30小时
- **优先级**: 中

**2.4.2 API层统一** ⚠️

- **任务**:
  - 检查所有组件，移除直接`fetch`调用
  - 统一使用`http-client.ts`
  - 建立API层使用规范文档
- **预计工时**: 16-20小时
- **优先级**: 高

**2.4.3 调试代码清理** ⚠️

- **任务**:
  - 清理或替换`console.log`（51+文件，170+次）
  - 使用统一的日志服务
  - 建立日志规范
- **预计工时**: 8-12小时
- **优先级**: 低

#### 2.5 用户体验优化

**2.5.1 统一交互组件**

- **任务**:
  - 在Tickets/Incidents/Problems/Changes使用`UnifiedFilters`
  - 统一使用`LoadingEmptyError`组件
  - 统一表单错误处理和焦点管理
- **预计工时**: 16-20小时
- **优先级**: 中

**2.5.2 无障碍性提升**

- **任务**:
  - 完善键盘导航
  - 增强屏幕阅读器支持
  - 统一ARIA标签
- **预计工时**: 12-16小时
- **优先级**: 中

### 第二阶段里程碑

- [ ] 测试覆盖率：后端≥70%，前端≥60%
- [ ] 核心模块完成度≥90%
- [ ] 设计系统统一完成
- [ ] API层统一完成
- [ ] 用户体验显著提升

### 第二阶段验收标准

1. **测试覆盖率**: 后端≥70%，前端≥60%
2. **功能完整度**: 核心模块完成度≥90%
3. **代码质量**: 无P0/P1问题，规范统一
4. **用户体验**: 交互统一，无障碍性提升

---

## 第三阶段：全面优化与功能完善（5-8周）

### 目标

- ✅ 测试覆盖率≥80%
- ✅ 所有功能模块完成度≥85%
- ✅ 性能优化
- ✅ 生产就绪

### 任务清单

#### 3.1 阻塞模块修复

**3.1.1 BPMN工作流模块**（完成度：60% → 85%）🔴

- **任务**:
  - 修复BPMN适配器（第一阶段已完成）
  - 完善工作流设计器
  - 增强流程实例管理
  - 优化任务分配和执行
- **预计工时**: 40-50小时
- **优先级**: 高

#### 3.2 剩余模块完善

**3.2.1 服务目录模块**（完成度：70% → 85%）

- **任务**:
  - 完善表单流程
  - 增强动态表单生成
  - 优化审批流程集成
- **预计工时**: 24-28小时
- **优先级**: 中

**3.2.2 AI功能模块**（完成度：85% → 95%）

- **任务**:
  - 完善Embedding管线测试
  - 优化工具执行审批流程
  - 增强AI反馈机制
- **预计工时**: 20-24小时
- **优先级**: 中

**3.2.3 报表分析模块**（完成度：80% → 90%）

- **任务**:
  - 完善导出功能
  - 增强数据验证
  - 优化报表性能
- **预计工时**: 16-20小时
- **优先级**: 中

#### 3.3 测试覆盖率最终提升

**3.3.1 后端测试完善**

- **目标覆盖率**: 从70%提升至≥80%
- **任务**:
  - 为所有Service层补充测试
  - 为所有Controller层补充测试
  - 增加端到端测试
- **预计工时**: 50-60小时
- **优先级**: 高

**3.3.2 前端测试完善**

- **目标覆盖率**: 从60%提升至≥75%
- **任务**:
  - 为所有业务组件补充测试
  - 为所有页面补充测试
  - 增加E2E测试
- **预计工时**: 40-50小时
- **优先级**: 高

#### 3.4 性能优化

**3.4.1 后端性能优化**

- **任务**:
  - 数据库查询优化
  - 缓存策略优化
  - API响应时间优化
- **预计工时**: 30-40小时
- **优先级**: 中

**3.4.2 前端性能优化**

- **任务**:
  - 代码分割和懒加载
  - 虚拟滚动优化
  - 图片和资源优化
- **预计工时**: 24-30小时
- **优先级**: 中

#### 3.5 生产就绪

**3.5.1 文档完善**

- **任务**:
  - API文档完善（Swagger）
  - 用户手册编写
  - 开发文档完善
- **预计工时**: 20-24小时
- **优先级**: 中

**3.5.2 部署准备**

- **任务**:
  - Docker化
  - CI/CD完善
  - 监控和日志系统
- **预计工时**: 30-40小时
- **优先级**: 高

### 第三阶段里程碑

- [ ] 测试覆盖率：后端≥80%，前端≥75%
- [ ] 所有模块完成度≥85%
- [ ] 性能指标达标
- [ ] 生产环境就绪

### 第三阶段验收标准

1. **测试覆盖率**: 后端≥80%，前端≥75%
2. **功能完整度**: 所有模块完成度≥85%
3. **性能**: API响应时间<500ms，页面加载时间<3s
4. **生产就绪**: 文档完善，部署流程清晰

---

## 风险与应对

### 高风险项

1. **BPMN适配器修复复杂度**
   - **风险**: 可能需要更换BPMN引擎库
   - **应对**: 提前评估替代方案，准备回退计划

2. **测试覆盖率提升时间**
   - **风险**: 测试编写耗时可能超出预期
   - **应对**: 优先核心模块，使用测试生成工具

3. **设计系统统一影响**
   - **风险**: 可能影响现有UI
   - **应对**: 渐进式迁移，充分测试

### 中风险项

1. **DTO字段对齐影响范围**
   - **风险**: 可能影响多个模块
   - **应对**: 建立字段映射表，批量修复

2. **性能优化复杂度**
   - **风险**: 优化可能引入新问题
   - **应对**: 充分测试，建立性能基准

---

## 资源需求

### 人员配置

- **后端开发**: 1-2人，专注P0修复和测试
- **前端开发**: 1-2人，专注P0修复和UI统一
- **测试工程师**: 1人，专注测试用例编写
- **QA工程师**: 1人，专注功能测试和验收

### 时间估算

- **第一阶段**: 1-2周（紧急修复）
- **第二阶段**: 3-4周（功能完善）
- **第三阶段**: 5-8周（全面优化）
- **总计**: 9-14周（2-3.5个月）

### 工具需求

- **测试工具**: Jest, Go test, Playwright
- **代码质量**: ESLint, TypeScript, Go vet
- **CI/CD**: GitHub Actions / GitLab CI
- **监控**: 日志和性能监控工具

---

## 成功指标

### 第一阶段指标

- ✅ 编译错误：0
- ✅ TypeScript错误：0
- ✅ 核心测试通过率：≥80%
- ✅ P0问题：全部解决

### 第二阶段指标

- ✅ 测试覆盖率：后端≥70%，前端≥60%
- ✅ 核心模块完成度：≥90%
- ✅ 代码规范统一：100%
- ✅ 用户体验评分：≥4.0/5.0

### 第三阶段指标

- ✅ 测试覆盖率：后端≥80%，前端≥75%
- ✅ 所有模块完成度：≥85%
- ✅ 性能指标：API<500ms，页面<3s
- ✅ 生产就绪度：100%

---

## 每周进度跟踪

### 周报模板

**第X周进度报告**

**完成情况**:

- [ ] P0问题修复进度
- [ ] 测试覆盖率变化
- [ ] 功能模块完成度
- [ ] 代码质量指标

**遇到的问题**:

- 问题描述
- 影响评估
- 解决方案

**下周计划**:

- 具体任务
- 预期成果
- 风险提示

---

## 附录

### A. 优先级定义

- **P0（阻塞）**: 必须立即修复，影响系统运行
- **P1（高）**: 尽快修复，影响功能完整性
- **P2（中）**: 计划修复，影响代码质量
- **P3（低）**: 后续优化，影响用户体验

### B. 完成度计算标准

- **后端完成度**: (已实现功能数 / 计划功能数) × 100%
- **前端完成度**: (已实现页面/组件数 / 计划页面/组件数) × 100%
- **测试覆盖率**: (已测试代码行数 / 总代码行数) × 100%

### C. 参考文档

- `test/module-development-status.md` - 模块开发状态
- `test/system-testing-report.md` - 系统测试报告
- `test/project-testing-review.md` - 项目测试回顾
- `test/test-improvements-report.md` - 测试改进报告

---

**计划制定日期**: 2025-12-07  
**计划审查周期**: 每周  
**下次审查日期**: 2025-12-14
