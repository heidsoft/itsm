# ITSM系统 - 工单管理模块开发任务清单

## 文档信息

- **文档版本**: v1.0
- **创建日期**: 2024-12-19
- **基于PRD**: PRD-工单管理模块.md v1.0
- **预计总工期**: 6周（第一阶段2周 + 第二阶段2周 + 第三阶段2周）

---

## 任务统计

| 优先级 | 任务数 | 预计工作量 | 状态 |
|--------|--------|-----------|------|
| P0-紧急修复 | 6 | 8小时 | 进行中 |
| P0-核心功能 | 8 | 9人天 | 部分完成 |
| P1-重要功能 | 4 | 7人天 | 部分完成 |
| P2-增强功能 | 6 | 10人天 | 待开始 |
| **总计** | **24** | **26人天+8小时** | **进行中** |

### 已完成任务

- ✅ TASK-TICKET-015: 工单高级筛选和视图后端API开发
- ✅ TASK-TICKET-016: 工单高级筛选和视图前端开发
- ✅ TASK-TICKET-009: 智能分配系统后端API开发
- ✅ TASK-TICKET-010: 智能分配系统前端开发
- ✅ TASK-TICKET-013: 工单自动化规则引擎后端开发
- ✅ TASK-TICKET-014: 工单自动化规则前端开发
- ✅ TASK-FIX-002: 添加错误边界保护
- ✅ TASK-FIX-004: 修复Ant Design API弃用警告

### 紧急修复任务（进行中）

- 🔄 TASK-FIX-001: 完善空值处理（部分完成）
- ⏳ TASK-FIX-003: 统一API响应处理（待开始）
- ⏳ TASK-FIX-005: 完善TypeScript类型定义（待开始）
- ⏳ TASK-FIX-006: 添加加载状态和错误提示（待开始）

### 待开发P0核心功能

- ⏳ TASK-TICKET-001: 工单评论系统后端API开发
- ⏳ TASK-TICKET-002: 工单评论系统前端开发
- ⏳ TASK-TICKET-003: 工单附件管理后端API开发
- ⏳ TASK-TICKET-004: 工单附件管理前端开发
- ⏳ TASK-TICKET-005: 工单通知系统后端API开发
- ⏳ TASK-TICKET-006: 工单通知系统前端开发
- ⏳ TASK-TICKET-007: 工单评分系统后端API开发
- ⏳ TASK-TICKET-008: 工单评分系统前端开发

---

## 第一阶段：P0核心功能开发（2周，9人天）

### 模块1：工单评论系统（2天）

#### TASK-TICKET-001: 工单评论系统后端API开发

- **模块**: 工单管理
- **类型**: 后端开发
- **优先级**: P0
- **工作量**: 1天
- **负责人**: [待分配]
- **描述**: 开发工单评论系统后端API，支持公开评论和内部备注
- **API接口**:
  - `GET /api/v1/tickets/:id/comments` - 获取工单评论列表
  - `POST /api/v1/tickets/:id/comments` - 添加评论
  - `PUT /api/v1/tickets/:id/comments/:comment_id` - 更新评论
  - `DELETE /api/v1/tickets/:id/comments/:comment_id` - 删除评论
- **验收标准**:
  - [ ] 支持添加公开评论和内部备注
  - [ ] 支持@用户功能（存储@的用户列表）
  - [ ] 支持评论编辑和删除（权限控制）
  - [ ] 支持评论附件关联
  - [ ] 评论列表按时间倒序返回
- **依赖**: 无

#### TASK-TICKET-002: 工单评论系统前端开发

- **模块**: 工单管理
- **类型**: 前端开发
- **优先级**: P0
- **工作量**: 1天
- **负责人**: [待分配]
- **描述**: 开发工单评论系统前端界面
- **页面路径**: `/tickets/:id` (工单详情页)
- **验收标准**:
  - [ ] 工单详情页显示评论列表
  - [ ] 支持添加评论（富文本编辑器）
  - [ ] 支持@用户选择（用户选择器）
  - [ ] 支持内部备注开关
  - [ ] 评论支持编辑和删除
  - [ ] 评论列表按时间倒序显示
  - [ ] @用户时发送通知
- **依赖**: TASK-TICKET-001

---

### 模块2：工单附件管理（2天）

#### TASK-TICKET-003: 工单附件管理后端API开发

- **模块**: 工单管理
- **类型**: 后端开发
- **优先级**: P0
- **工作量**: 1天
- **负责人**: [待分配]
- **描述**: 开发工单附件管理后端API
- **API接口**:
  - `POST /api/v1/tickets/:id/attachments` - 上传附件
  - `GET /api/v1/tickets/:id/attachments` - 获取附件列表
  - `GET /api/v1/tickets/:id/attachments/:attachment_id` - 下载附件
  - `GET /api/v1/tickets/:id/attachments/:attachment_id/preview` - 预览附件
  - `DELETE /api/v1/tickets/:id/attachments/:attachment_id` - 删除附件
- **验收标准**:
  - [ ] 支持多文件上传
  - [ ] 附件大小限制（可配置，默认10MB）
  - [ ] 附件类型限制（可配置白名单）
  - [ ] 附件存储到OSS或本地存储
  - [ ] 支持附件下载
  - [ ] 支持附件预览（图片、PDF、Office文档）
  - [ ] 附件信息记录（文件名、大小、类型、上传人、上传时间）
- **依赖**: 无

#### TASK-TICKET-004: 工单附件管理前端开发

- **模块**: 工单管理
- **类型**: 前端开发
- **优先级**: P0
- **工作量**: 1天
- **负责人**: [待分配]
- **描述**: 开发工单附件管理前端界面
- **页面路径**: `/tickets/:id` (工单详情页), `/tickets/create` (创建工单页)
- **验收标准**:
  - [ ] 工单创建和编辑时支持上传附件
  - [ ] 支持拖拽上传
  - [ ] 支持多文件上传
  - [ ] 显示上传进度
  - [ ] 附件列表展示（文件名、大小、上传人、上传时间）
  - [ ] 支持附件预览（图片、PDF、Office文档）
  - [ ] 支持附件下载
  - [ ] 支持附件删除（权限控制）
- **依赖**: TASK-TICKET-003

---

### 模块3：工单通知系统（3天）

#### TASK-TICKET-005: 工单通知系统后端API开发

- **模块**: 工单管理
- **类型**: 后端开发
- **优先级**: P0
- **工作量**: 1.5天
- **负责人**: [待分配]
- **描述**: 开发工单通知系统后端API
- **API接口**:
  - `POST /api/v1/tickets/:id/notifications` - 发送通知
  - `GET /api/v1/tickets/:id/notifications` - 获取通知列表
  - `PUT /api/v1/notifications/:id/read` - 标记通知为已读
  - `GET /api/v1/notifications` - 获取用户通知列表
  - `PUT /api/v1/users/:id/notification-preferences` - 更新通知偏好
- **验收标准**:
  - [ ] 工单创建时自动发送通知给处理人
  - [ ] 工单状态变更时通知申请人和处理人
  - [ ] 工单分配时通知新处理人
  - [ ] 工单评论时通知相关人员（包括@的用户）
  - [ ] SLA即将到期时发送提醒（可配置提前时间）
  - [ ] 支持邮件通知（SMTP集成）
  - [ ] 支持站内消息通知
  - [ ] 支持通知模板配置
  - [ ] 支持用户通知偏好设置（邮件/站内消息开关）
  - [ ] 通知记录存储到数据库
- **依赖**: 无

#### TASK-TICKET-006: 工单通知系统前端开发

- **模块**: 工单管理
- **类型**: 前端开发
- **优先级**: P0
- **工作量**: 1.5天
- **负责人**: [待分配]
- **描述**: 开发工单通知系统前端界面
- **页面路径**: `/notifications` (通知中心), `/tickets/:id` (工单详情页)
- **验收标准**:
  - [ ] 通知中心页面（显示未读/已读通知）
  - [ ] 通知列表支持筛选和搜索
  - [ ] 支持标记通知为已读
  - [ ] 支持批量标记已读
  - [ ] 通知详情页（显示通知内容）
  - [ ] 用户通知偏好设置页面
  - [ ] 工单详情页显示通知历史
  - [ ] 实时通知提醒（WebSocket或轮询）
- **依赖**: TASK-TICKET-005

---

### 模块4：工单评分系统（2天）

#### TASK-TICKET-007: 工单评分系统后端API开发

- **模块**: 工单管理
- **类型**: 后端开发
- **优先级**: P0
- **工作量**: 1天
- **负责人**: [待分配]
- **描述**: 开发工单评分系统后端API
- **API接口**:
  - `POST /api/v1/tickets/:id/rating` - 提交评分
  - `GET /api/v1/tickets/:id/rating` - 获取工单评分
  - `GET /api/v1/tickets/rating-stats` - 获取评分统计
- **验收标准**:
  - [ ] 工单解决后允许申请人评分
  - [ ] 支持1-5星评分
  - [ ] 支持评分评论
  - [ ] 评分后发送通知给处理人
  - [ ] 支持评分统计分析（平均分、评分分布等）
  - [ ] 支持按处理人、分类等维度统计评分
  - [ ] 评分数据存储在工单表中
- **依赖**: 无

#### TASK-TICKET-008: 工单评分系统前端开发

- **模块**: 工单管理
- **类型**: 前端开发
- **优先级**: P0
- **工作量**: 1天
- **负责人**: [待分配]
- **描述**: 开发工单评分系统前端界面
- **页面路径**: `/tickets/:id` (工单详情页), `/tickets/rating-stats` (评分统计页)
- **验收标准**:
  - [ ] 工单解决后显示评分入口（仅申请人可见）
  - [ ] 评分表单（1-5星选择、评论输入）
  - [ ] 评分提交后显示感谢信息
  - [ ] 已评分工单显示评分信息
  - [ ] 评分统计页面（平均分、评分分布图表）
  - [ ] 支持按处理人、分类等维度查看评分统计
- **依赖**: TASK-TICKET-007

---

## 第二阶段：P1重要功能开发（2周，11人天）

### 模块5：智能分配系统（3天）

#### TASK-TICKET-009: 智能分配系统后端API开发

- **模块**: 工单管理
- **类型**: 后端开发
- **优先级**: P1
- **工作量**: 1.5天
- **负责人**: [已完成]
- **状态**: ✅ 已完成
- **描述**: 开发智能分配系统后端API
- **API接口**:
  - `POST /api/v1/tickets/:id/auto-assign` - 自动分配工单
  - `GET /api/v1/tickets/assign-recommendations/:id` - 获取分配推荐
  - `GET /api/v1/tickets/assignment-rules` - 获取分配规则列表
  - `POST /api/v1/tickets/assignment-rules` - 创建分配规则
  - `PUT /api/v1/tickets/assignment-rules/:id` - 更新分配规则
- **验收标准**:
  - [ ] 支持基于工单分类和技能矩阵自动分配
  - [ ] 支持基于当前工作负载分配（优先分配给空闲人员）
  - [ ] 支持基于历史处理记录推荐（推荐处理过类似工单的人员）
  - [ ] 支持分配规则配置（规则引擎）
  - [ ] 支持规则优先级设置
  - [ ] 支持规则测试功能
- **依赖**: 团队管理模块、技能矩阵模块

#### TASK-TICKET-010: 智能分配系统前端开发

- **模块**: 工单管理
- **类型**: 前端开发
- **优先级**: P1
- **工作量**: 1.5天
- **负责人**: [已完成]
- **状态**: ✅ 已完成
- **描述**: 开发智能分配系统前端界面
- **页面路径**: `/tickets/:id` (工单详情页), `/admin/tickets/assignment-rules` (分配规则配置页)
- **验收标准**:
  - [x] 工单详情页显示"智能分配"按钮
  - [x] 智能分配时显示推荐处理人列表（带推荐理由）
  - [x] 分配规则配置页面（规则列表、创建/编辑规则）
  - [x] 规则配置表单（条件设置、动作设置、优先级设置）
  - [x] 支持规则测试功能
  - [x] 支持手动分配和自动分配切换
- **依赖**: TASK-TICKET-009
- **实现文件**:
  - `lib/api/ticket-assignment-api.ts` - 智能分配API客户端
  - `components/business/SmartAssignmentModal.tsx` - 智能分配模态框组件
  - `components/business/AssignmentRuleForm.tsx` - 分配规则表单组件
  - `app/(main)/admin/tickets/assignment-rules/page.tsx` - 分配规则管理页面
  - `components/business/TicketDetail.tsx` - 集成智能分配功能

---

### 模块6：工单知识库关联（2天）

#### TASK-TICKET-011: 工单知识库关联后端API开发

- **模块**: 工单管理
- **类型**: 后端开发
- **优先级**: P1
- **工作量**: 1天
- **负责人**: [待分配]
- **描述**: 开发工单知识库关联后端API
- **API接口**:
  - `POST /api/v1/tickets/:id/create-knowledge` - 从工单创建知识库条目
  - `GET /api/v1/tickets/:id/recommended-knowledge` - 获取推荐知识库文章
  - `GET /api/v1/tickets/:id/similar-tickets` - 获取类似工单（历史解决方案）
  - `POST /api/v1/tickets/:id/link-knowledge/:knowledge_id` - 关联知识库文章
- **验收标准**:
  - [ ] 工单解决时可以创建知识库条目
  - [ ] 创建工单时基于关键词推荐相关文章
  - [ ] 处理工单时可以查看历史类似工单的解决方案
  - [ ] 支持解决方案模板
  - [ ] 知识库文章可以关联到工单分类
- **依赖**: 知识库模块

#### TASK-TICKET-012: 工单知识库关联前端开发

- **模块**: 工单管理
- **类型**: 前端开发
- **优先级**: P1
- **工作量**: 1天
- **负责人**: [待分配]
- **描述**: 开发工单知识库关联前端界面
- **页面路径**: `/tickets/:id` (工单详情页), `/tickets/create` (创建工单页)
- **验收标准**:
  - [ ] 工单解决时显示"创建知识库条目"按钮
  - [ ] 创建知识库条目表单（标题、内容、分类等）
  - [ ] 创建工单时显示推荐知识库文章列表
  - [ ] 处理工单时显示历史类似工单列表
  - [ ] 支持查看历史工单的解决方案
  - [ ] 支持关联知识库文章到工单
- **依赖**: TASK-TICKET-011

---

### 模块7：工单自动化规则（4天）

#### TASK-TICKET-013: 工单自动化规则引擎后端开发

- **模块**: 工单管理
- **类型**: 后端开发
- **优先级**: P1
- **工作量**: 2天
- **负责人**: [已完成]
- **状态**: ✅ 已完成
- **描述**: 开发工单自动化规则引擎后端
- **API接口**:
  - `GET /api/v1/tickets/automation-rules` - 获取自动化规则列表
  - `POST /api/v1/tickets/automation-rules` - 创建自动化规则
  - `PUT /api/v1/tickets/automation-rules/:id` - 更新自动化规则
  - `DELETE /api/v1/tickets/automation-rules/:id` - 删除自动化规则
  - `POST /api/v1/tickets/automation-rules/:id/test` - 测试规则
- **验收标准**:
  - [x] 支持规则引擎配置
  - [x] 支持基于条件自动分类
  - [x] 支持基于条件自动分配
  - [x] 支持基于条件自动升级
  - [x] 支持规则优先级设置
  - [x] 支持规则测试功能
  - [x] 规则触发时记录日志
- **依赖**: 无
- **实现文件**:
  - `ent/schema/ticket_automation_rule.go` - 数据库schema
  - `dto/ticket_automation_rule_dto.go` - 数据传输对象
  - `service/ticket_automation_rule_service.go` - 业务逻辑层（规则引擎）
  - `controller/ticket_automation_rule_controller.go` - 控制器层
  - `router/ticket_routes.go` - 路由配置
  - `service/ticket_service.go` - 集成规则执行（工单创建/更新时自动触发）

#### TASK-TICKET-014: 工单自动化规则前端开发

- **模块**: 工单管理
- **类型**: 前端开发
- **优先级**: P1
- **工作量**: 2天
- **负责人**: [已完成]
- **状态**: ✅ 已完成
- **描述**: 开发工单自动化规则前端界面
- **页面路径**: `/admin/tickets/automation-rules` (自动化规则配置页)
- **验收标准**:
  - [x] 自动化规则列表页面
  - [x] 规则创建/编辑表单（条件设置、动作设置、优先级）
  - [x] 支持规则启用/禁用
  - [x] 支持规则测试功能
  - [x] 规则执行历史记录
  - [x] 规则可视化配置界面
- **依赖**: TASK-TICKET-013
- **实现文件**:
  - `lib/api/ticket-automation-rule-api.ts` - 自动化规则API客户端
  - `components/business/AutomationRuleForm.tsx` - 自动化规则表单组件
  - `app/(main)/admin/tickets/automation-rules/page.tsx` - 自动化规则管理页面

---

### 模块8：工单高级筛选和视图（2天）

#### TASK-TICKET-015: 工单高级筛选和视图后端API开发

- **模块**: 工单管理
- **类型**: 后端开发
- **优先级**: P1
- **工作量**: 1天
- **负责人**: [已完成]
- **状态**: ✅ 已完成
- **描述**: 开发工单高级筛选和视图后端API
- **API接口**:
  - `GET /api/v1/tickets/views` - 获取保存的视图列表
  - `POST /api/v1/tickets/views` - 创建视图
  - `PUT /api/v1/tickets/views/:id` - 更新视图
  - `DELETE /api/v1/tickets/views/:id` - 删除视图
  - `POST /api/v1/tickets/views/:id/share` - 共享视图
- **验收标准**:
  - [x] 支持保存筛选条件为视图
  - [x] 支持视图字段配置（选择显示的列）
  - [x] 支持视图排序和分组配置
  - [x] 支持视图共享给团队
  - [x] 视图数据存储在数据库
- **依赖**: 无
- **实现文件**:
  - `ent/schema/ticket_view.go` - 数据库schema
  - `dto/ticket_view_dto.go` - 数据传输对象
  - `service/ticket_view_service.go` - 业务逻辑层
  - `controller/ticket_view_controller.go` - 控制器层
  - `router/ticket_routes.go` - 路由配置

#### TASK-TICKET-016: 工单高级筛选和视图前端开发

- **模块**: 工单管理
- **类型**: 前端开发
- **优先级**: P1
- **工作量**: 1天
- **负责人**: [已完成]
- **状态**: ✅ 已完成
- **描述**: 开发工单高级筛选和视图前端界面
- **页面路径**: `/tickets` (工单列表页)
- **验收标准**:
  - [x] 高级筛选器（多条件组合）
  - [x] 支持保存筛选条件为视图
  - [x] 视图选择器（切换不同视图）
  - [x] 自定义视图配置（选择显示的列）
  - [x] 视图排序和分组设置
  - [x] 视图共享功能
  - [x] 视图管理页面（创建/编辑/删除视图）
- **依赖**: TASK-TICKET-015
- **实现文件**:
  - `lib/api/ticket-view-api.ts` - 视图API客户端
  - `components/business/TicketViewSelector.tsx` - 视图选择器组件
  - `components/business/TicketFilters.tsx` - 集成视图功能的筛选器组件
  - `app/(main)/tickets/page.tsx` - 工单列表页面集成

---

---

### 模块10：工单预测分析（3天）

#### TASK-TICKET-018: 工单预测分析后端API开发

- **模块**: 工单管理
- **类型**: 后端开发
- **优先级**: P2
- **工作量**: 1.5天
- **负责人**: [待分配]
- **描述**: 开发工单预测分析后端API
- **API接口**:
  - `GET /api/v1/tickets/predictions/volume` - 获取工单量预测
  - `GET /api/v1/tickets/predictions/trend` - 获取工单趋势预测
  - `GET /api/v1/tickets/predictions/resource` - 获取资源需求预测
  - `GET /api/v1/tickets/predictions/report` - 获取预测报告
- **验收标准**:
  - [ ] 支持基于历史数据预测未来工单量
  - [ ] 支持预测工单趋势（增长/下降）
  - [ ] 支持预测资源需求（需要多少人处理）
  - [ ] 使用时间序列分析算法
  - [ ] 预测结果包含置信区间
- **依赖**: 无

#### TASK-TICKET-019: 工单预测分析前端开发

- **模块**: 工单管理
- **类型**: 前端开发
- **优先级**: P2
- **工作量**: 1.5天
- **负责人**: [待分配]
- **描述**: 开发工单预测分析前端界面
- **页面路径**: `/tickets/predictions` (工单预测分析页)
- **验收标准**:
  - [ ] 工单量预测图表（折线图）
  - [ ] 工单趋势预测图表
  - [ ] 资源需求预测图表
  - [ ] 预测报告展示
  - [ ] 支持时间范围选择
  - [ ] 支持预测参数调整
- **依赖**: TASK-TICKET-018

---

### 模块11：多语言支持（2天）

#### TASK-TICKET-020: 工单模块多语言支持

- **模块**: 工单管理
- **类型**: 前端开发
- **优先级**: P2
- **工作量**: 2天
- **负责人**: [待分配]
- **描述**: 为工单模块添加多语言支持
- **验收标准**:
  - [ ] 支持中英文切换
  - [ ] 工单模块所有文本支持多语言
  - [ ] 支持多语言通知模板
  - [ ] 支持语言包扩展
  - [ ] 语言切换后界面正常显示
- **依赖**: 系统国际化框架

---

## 任务依赖关系图

```
第一阶段（P0）:
TASK-TICKET-001 → TASK-TICKET-002
TASK-TICKET-003 → TASK-TICKET-004
TASK-TICKET-005 → TASK-TICKET-006
TASK-TICKET-007 → TASK-TICKET-008

第二阶段（P1）:
TASK-TICKET-009 → TASK-TICKET-010
TASK-TICKET-011 → TASK-TICKET-012
TASK-TICKET-013 → TASK-TICKET-014
TASK-TICKET-015 → TASK-TICKET-016

第三阶段（P2）:
TASK-TICKET-018 → TASK-TICKET-019
```

---

## 开发建议

### 技术选型建议

1. **附件存储**: 建议使用OSS（阿里云OSS/腾讯云COS）存储附件，支持CDN加速
2. **附件预览**: 建议使用在线预览服务（如OnlyOffice、Office Online）
3. **通知系统**: 建议使用消息队列（RabbitMQ/Kafka）异步处理通知
4. **规则引擎**: 建议使用成熟的规则引擎库（如Go的grule、JavaScript的json-rules-engine）
5. **预测分析**: 建议使用时间序列分析库（如Prophet、ARIMA）

### 开发顺序建议

1. **先开发后端API**，再开发前端界面
2. **先开发核心功能（P0）**，再开发重要功能（P1），最后开发增强功能（P2）
3. **先开发基础功能**，再开发依赖功能（如先开发评论系统，再开发通知系统中的评论通知）

### 测试建议

- 每个功能开发完成后进行单元测试
- 前后端联调测试
- 集成测试
- 用户验收测试（UAT）

---

## 版本历史

| 版本 | 日期 | 作者 | 说明 |
|------|------|------|------|
| v1.0 | 2024-12-19 | [待填写] | 初始版本 |
