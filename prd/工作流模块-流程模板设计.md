# 工作流模块 - 流程模板设计

## 1. 模板概述

### 1.1 模板分类

| 分类 | 模板名称 | 复杂度 | 适用场景 |
|-----|---------|--------|---------|
| 工单管理 | 标准工单审批流程 | 中等 | 普通工单审批 |
| 工单管理 | 紧急工单处理流程 | 简单 | 紧急工单快速处理 |
| 工单管理 | 复杂工单多级审批 | 复杂 | 重要工单多级审批 |
| 变更管理 | 标准变更流程 | 中等 | 普通变更管理 |
| 变更管理 | 紧急变更流程 | 简单 | 紧急变更快速处理 |
| 变更管理 | 重大变更流程 | 复杂 | 重大变更完整流程 |
| 服务请求 | 服务申请审批流程 | 中等 | 服务请求审批 |
| 服务请求 | 资源交付流程 | 复杂 | 自动化资源交付 |
| 事件管理 | 事件响应流程 | 中等 | 事件处理 |
| 问题管理 | 问题调查流程 | 复杂 | 问题根因调查 |

### 1.2 模板命名规范

```
{模块}_{场景}_{复杂度}_{版本}
例如：
- ticket_approval_standard_v1.0
- change_emergency_simple_v1.0
- service_request_approval_medium_v1.0
```

## 2. 工单管理流程模板

### 2.1 标准工单审批流程

#### 2.1.1 流程描述

适用于普通工单的标准审批流程，包含部门主管审批和IT审批两个环节。

#### 2.1.2 流程步骤

1. **开始**：工单创建后自动启动
2. **部门主管审批**：申请人所在部门主管审批
3. **IT审批**：IT部门技术人员审批
4. **结束**：审批完成，更新工单状态

#### 2.1.3 BPMN XML定义

```xml
<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                  id="Definitions_1"
                  targetNamespace="http://bpmn.io/schema/bpmn">
  
  <bpmn:process id="ticket_approval_standard" name="标准工单审批流程" isExecutable="true">
    
    <!-- 开始事件 -->
    <bpmn:startEvent id="StartEvent_1" name="工单创建">
      <bpmn:outgoing>Flow_1</bpmn:outgoing>
    </bpmn:startEvent>
    
    <!-- 部门主管审批任务 -->
    <bpmn:userTask id="ManagerApproval" name="部门主管审批">
      <bpmn:extensionElements>
        <camunda:assignee>${assigneeService.getManagerByDepartment(requester_department)}</camunda:assignee>
        <camunda:formKey>ticket_approval_form</camunda:formKey>
        <camunda:dueDate>P1D</camunda:dueDate>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1</bpmn:incoming>
      <bpmn:outgoing>Flow_2</bpmn:outgoing>
    </bpmn:userTask>
    
    <!-- 排他网关：判断审批结果 -->
    <bpmn:exclusiveGateway id="Gateway_ApprovalResult" name="审批结果">
      <bpmn:incoming>Flow_2</bpmn:incoming>
      <bpmn:outgoing>Flow_Approved</bpmn:outgoing>
      <bpmn:outgoing>Flow_Rejected</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    
    <!-- 审批通过路径 -->
    <bpmn:sequenceFlow id="Flow_Approved" sourceRef="Gateway_ApprovalResult" targetRef="ITApproval">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">
        ${approval_result == 'approved'}
      </bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    
    <!-- IT审批任务 -->
    <bpmn:userTask id="ITApproval" name="IT审批">
      <bpmn:extensionElements>
        <camunda:candidateGroups>IT_Department</camunda:candidateGroups>
        <camunda:formKey>ticket_it_approval_form</camunda:formKey>
        <camunda:dueDate>P2D</camunda:dueDate>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_Approved</bpmn:incoming>
      <bpmn:outgoing>Flow_3</bpmn:outgoing>
    </bpmn:userTask>
    
    <!-- 审批拒绝路径 -->
    <bpmn:sequenceFlow id="Flow_Rejected" sourceRef="Gateway_ApprovalResult" targetRef="EndEvent_Rejected">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">
        ${approval_result == 'rejected'}
      </bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    
    <!-- 结束事件 - 通过 -->
    <bpmn:endEvent id="EndEvent_Approved" name="审批通过">
      <bpmn:incoming>Flow_3</bpmn:incoming>
    </bpmn:endEvent>
    
    <!-- 结束事件 - 拒绝 -->
    <bpmn:endEvent id="EndEvent_Rejected" name="审批拒绝">
      <bpmn:incoming>Flow_Rejected</bpmn:incoming>
    </bpmn:endEvent>
    
    <!-- 连接线 -->
    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="ManagerApproval"/>
    <bpmn:sequenceFlow id="Flow_2" sourceRef="ManagerApproval" targetRef="Gateway_ApprovalResult"/>
    <bpmn:sequenceFlow id="Flow_3" sourceRef="ITApproval" targetRef="EndEvent_Approved"/>
    
  </bpmn:process>
  
</bpmn:definitions>
```

#### 2.1.4 JSON定义（简单工作流）

```json
{
  "name": "标准工单审批流程",
  "type": "ticket",
  "version": "1.0.0",
  "steps": [
    {
      "id": "start",
      "name": "开始",
      "type": "start"
    },
    {
      "id": "manager_approval",
      "name": "部门主管审批",
      "type": "approval",
      "assignee_rule": {
        "type": "expression",
        "expression": "${assigneeService.getManagerByDepartment(requester_department)}"
      },
      "timeout": 1440,
      "form_key": "ticket_approval_form"
    },
    {
      "id": "it_approval",
      "name": "IT审批",
      "type": "approval",
      "candidate_groups": ["IT_Department"],
      "timeout": 2880,
      "form_key": "ticket_it_approval_form"
    },
    {
      "id": "end",
      "name": "结束",
      "type": "end"
    }
  ],
  "transitions": [
    {
      "id": "t1",
      "from_step": "start",
      "to_step": "manager_approval",
      "auto": true
    },
    {
      "id": "t2",
      "from_step": "manager_approval",
      "to_step": "it_approval",
      "condition": {
        "type": "field",
        "field": "approval_result",
        "operator": "equals",
        "value": "approved"
      }
    },
    {
      "id": "t3",
      "from_step": "manager_approval",
      "to_step": "end",
      "condition": {
        "type": "field",
        "field": "approval_result",
        "operator": "equals",
        "value": "rejected"
      }
    },
    {
      "id": "t4",
      "from_step": "it_approval",
      "to_step": "end",
      "auto": true
    }
  ],
  "variables": {
    "ticket_id": {
      "type": "integer",
      "required": true
    },
    "requester_department": {
      "type": "string",
      "required": true
    },
    "approval_result": {
      "type": "string",
      "enum": ["approved", "rejected"]
    }
  }
}
```

#### 2.1.5 流程变量定义

```json
{
  "ticket_id": {
    "type": "integer",
    "description": "工单ID",
    "required": true
  },
  "requester_id": {
    "type": "integer",
    "description": "申请人ID",
    "required": true
  },
  "requester_department": {
    "type": "string",
    "description": "申请人部门",
    "required": true
  },
  "priority": {
    "type": "string",
    "description": "优先级",
    "enum": ["low", "medium", "high", "critical"]
  },
  "approval_result": {
    "type": "string",
    "description": "审批结果",
    "enum": ["approved", "rejected"]
  },
  "approval_comment": {
    "type": "string",
    "description": "审批意见"
  }
}
```

#### 2.1.6 使用说明

1. **触发条件**：工单创建时，如果工单类型需要审批，自动启动此流程
2. **配置要求**：
   - 需要配置部门主管分配规则
   - 需要配置IT部门组
   - 需要创建审批表单
3. **超时处理**：
   - 部门主管审批：24小时超时，自动升级
   - IT审批：48小时超时，发送提醒

### 2.2 紧急工单处理流程

#### 2.2.1 流程描述

适用于紧急工单的快速处理流程，跳过部门主管审批，直接进入IT处理。

#### 2.2.2 流程步骤

1. **开始**：紧急工单创建
2. **IT直接处理**：IT人员直接处理，无需审批
3. **结束**：处理完成

#### 2.2.3 JSON定义

```json
{
  "name": "紧急工单处理流程",
  "type": "ticket",
  "version": "1.0.0",
  "steps": [
    {
      "id": "start",
      "name": "开始",
      "type": "start"
    },
    {
      "id": "it_process",
      "name": "IT处理",
      "type": "task",
      "candidate_groups": ["IT_Department"],
      "timeout": 240,
      "priority": "high"
    },
    {
      "id": "end",
      "name": "结束",
      "type": "end"
    }
  ],
  "transitions": [
    {
      "id": "t1",
      "from_step": "start",
      "to_step": "it_process",
      "auto": true
    },
    {
      "id": "t2",
      "from_step": "it_process",
      "to_step": "end",
      "auto": true
    }
  ]
}
```

### 2.3 复杂工单多级审批流程

#### 2.3.1 流程描述

适用于重要工单的多级审批流程，包含部门主管、IT主管、安全部门三级审批，支持并行审批。

#### 2.3.2 流程步骤

1. **开始**：工单创建
2. **部门主管审批**：第一级审批
3. **并行网关**：分叉到IT和安全审批
4. **IT主管审批**：IT部门审批
5. **安全部门审批**：安全部门审批
6. **并行网关合并**：等待所有审批完成
7. **结束**：审批完成

#### 2.3.3 BPMN XML定义（关键部分）

```xml
<!-- 并行网关 - 分叉 -->
<bpmn:parallelGateway id="Gateway_ParallelSplit" name="并行审批">
  <bpmn:incoming>Flow_AfterManager</bpmn:incoming>
  <bpmn:outgoing>Flow_ToIT</bpmn:outgoing>
  <bpmn:outgoing>Flow_ToSecurity</bpmn:outgoing>
</bpmn:parallelGateway>

<!-- IT主管审批 -->
<bpmn:userTask id="ITManagerApproval" name="IT主管审批">
  <bpmn:extensionElements>
    <camunda:candidateGroups>IT_Manager</camunda:candidateGroups>
  </bpmn:extensionElements>
  <bpmn:incoming>Flow_ToIT</bpmn:incoming>
  <bpmn:outgoing>Flow_ToMerge</bpmn:outgoing>
</bpmn:userTask>

<!-- 安全部门审批 -->
<bpmn:userTask id="SecurityApproval" name="安全部门审批">
  <bpmn:extensionElements>
    <camunda:candidateGroups>Security_Department</camunda:candidateGroups>
  </bpmn:extensionElements>
  <bpmn:incoming>Flow_ToSecurity</bpmn:incoming>
  <bpmn:outgoing>Flow_ToMerge2</bpmn:outgoing>
</bpmn:userTask>

<!-- 并行网关 - 合并 -->
<bpmn:parallelGateway id="Gateway_ParallelMerge" name="等待所有审批">
  <bpmn:incoming>Flow_ToMerge</bpmn:incoming>
  <bpmn:incoming>Flow_ToMerge2</bpmn:incoming>
  <bpmn:outgoing>Flow_ToEnd</bpmn:outgoing>
</bpmn:parallelGateway>
```

## 3. 变更管理流程模板

### 3.1 标准变更流程

#### 3.1.1 流程描述

适用于普通变更的标准流程，包含变更申请、评估、审批、实施、回顾五个阶段。

#### 3.1.2 流程步骤

1. **开始**：变更申请创建
2. **变更评估**：评估变更影响和风险
3. **变更审批**：变更委员会审批
4. **变更实施**：执行变更
5. **变更回顾**：回顾变更结果
6. **结束**：流程完成

#### 3.1.3 JSON定义

```json
{
  "name": "标准变更流程",
  "type": "change",
  "version": "1.0.0",
  "steps": [
    {
      "id": "start",
      "name": "变更申请",
      "type": "start"
    },
    {
      "id": "change_assessment",
      "name": "变更评估",
      "type": "task",
      "candidate_groups": ["Change_Management_Team"],
      "timeout": 2880,
      "form_key": "change_assessment_form"
    },
    {
      "id": "change_approval",
      "name": "变更审批",
      "type": "approval",
      "candidate_groups": ["Change_Advisory_Board"],
      "timeout": 4320,
      "form_key": "change_approval_form"
    },
    {
      "id": "change_implementation",
      "name": "变更实施",
      "type": "task",
      "assignee_rule": {
        "type": "field",
        "field": "implementer_id"
      },
      "timeout": 14400
    },
    {
      "id": "change_review",
      "name": "变更回顾",
      "type": "task",
      "candidate_groups": ["Change_Management_Team"],
      "timeout": 1440,
      "form_key": "change_review_form"
    },
    {
      "id": "end",
      "name": "结束",
      "type": "end"
    }
  ],
  "transitions": [
    {
      "id": "t1",
      "from_step": "start",
      "to_step": "change_assessment",
      "auto": true
    },
    {
      "id": "t2",
      "from_step": "change_assessment",
      "to_step": "change_approval",
      "condition": {
        "type": "field",
        "field": "assessment_result",
        "operator": "equals",
        "value": "approved"
      }
    },
    {
      "id": "t3",
      "from_step": "change_approval",
      "to_step": "change_implementation",
      "condition": {
        "type": "field",
        "field": "approval_result",
        "operator": "equals",
        "value": "approved"
      }
    },
    {
      "id": "t4",
      "from_step": "change_implementation",
      "to_step": "change_review",
      "auto": true
    },
    {
      "id": "t5",
      "from_step": "change_review",
      "to_step": "end",
      "auto": true
    }
  ],
  "variables": {
    "change_id": {
      "type": "integer",
      "required": true
    },
    "change_type": {
      "type": "string",
      "enum": ["standard", "normal", "emergency"]
    },
    "risk_level": {
      "type": "string",
      "enum": ["low", "medium", "high"]
    },
    "assessment_result": {
      "type": "string",
      "enum": ["approved", "rejected", "needs_review"]
    },
    "approval_result": {
      "type": "string",
      "enum": ["approved", "rejected"]
    },
    "implementer_id": {
      "type": "integer"
    }
  }
}
```

### 3.2 紧急变更流程

#### 3.2.1 流程描述

适用于紧急变更的快速流程，简化审批环节，快速实施。

#### 3.2.2 流程步骤

1. **开始**：紧急变更申请
2. **快速评估**：简化的风险评估
3. **紧急审批**：快速审批（缩短时限）
4. **变更实施**：立即实施
5. **事后回顾**：实施后回顾
6. **结束**：流程完成

#### 3.2.3 JSON定义

```json
{
  "name": "紧急变更流程",
  "type": "change",
  "version": "1.0.0",
  "steps": [
    {
      "id": "start",
      "name": "紧急变更申请",
      "type": "start"
    },
    {
      "id": "quick_assessment",
      "name": "快速评估",
      "type": "task",
      "candidate_groups": ["Change_Management_Team"],
      "timeout": 60,
      "priority": "critical"
    },
    {
      "id": "emergency_approval",
      "name": "紧急审批",
      "type": "approval",
      "candidate_users": ["change_manager", "it_manager"],
      "timeout": 120,
      "approval_type": "any_one"
    },
    {
      "id": "implementation",
      "name": "变更实施",
      "type": "task",
      "assignee_rule": {
        "type": "field",
        "field": "implementer_id"
      },
      "timeout": 1440
    },
    {
      "id": "post_review",
      "name": "事后回顾",
      "type": "task",
      "candidate_groups": ["Change_Management_Team"],
      "timeout": 1440
    },
    {
      "id": "end",
      "name": "结束",
      "type": "end"
    }
  ],
  "transitions": [
    {
      "id": "t1",
      "from_step": "start",
      "to_step": "quick_assessment",
      "auto": true
    },
    {
      "id": "t2",
      "from_step": "quick_assessment",
      "to_step": "emergency_approval",
      "auto": true
    },
    {
      "id": "t3",
      "from_step": "emergency_approval",
      "to_step": "implementation",
      "auto": true
    },
    {
      "id": "t4",
      "from_step": "implementation",
      "to_step": "post_review",
      "auto": true
    },
    {
      "id": "t5",
      "from_step": "post_review",
      "to_step": "end",
      "auto": true
    }
  ]
}
```

## 4. 服务请求流程模板

### 4.1 服务申请审批流程

#### 4.1.1 流程描述

适用于服务请求的审批流程，包含部门主管、IT、安全三级审批（与《服务请求审批流程设计》文档一致）。

#### 4.1.2 流程步骤

1. **开始**：服务请求创建
2. **部门主管审批**：第一级审批
3. **IT审批**：第二级审批
4. **条件判断**：是否需要安全审批
5. **安全审批**：第三级审批（如需要）
6. **结束**：审批完成

#### 4.1.3 BPMN XML定义（关键部分）

```xml
<!-- 条件判断：是否需要安全审批 -->
<bpmn:exclusiveGateway id="Gateway_SecurityCheck" name="需要安全审批?">
  <bpmn:incoming>Flow_AfterIT</bpmn:incoming>
  <bpmn:outgoing>Flow_ToSecurity</bpmn:outgoing>
  <bpmn:outgoing>Flow_ToEnd</bpmn:outgoing>
</bpmn:exclusiveGateway>

<!-- 安全审批路径 -->
<bpmn:sequenceFlow id="Flow_ToSecurity" sourceRef="Gateway_SecurityCheck" targetRef="SecurityApproval">
  <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">
    ${needs_public_ip == true || data_classification == 'confidential'}
  </bpmn:conditionExpression>
</bpmn:sequenceFlow>

<!-- 直接结束路径 -->
<bpmn:sequenceFlow id="Flow_ToEnd" sourceRef="Gateway_SecurityCheck" targetRef="EndEvent_Approved">
  <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">
    ${needs_public_ip == false && data_classification != 'confidential'}
  </bpmn:conditionExpression>
</bpmn:sequenceFlow>
```

#### 4.1.4 JSON定义

```json
{
  "name": "服务申请审批流程",
  "type": "service_request",
  "version": "1.0.0",
  "steps": [
    {
      "id": "start",
      "name": "服务请求创建",
      "type": "start"
    },
    {
      "id": "manager_approval",
      "name": "部门主管审批",
      "type": "approval",
      "assignee_rule": {
        "type": "expression",
        "expression": "${assigneeService.getManagerByDepartment(requester_department)}"
      },
      "timeout": 1440
    },
    {
      "id": "it_approval",
      "name": "IT审批",
      "type": "approval",
      "candidate_groups": ["IT_Department"],
      "timeout": 2880
    },
    {
      "id": "security_approval",
      "name": "安全审批",
      "type": "approval",
      "candidate_groups": ["Security_Department"],
      "timeout": 4320,
      "conditional": true
    },
    {
      "id": "end",
      "name": "审批完成",
      "type": "end"
    }
  ],
  "transitions": [
    {
      "id": "t1",
      "from_step": "start",
      "to_step": "manager_approval",
      "auto": true
    },
    {
      "id": "t2",
      "from_step": "manager_approval",
      "to_step": "it_approval",
      "condition": {
        "type": "field",
        "field": "approval_result",
        "operator": "equals",
        "value": "approved"
      }
    },
    {
      "id": "t3",
      "from_step": "it_approval",
      "to_step": "security_approval",
      "condition": {
        "type": "expression",
        "expression": "${needs_public_ip == true || data_classification == 'confidential'}"
      }
    },
    {
      "id": "t4",
      "from_step": "it_approval",
      "to_step": "end",
      "condition": {
        "type": "expression",
        "expression": "${needs_public_ip == false && data_classification != 'confidential'}"
      }
    },
    {
      "id": "t5",
      "from_step": "security_approval",
      "to_step": "end",
      "auto": true
    }
  ],
  "variables": {
    "service_request_id": {
      "type": "integer",
      "required": true
    },
    "needs_public_ip": {
      "type": "boolean",
      "default": false
    },
    "data_classification": {
      "type": "string",
      "enum": ["public", "internal", "confidential"]
    }
  }
}
```

### 4.2 资源交付流程

#### 4.2.1 流程描述

适用于服务请求审批通过后的自动化资源交付流程，包含多个自动化任务。

#### 4.2.2 流程步骤

1. **开始**：服务请求审批通过
2. **创建资源**：调用云服务API创建资源
3. **配置网络**：配置网络和安全组
4. **配置访问权限**：配置用户访问权限
5. **发送通知**：通知申请人资源已就绪
6. **结束**：交付完成

#### 4.2.3 JSON定义

```json
{
  "name": "资源交付流程",
  "type": "service_request",
  "version": "1.0.0",
  "steps": [
    {
      "id": "start",
      "name": "审批通过",
      "type": "start"
    },
    {
      "id": "create_resource",
      "name": "创建资源",
      "type": "service",
      "service_type": "http",
      "service_url": "${cloudProviderAPI}/resources",
      "method": "POST",
      "timeout": 300
    },
    {
      "id": "configure_network",
      "name": "配置网络",
      "type": "service",
      "service_type": "http",
      "service_url": "${cloudProviderAPI}/networks",
      "method": "POST",
      "timeout": 180
    },
    {
      "id": "configure_access",
      "name": "配置访问权限",
      "type": "service",
      "service_type": "internal",
      "service_name": "AccessControlService",
      "method": "grantAccess",
      "timeout": 120
    },
    {
      "id": "send_notification",
      "name": "发送通知",
      "type": "service",
      "service_type": "internal",
      "service_name": "NotificationService",
      "method": "sendResourceReadyNotification",
      "timeout": 30
    },
    {
      "id": "end",
      "name": "交付完成",
      "type": "end"
    }
  ],
  "transitions": [
    {
      "id": "t1",
      "from_step": "start",
      "to_step": "create_resource",
      "auto": true
    },
    {
      "id": "t2",
      "from_step": "create_resource",
      "to_step": "configure_network",
      "auto": true
    },
    {
      "id": "t3",
      "from_step": "configure_network",
      "to_step": "configure_access",
      "auto": true
    },
    {
      "id": "t4",
      "from_step": "configure_access",
      "to_step": "send_notification",
      "auto": true
    },
    {
      "id": "t5",
      "from_step": "send_notification",
      "to_step": "end",
      "auto": true
    }
  ],
  "error_handling": {
    "create_resource": {
      "on_error": "retry",
      "max_retries": 3,
      "retry_interval": 60,
      "on_failure": "notify_admin"
    },
    "configure_network": {
      "on_error": "rollback",
      "rollback_step": "create_resource"
    }
  }
}
```

## 5. 事件管理流程模板

### 5.1 事件响应流程

#### 5.1.1 流程描述

适用于IT事件的响应和处理流程，包含事件分类、分配、处理、解决等环节。

#### 5.1.2 流程步骤

1. **开始**：事件创建
2. **事件分类**：自动或手动分类事件
3. **条件判断**：根据优先级分配
4. **紧急处理**：高优先级事件
5. **标准处理**：中低优先级事件
6. **事件解决**：解决事件
7. **结束**：流程完成

#### 5.1.3 JSON定义

```json
{
  "name": "事件响应流程",
  "type": "incident",
  "version": "1.0.0",
  "steps": [
    {
      "id": "start",
      "name": "事件创建",
      "type": "start"
    },
    {
      "id": "classify",
      "name": "事件分类",
      "type": "task",
      "assignee_rule": {
        "type": "auto",
        "strategy": "round_robin",
        "candidate_groups": ["Service_Desk"]
      },
      "timeout": 60
    },
    {
      "id": "urgent_process",
      "name": "紧急处理",
      "type": "task",
      "candidate_groups": ["IT_Support_Team"],
      "timeout": 240,
      "priority": "critical"
    },
    {
      "id": "standard_process",
      "name": "标准处理",
      "type": "task",
      "candidate_groups": ["IT_Support_Team"],
      "timeout": 1440,
      "priority": "medium"
    },
    {
      "id": "resolve",
      "name": "事件解决",
      "type": "task",
      "assignee_rule": {
        "type": "field",
        "field": "assignee_id"
      },
      "timeout": 2880
    },
    {
      "id": "end",
      "name": "结束",
      "type": "end"
    }
  ],
  "transitions": [
    {
      "id": "t1",
      "from_step": "start",
      "to_step": "classify",
      "auto": true
    },
    {
      "id": "t2",
      "from_step": "classify",
      "to_step": "urgent_process",
      "condition": {
        "type": "field",
        "field": "priority",
        "operator": "in",
        "value": ["high", "critical"]
      }
    },
    {
      "id": "t3",
      "from_step": "classify",
      "to_step": "standard_process",
      "condition": {
        "type": "field",
        "field": "priority",
        "operator": "in",
        "value": ["low", "medium"]
      }
    },
    {
      "id": "t4",
      "from_step": "urgent_process",
      "to_step": "resolve",
      "auto": true
    },
    {
      "id": "t5",
      "from_step": "standard_process",
      "to_step": "resolve",
      "auto": true
    },
    {
      "id": "t6",
      "from_step": "resolve",
      "to_step": "end",
      "auto": true
    }
  ]
}
```

## 6. 问题管理流程模板

### 6.1 问题调查流程

#### 6.1.1 流程描述

适用于问题管理的完整流程，包含问题识别、调查、根因分析、解决方案、实施等环节。

#### 6.1.2 流程步骤

1. **开始**：问题创建
2. **问题调查**：调查问题详情
3. **根因分析**：分析根本原因
4. **解决方案设计**：设计解决方案
5. **方案审批**：审批解决方案
6. **方案实施**：实施解决方案
7. **问题关闭**：关闭问题
8. **结束**：流程完成

#### 6.1.3 JSON定义

```json
{
  "name": "问题调查流程",
  "type": "problem",
  "version": "1.0.0",
  "steps": [
    {
      "id": "start",
      "name": "问题创建",
      "type": "start"
    },
    {
      "id": "investigation",
      "name": "问题调查",
      "type": "task",
      "candidate_groups": ["Problem_Management_Team"],
      "timeout": 7200,
      "form_key": "problem_investigation_form"
    },
    {
      "id": "root_cause_analysis",
      "name": "根因分析",
      "type": "task",
      "candidate_groups": ["Problem_Management_Team"],
      "timeout": 14400,
      "form_key": "root_cause_analysis_form"
    },
    {
      "id": "solution_design",
      "name": "解决方案设计",
      "type": "task",
      "candidate_groups": ["Problem_Management_Team", "IT_Architecture_Team"],
      "timeout": 14400,
      "form_key": "solution_design_form"
    },
    {
      "id": "solution_approval",
      "name": "方案审批",
      "type": "approval",
      "candidate_groups": ["IT_Management"],
      "timeout": 2880,
      "form_key": "solution_approval_form"
    },
    {
      "id": "solution_implementation",
      "name": "方案实施",
      "type": "task",
      "assignee_rule": {
        "type": "field",
        "field": "implementer_id"
      },
      "timeout": 28800
    },
    {
      "id": "problem_close",
      "name": "问题关闭",
      "type": "task",
      "candidate_groups": ["Problem_Management_Team"],
      "timeout": 1440,
      "form_key": "problem_close_form"
    },
    {
      "id": "end",
      "name": "结束",
      "type": "end"
    }
  ],
  "transitions": [
    {
      "id": "t1",
      "from_step": "start",
      "to_step": "investigation",
      "auto": true
    },
    {
      "id": "t2",
      "from_step": "investigation",
      "to_step": "root_cause_analysis",
      "auto": true
    },
    {
      "id": "t3",
      "from_step": "root_cause_analysis",
      "to_step": "solution_design",
      "auto": true
    },
    {
      "id": "t4",
      "from_step": "solution_design",
      "to_step": "solution_approval",
      "auto": true
    },
    {
      "id": "t5",
      "from_step": "solution_approval",
      "to_step": "solution_implementation",
      "condition": {
        "type": "field",
        "field": "approval_result",
        "operator": "equals",
        "value": "approved"
      }
    },
    {
      "id": "t6",
      "from_step": "solution_implementation",
      "to_step": "problem_close",
      "auto": true
    },
    {
      "id": "t7",
      "from_step": "problem_close",
      "to_step": "end",
      "auto": true
    }
  ]
}
```

## 7. 模板配置说明

### 7.1 模板导入

#### 7.1.1 导入方式

1. **从文件导入**：上传BPMN XML或JSON文件
2. **从模板库选择**：从预置模板库中选择
3. **复制现有流程**：复制并修改现有流程定义

#### 7.1.2 导入步骤

```
1. 选择模板文件或模板库中的模板
2. 系统验证模板格式
3. 配置流程变量映射
4. 配置任务分配规则
5. 配置超时和通知规则
6. 保存流程定义
```

### 7.2 模板自定义

#### 7.2.1 可自定义项

- **流程步骤**：添加、删除、修改步骤
- **分配规则**：修改任务分配规则
- **超时设置**：调整各步骤超时时间
- **条件表达式**：修改流程分支条件
- **表单配置**：配置任务表单

#### 7.2.2 自定义限制

- 不能删除开始和结束节点
- 必须保证流程可达性
- 必须验证条件表达式语法

### 7.3 模板版本管理

#### 7.3.1 版本规则

- 每次修改创建新版本
- 保留历史版本
- 仅最新版本可激活
- 运行中的实例使用启动时的版本

#### 7.3.2 版本对比

- 可视化对比两个版本的差异
- 显示新增、删除、修改的节点
- 显示变量定义的变化

## 8. 模板使用最佳实践

### 8.1 模板选择建议

| 场景 | 推荐模板 | 原因 |
|-----|---------|------|
| 普通工单审批 | 标准工单审批流程 | 流程简单，效率高 |
| 紧急工单 | 紧急工单处理流程 | 跳过审批，快速处理 |
| 重要工单 | 复杂工单多级审批 | 多级审批，风险可控 |
| 普通变更 | 标准变更流程 | 完整流程，规范管理 |
| 紧急变更 | 紧急变更流程 | 简化流程，快速实施 |
| 服务请求 | 服务申请审批流程 | 三级审批，安全合规 |
| 资源交付 | 资源交付流程 | 自动化交付，提高效率 |

### 8.2 模板配置检查清单

- [ ] 流程变量定义完整
- [ ] 任务分配规则配置正确
- [ ] 超时时间设置合理
- [ ] 条件表达式语法正确
- [ ] 表单Key配置正确
- [ ] 通知规则配置完整
- [ ] 错误处理策略配置
- [ ] 流程测试通过

### 8.3 模板优化建议

1. **简化流程**：去除不必要的步骤
2. **并行处理**：将串行步骤改为并行
3. **自动化**：将人工任务改为自动化任务
4. **超时优化**：根据实际处理时间调整超时
5. **条件优化**：简化复杂的条件表达式

---

**文档版本**：V1.0  
**创建日期**：2025-12-17  
**最后更新**：2025-12-17  
**维护人**：产品团队
