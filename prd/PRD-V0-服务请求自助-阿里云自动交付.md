# PRD-V0：服务请求自助（SaaS）+ 阿里云自动交付（爆点）

## 1. 背景与目标

### 1.1 背景

- 产品形态：**SaaS化**，部署在**公有云**，无数据出境限制。
- 试点方向：**服务请求自助（Service Request）**，通过标准化服务目录 + 审批 + 履约交付实现“可量化ROI”的企业落地。
- 爆点能力：云资源申请在审批通过后实现 **阿里云自动创建资源**（可控执行、可审计、可回滚、可回收）。

### 1.2 本版本目标（V0）

- 打通端到端闭环：**自助提交 → 主管审批 → IT审批 → 安全审批 → 自动交付（阿里云）→ 自动校验 → 回写 & 审计 → 到期回收 → 回访评价**。
- 建立企业级“可信AI/自动化”基础：所有自动化必须满足 **权限校验、审批门禁、审计留痕、可回滚**。

### 1.3 非目标（V0不做）

- 多云自动交付（展示多云选项，但仅支持**阿里云**执行）
- 复杂成本预算系统（先做成本中心/预估成本字段 + 标签归集）
- 复杂工单编排（V0以服务请求为主，后续与BPMN深度编排在V1/V2）

---

## 2. 用户与角色

### 2.1 角色

- **申请人**：发起服务请求，跟踪进度，确认交付并评价。
- **部门主管（审批1）**：确认业务合理性、预算归属、责任人/到期回收承诺。
- **IT审批（审批2）**：确认技术可行性、规格/配额、落点（租户VPC）、履约任务。
- **安全审批（审批3）**：按策略门禁审核数据分级、外网暴露、最小权限、到期回收、合规条款。
- **履约工程师（可选）**：在失败/异常情况下人工接管。
- **租户管理员**：配置服务目录、表单、审批链、SLA、通知渠道、策略护栏。

---

## 3. 服务项范围（V0）

### 3.1 服务项清单

1. **账号开通**
2. **权限申请**
3. **云资源申请**（多云展示；V0执行 **阿里云**）
4. **软件安装**

### 3.2 默认审批链（可配置覆盖）

**部门主管 → IT审批 → 安全审批**

---

## 4. 端到端流程（V0）

### 4.1 主流程

1. 申请人从服务目录选择服务项（或自然语言输入由AI推荐）
2. 填写智能表单并提交
3. 系统生成请求单 & 初始履约任务清单
4. 进入审批链：
   - 主管审批通过
   - IT审批通过
   - 安全审批通过（含策略门禁校验）
5. 自动交付（仅云资源申请）：系统触发阿里云连接器执行创建
6. 自动校验：资源状态/网络/安全组/权限策略等
7. 回写：请求单状态、审批记录、执行日志、资源ID、标签信息
8. 交付完成：申请人确认/回访评价
9. 到期回收：按 `expire_at` 自动回收；失败则告警+生成接管任务

### 4.2 异常与分支

- **退回（Returned）**：审批人要求补充材料，回到申请人编辑后再提交。
- **拒绝（Rejected）**：流程终止，保留原因与审计记录。
- **执行失败（DeliveryFailed）**：自动回滚或标记待人工回收/接管。
- **取消（Cancelled）**：申请人撤销（仅在未交付前允许）。

---

## 5. 状态机（ServiceRequest）

### 5.1 建议状态（V0）

- `Draft`：草稿
- `Submitted`：已提交/待审批
- `ManagerApproval`：主管审批中
- `ITApproval`：IT审批中
- `SecurityApproval`：安全审批中
- `Provisioning`：自动交付执行中（仅云资源申请）
- `Verification`：交付校验中
- `Delivered`：已交付（待用户确认/回访）
- `Closed`：已关闭（确认/评价完成）
- `Returned`：被退回（补充材料）
- `Rejected`：被拒绝
- `Cancelled`：已取消
- `DeliveryFailed`：交付失败（待处理/接管/回滚）

---

## 6. 表单与字段（V0定版）

### 6.1 通用字段（所有服务项）

- **申请人信息**：姓名/工号/部门（从用户/组织获取，可编辑受限）
- **紧急程度**：普通/紧急
- **期望交付时间**
- **到期回收时间（必填）**
- **成本中心（必填）**
- **数据分级（必填）**：公开/内部/敏感/受监管
- **合规条款勾选（必填）**：访问控制、审计留存、加密要求、变更流程遵循等（租户可配置条款文案）
- **附件**：支持上传（按服务项可配置必填）
- **备注/补充说明**

### 6.2 云资源申请（阿里云自动交付）

#### 6.2.1 基础信息

- 云厂商：阿里云/腾讯云/AWS/Azure（V0仅阿里云可执行）
- Region（必填）
- 环境：Prod/Staging/Dev（必填）
- 业务系统/应用（可选，建议绑定应用管理/CMDB）
- 资源负责人（可选，默认申请人）

#### 6.2.2 资源类型与参数（V0）

- 资源类型：ECS（VM）/RDS/OSS/VPC/IAM（RAM）
- **规格白名单（强制）**：2C4G / 4C8G / 8C16G（ECS/RDS）

#### 6.2.3 公网策略（强制护栏）

- 是否需要公网IP：是/否
- 若为是：
  - **公网仅允许端口：443（固定）**
  - **源IP白名单（CIDR列表，必填）**
  - 运维访问：**必须走阿里云堡垒机**（不允许对公网开放22/3389等）

#### 6.2.4 最小权限（IAM）

- 申请/创建的RAM用户/角色用途说明
- 权限策略选择（基于模板/白名单）
- 权限到期时间（与请求到期一致或更早）
- MFA要求（默认开启，租户可配置）

---

## 7. 安全审批门禁（V0规则引擎）

### 7.1 必须通过的校验

- **到期回收时间**必填，且不得超过租户策略上限（可配置）
- **成本中心**必填
- **数据分级**必填
- **合规条款**必勾选

### 7.2 公网相关强制规则

- 公网IP=是 → 必须提供 **源IP白名单**
- 公网开放端口固定为 **443**
- 运维端口必须走 **阿里云堡垒机**（审批页需展示该控制项）

### 7.3 最小权限相关规则

- IAM权限必须从模板/白名单选择（V0）
- 权限必须带到期（默认与请求到期一致或更早）

---

## 8. 页面与交互（V0）

### 8.1 用户侧

- 服务目录首页：分类/搜索/热门/最近
- 服务申请页：动态表单 + AI推荐/补全 + 风险提示
- 我的请求：列表/筛选/状态/SLA倒计时/待我补充
- 请求详情：审批进度、交付日志、附件、评论、交付产出物、确认与评价

### 8.2 审批侧

- 我的审批：待办列表/筛选（服务项、紧急、SLA剩余）
- 审批详情：关键信息摘要（含AI生成的“将要创建什么/风险点/成本”）、审批意见、退回原因、附件

### 8.3 履约侧

- 履约队列：待交付/失败/待接管
- 执行详情：执行计划、实时日志、资源ID、回滚按钮（有权限/二次确认）

### 8.4 租户管理员

- 服务项配置：目录、表单字段、校验规则
- 审批链配置：默认链、按服务项覆盖
- 策略配置：规格白名单、到期上限、公网策略、源IP白名单规则、堡垒机启用
- 通知渠道配置：站内+IM

---

## 9. 通知与SLA（V0）

### 9.1 通知触发点

- 提交成功
- 待我审批
- 审批通过/拒绝/退回
- 即将超时（审批/履约）
- 自动交付开始/完成/失败
- 到期回收提醒/回收失败

### 9.2 SLA（V0最小）

- 按服务项配置目标时长（可先内置默认值）
- SLA倒计时展示在：我的请求、我的审批、履约队列

---

## 10. 关键指标与验收（V0上线门槛）

### 10.1 业务指标（可量化）

- 自助转化率（自助提交占比）
- 平均交付时长下降（与基线对比）
- SLA达成率（按服务项）
- 自动交付成功率（云资源申请）
- 资源“孤儿率”（应为0或可控并可追溯）
- 满意度

### 10.2 功能验收（必须全通过）

- 4个服务项端到端跑通（含退回/拒绝/取消分支）
- 云资源申请：审批通过后可自动创建阿里云资源，完成校验并回写资源ID
- 公网策略：公网仅443 + 源IP白名单强制 + 运维端口走堡垒机（不可绕过）
- 审计：审批/执行/回滚/回收全留痕可检索
- 到期回收：到期自动回收；失败生成接管任务并通知
