a85783a55f298419f40e3f9afa3c456b
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    default: function() {
        return _default;
    },
    httpClient: function() {
        return httpClient;
    }
});
const _apiconfig = require("./api-config");
const _security = require("./security");
class HttpClient {
    constructor(baseURL = _apiconfig.API_BASE_URL){
        this.token = null;
        this.tenantId = null;
        this.tenantCode = null;
        this.baseURL = process.env.NEXT_PUBLIC_API_URL || baseURL;
        this.timeout = parseInt(process.env.NEXT_PUBLIC_API_TIMEOUT || '30000');
        // Get token and tenant ID from localStorage
        if (typeof window !== 'undefined') {
            this.token = localStorage.getItem('access_token'); // Changed to access_token
            const storedTenantId = localStorage.getItem('current_tenant_id');
            this.tenantId = storedTenantId ? parseInt(storedTenantId) : null;
            this.tenantCode = localStorage.getItem('current_tenant_code') || null;
        }
    }
    setToken(token) {
        this.token = token;
        if (typeof window !== 'undefined') {
            localStorage.setItem('access_token', token); // Changed to access_token
            // 同步更新 Cookie，有效期 15 分钟
            document.cookie = `auth-token=${token}; path=/; max-age=900; SameSite=Lax`;
        }
    }
    clearToken() {
        this.token = null;
        if (typeof window !== 'undefined') {
            localStorage.removeItem('access_token'); // Changed to access_token
            // 清除 Cookie
            document.cookie = 'auth-token=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
            document.cookie = 'refresh-token=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
        }
    }
    setTenantId(tenantId) {
        this.tenantId = tenantId;
        if (typeof window !== 'undefined') {
            if (tenantId) {
                localStorage.setItem('current_tenant_id', tenantId.toString());
            } else {
                localStorage.removeItem('current_tenant_id');
            }
        }
    }
    setTenantCode(code) {
        this.tenantCode = code;
        console.log('HttpClient.setTenantCode:', code);
        if (typeof window !== 'undefined') {
            if (code) {
                localStorage.setItem('current_tenant_code', code);
            } else {
                localStorage.removeItem('current_tenant_code');
            }
        }
    }
    // Get tenant code
    getTenantCode() {
        return this.tenantCode;
    }
    getTenantId() {
        return this.tenantId;
    }
    getHeaders() {
        // Set secure request headers
        const csrfToken = _security.security.csrf.getTokenFromMeta();
        const headers = {
            ..._security.security.network.getSecureHeaders(csrfToken || undefined)
        };
        // Dynamically get the latest token and tenantId
        const currentToken = typeof window !== 'undefined' ? localStorage.getItem('access_token') : this.token;
        const currentTenantId = typeof window !== 'undefined' ? localStorage.getItem('current_tenant_id') : this.tenantId;
        if (currentToken) {
            headers['Authorization'] = `Bearer ${currentToken}`;
        }
        if (currentTenantId) {
            headers['X-Tenant-ID'] = currentTenantId.toString();
        }
        const currentTenantCode = typeof window !== 'undefined' ? localStorage.getItem('current_tenant_code') : this.tenantCode;
        if (currentTenantCode) {
            headers['X-Tenant-Code'] = currentTenantCode;
        }
        return headers;
    }
    // Independent token refresh method to avoid circular dependencies
    async refreshTokenInternal() {
        const refreshToken = typeof window !== 'undefined' ? localStorage.getItem('refresh_token') : null;
        if (!refreshToken) {
            return false;
        }
        try {
            const response = await fetch(`${this.baseURL}/api/v1/refresh-token`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    refresh_token: refreshToken
                })
            });
            if (response.ok) {
                const data = await response.json();
                if (data.code === 0) {
                    // Update access token
                    this.setToken(data.data.access_token);
                    // Also update instance variable
                    this.token = data.data.access_token;
                    return true;
                }
            }
            return false;
        } catch (error) {
            console.error('Token refresh failed:', error);
            return false;
        }
    }
    // Request method using fetch API
    async request(endpoint, config) {
        const url = `${this.baseURL}${endpoint}`;
        const headers = this.getHeaders();
        const requestConfig = {
            method: config.method,
            headers: {
                ...headers,
                ...config.headers
            },
            body: config.body
        };
        // 仅在开发环境输出调试日志
        if (process.env.NODE_ENV === 'development' && process.env.NEXT_PUBLIC_DEBUG_API === 'true') {
            console.log('HTTP Client Request:', {
                url,
                method: config.method,
                headers,
                body: config.body
            });
        }
        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(()=>controller.abort(), this.timeout);
            const response = await fetch(url, {
                ...requestConfig,
                signal: controller.signal
            });
            clearTimeout(timeoutId);
            // 仅在开发环境输出调试日志
            if (process.env.NODE_ENV === 'development' && process.env.NEXT_PUBLIC_DEBUG_API === 'true') {
                console.log('HTTP Client Response:', {
                    status: response.status,
                    statusText: response.statusText,
                    headers: response.headers ? Object.fromEntries(response.headers.entries()) : {}
                });
            }
            // If 401 error, try to refresh token
            if (response.status === 401) {
                const refreshSuccess = await this.refreshTokenInternal();
                if (refreshSuccess) {
                    // Retry original request
                    const retryConfig = {
                        ...requestConfig,
                        headers: {
                            ...this.getHeaders(),
                            ...config.headers
                        }
                    };
                    const retryResponse = await fetch(url, retryConfig);
                    if (!retryResponse.ok) {
                        const rid = retryResponse.headers.get('X-Request-Id') || '';
                        const suffix = rid ? ` [RID: ${rid}]` : '';
                        throw new Error(`HTTP error! status: ${retryResponse.status}${suffix}`);
                    }
                    const retryData = await retryResponse.json();
                    console.log('HTTP Client Retry Response Data:', retryData);
                    // Check response code
                    if (retryData.code !== 0) {
                        const rid = retryResponse.headers.get('X-Request-Id') || '';
                        const suffix = rid ? ` [RID: ${rid}]` : '';
                        throw new Error((retryData.message || 'Request failed') + suffix);
                    }
                    return retryData.data;
                } else {
                    // Refresh failed, clear token and redirect to login
                    this.clearToken();
                    if (typeof window !== 'undefined') {
                        localStorage.removeItem('refresh_token');
                        window.location.href = '/login';
                    }
                    throw new Error('Authentication failed');
                }
            }
            if (!response.ok) {
                const rid = response.headers.get('X-Request-Id') || '';
                const suffix = rid ? ` [RID: ${rid}]` : '';
                throw new Error(`HTTP error! status: ${response.status}${suffix}`);
            }
            const responseData = await response.json();
            // 仅在开发环境输出调试日志
            if (process.env.NODE_ENV === 'development' && process.env.NEXT_PUBLIC_DEBUG_API === 'true') {
                console.log('HTTP Client Raw Response Data:', responseData);
                console.log('HTTP Client Response Code:', responseData.code);
                console.log('HTTP Client Response Message:', responseData.message);
                console.log('HTTP Client Response Data Type:', typeof responseData.data);
            }
            // Check response code
            if (responseData.code !== 0) {
                const rid = response.headers && response.headers.get('X-Request-Id') || '';
                const suffix = rid ? ` [RID: ${rid}]` : '';
                const errorMessage = responseData.message || 'Request failed';
                console.error('API Error:', {
                    code: responseData.code,
                    message: errorMessage,
                    endpoint,
                    url,
                    responseData
                });
                throw new Error(errorMessage + suffix);
            }
            // 验证data字段存在
            if (responseData.data === undefined || responseData.data === null) {
                console.error('API Response data is undefined or null:', responseData);
                throw new Error('API响应数据为空');
            }
            return responseData.data;
        } catch (error) {
            console.error('Request failed:', {
                error,
                endpoint,
                url: `${this.baseURL}${endpoint}`,
                method: config.method
            });
            if (error instanceof Error) {
                if (error.name === 'AbortError') {
                    throw new Error('Request timeout, please try again later');
                }
                // 如果是网络错误，提供更友好的错误信息
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    throw new Error('无法连接到服务器，请检查网络连接或确保后端服务正在运行');
                }
                throw error;
            }
            throw new Error('Unknown error occurred');
        }
    }
    async get(endpoint, params) {
        let url = endpoint;
        if (params) {
            const searchParams = new URLSearchParams();
            Object.entries(params).forEach(([key, value])=>{
                if (value !== undefined && value !== null) {
                    searchParams.append(key, String(value));
                }
            });
            url += `?${searchParams.toString()}`;
        }
        return this.request(url, {
            method: 'GET'
        });
    }
    async post(endpoint, data) {
        return this.request(endpoint, {
            method: 'POST',
            body: data ? JSON.stringify(data) : undefined
        });
    }
    async put(endpoint, data) {
        return this.request(endpoint, {
            method: 'PUT',
            body: data ? JSON.stringify(data) : undefined
        });
    }
    async patch(endpoint, data) {
        return this.request(endpoint, {
            method: 'PATCH',
            body: data ? JSON.stringify(data) : undefined
        });
    }
    async delete(endpoint) {
        return this.request(endpoint, {
            method: 'DELETE'
        });
    }
}
const httpClient = new HttpClient();
const _default = HttpClient;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9oZWlkc29mdC9Eb3dubG9hZHMvcmVzZWFyY2gvaXRzbS9pdHNtLXByb3RvdHlwZS9zcmMvYXBwL2xpYi9odHRwLWNsaWVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBUElfQkFTRV9VUkwgfSBmcm9tICcuL2FwaS1jb25maWcnO1xuaW1wb3J0IHsgc2VjdXJpdHkgfSBmcm9tICcuL3NlY3VyaXR5JztcblxuLy8gUmVxdWVzdCBjb25maWd1cmF0aW9uIGludGVyZmFjZVxuaW50ZXJmYWNlIFJlcXVlc3RDb25maWcge1xuICBtZXRob2Q/OiAnR0VUJyB8ICdQT1NUJyB8ICdQVVQnIHwgJ0RFTEVURScgfCAnUEFUQ0gnO1xuICBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgYm9keT86IHN0cmluZztcbiAgdGltZW91dD86IG51bWJlcjtcbn1cblxuLy8gQVBJIHJlc3BvbnNlIGludGVyZmFjZVxuaW50ZXJmYWNlIEFwaVJlc3BvbnNlPFQ+IHtcbiAgY29kZTogbnVtYmVyO1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGRhdGE6IFQ7XG59XG5cbmNsYXNzIEh0dHBDbGllbnQge1xuICBwcml2YXRlIGJhc2VVUkw6IHN0cmluZztcbiAgcHJpdmF0ZSB0b2tlbjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgdGVuYW50SWQ6IG51bWJlciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHRlbmFudENvZGU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHJlYWRvbmx5IHRpbWVvdXQ6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihiYXNlVVJMOiBzdHJpbmcgPSBBUElfQkFTRV9VUkwpIHtcbiAgICB0aGlzLmJhc2VVUkwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUElfVVJMIHx8IGJhc2VVUkw7XG4gICAgdGhpcy50aW1lb3V0ID0gcGFyc2VJbnQocHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBJX1RJTUVPVVQgfHwgJzMwMDAwJyk7XG4gICAgLy8gR2V0IHRva2VuIGFuZCB0ZW5hbnQgSUQgZnJvbSBsb2NhbFN0b3JhZ2VcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMudG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWNjZXNzX3Rva2VuJyk7IC8vIENoYW5nZWQgdG8gYWNjZXNzX3Rva2VuXG4gICAgICBjb25zdCBzdG9yZWRUZW5hbnRJZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjdXJyZW50X3RlbmFudF9pZCcpO1xuICAgICAgdGhpcy50ZW5hbnRJZCA9IHN0b3JlZFRlbmFudElkID8gcGFyc2VJbnQoc3RvcmVkVGVuYW50SWQpIDogbnVsbDtcbiAgICAgIHRoaXMudGVuYW50Q29kZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjdXJyZW50X3RlbmFudF9jb2RlJykgfHwgbnVsbDtcbiAgICB9XG4gIH1cblxuICBzZXRUb2tlbih0b2tlbjogc3RyaW5nKSB7XG4gICAgdGhpcy50b2tlbiA9IHRva2VuO1xuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2FjY2Vzc190b2tlbicsIHRva2VuKTsgLy8gQ2hhbmdlZCB0byBhY2Nlc3NfdG9rZW5cbiAgICAgIC8vIOWQjOatpeabtOaWsCBDb29raWXvvIzmnInmlYjmnJ8gMTUg5YiG6ZKfXG4gICAgICBkb2N1bWVudC5jb29raWUgPSBgYXV0aC10b2tlbj0ke3Rva2VufTsgcGF0aD0vOyBtYXgtYWdlPTkwMDsgU2FtZVNpdGU9TGF4YDtcbiAgICB9XG4gIH1cblxuICBjbGVhclRva2VuKCkge1xuICAgIHRoaXMudG9rZW4gPSBudWxsO1xuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2FjY2Vzc190b2tlbicpOyAvLyBDaGFuZ2VkIHRvIGFjY2Vzc190b2tlblxuICAgICAgLy8g5riF6ZmkIENvb2tpZVxuICAgICAgZG9jdW1lbnQuY29va2llID0gJ2F1dGgtdG9rZW49OyBwYXRoPS87IGV4cGlyZXM9VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMSBHTVQ7JztcbiAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICdyZWZyZXNoLXRva2VuPTsgcGF0aD0vOyBleHBpcmVzPVRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDEgR01UOyc7XG4gICAgfVxuICB9XG5cbiAgc2V0VGVuYW50SWQodGVuYW50SWQ6IG51bWJlciB8IG51bGwpIHtcbiAgICB0aGlzLnRlbmFudElkID0gdGVuYW50SWQ7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBpZiAodGVuYW50SWQpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2N1cnJlbnRfdGVuYW50X2lkJywgdGVuYW50SWQudG9TdHJpbmcoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY3VycmVudF90ZW5hbnRfaWQnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzZXRUZW5hbnRDb2RlKGNvZGU6IHN0cmluZyB8IG51bGwpIHtcbiAgICB0aGlzLnRlbmFudENvZGUgPSBjb2RlO1xuICAgIGNvbnNvbGUubG9nKCdIdHRwQ2xpZW50LnNldFRlbmFudENvZGU6JywgY29kZSk7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBpZiAoY29kZSkge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY3VycmVudF90ZW5hbnRfY29kZScsIGNvZGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2N1cnJlbnRfdGVuYW50X2NvZGUnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBHZXQgdGVuYW50IGNvZGVcbiAgZ2V0VGVuYW50Q29kZSgpOiBzdHJpbmcgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy50ZW5hbnRDb2RlO1xuICB9XG5cbiAgZ2V0VGVuYW50SWQoKTogbnVtYmVyIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMudGVuYW50SWQ7XG4gIH1cblxuICBwcml2YXRlIGdldEhlYWRlcnMoKTogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB7XG4gICAgLy8gU2V0IHNlY3VyZSByZXF1ZXN0IGhlYWRlcnNcbiAgICBjb25zdCBjc3JmVG9rZW4gPSBzZWN1cml0eS5jc3JmLmdldFRva2VuRnJvbU1ldGEoKTtcbiAgICBjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgLi4uc2VjdXJpdHkubmV0d29yay5nZXRTZWN1cmVIZWFkZXJzKGNzcmZUb2tlbiB8fCB1bmRlZmluZWQpLFxuICAgIH07XG5cbiAgICAvLyBEeW5hbWljYWxseSBnZXQgdGhlIGxhdGVzdCB0b2tlbiBhbmQgdGVuYW50SWRcbiAgICBjb25zdCBjdXJyZW50VG9rZW4gPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhY2Nlc3NfdG9rZW4nKSA6IHRoaXMudG9rZW47XG4gICAgY29uc3QgY3VycmVudFRlbmFudElkID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3VycmVudF90ZW5hbnRfaWQnKSA6IHRoaXMudGVuYW50SWQ7XG5cbiAgICBpZiAoY3VycmVudFRva2VuKSB7XG4gICAgICBoZWFkZXJzWydBdXRob3JpemF0aW9uJ10gPSBgQmVhcmVyICR7Y3VycmVudFRva2VufWA7XG4gICAgfVxuXG4gICAgaWYgKGN1cnJlbnRUZW5hbnRJZCkge1xuICAgICAgaGVhZGVyc1snWC1UZW5hbnQtSUQnXSA9IGN1cnJlbnRUZW5hbnRJZC50b1N0cmluZygpO1xuICAgIH1cbiAgICBjb25zdCBjdXJyZW50VGVuYW50Q29kZSA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2N1cnJlbnRfdGVuYW50X2NvZGUnKSA6IHRoaXMudGVuYW50Q29kZTtcbiAgICBpZiAoY3VycmVudFRlbmFudENvZGUpIHtcbiAgICAgIGhlYWRlcnNbJ1gtVGVuYW50LUNvZGUnXSA9IGN1cnJlbnRUZW5hbnRDb2RlO1xuICAgIH1cblxuICAgIHJldHVybiBoZWFkZXJzO1xuICB9XG5cbiAgLy8gSW5kZXBlbmRlbnQgdG9rZW4gcmVmcmVzaCBtZXRob2QgdG8gYXZvaWQgY2lyY3VsYXIgZGVwZW5kZW5jaWVzXG4gIHByaXZhdGUgYXN5bmMgcmVmcmVzaFRva2VuSW50ZXJuYWwoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcmVmcmVzaFRva2VuID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncmVmcmVzaF90b2tlbicpIDogbnVsbDtcbiAgICBpZiAoIXJlZnJlc2hUb2tlbikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuYmFzZVVSTH0vYXBpL3YxL3JlZnJlc2gtdG9rZW5gLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHJlZnJlc2hfdG9rZW46IHJlZnJlc2hUb2tlbixcbiAgICAgICAgfSksXG4gICAgICB9KTtcblxuICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIGlmIChkYXRhLmNvZGUgPT09IDApIHtcbiAgICAgICAgICAvLyBVcGRhdGUgYWNjZXNzIHRva2VuXG4gICAgICAgICAgdGhpcy5zZXRUb2tlbihkYXRhLmRhdGEuYWNjZXNzX3Rva2VuKTtcbiAgICAgICAgICAvLyBBbHNvIHVwZGF0ZSBpbnN0YW5jZSB2YXJpYWJsZVxuICAgICAgICAgIHRoaXMudG9rZW4gPSBkYXRhLmRhdGEuYWNjZXNzX3Rva2VuO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1Rva2VuIHJlZnJlc2ggZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvLyBSZXF1ZXN0IG1ldGhvZCB1c2luZyBmZXRjaCBBUElcbiAgcHJpdmF0ZSBhc3luYyByZXF1ZXN0PFQ+KGVuZHBvaW50OiBzdHJpbmcsIGNvbmZpZzogUmVxdWVzdENvbmZpZyk6IFByb21pc2U8VD4ge1xuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVSTH0ke2VuZHBvaW50fWA7XG4gICAgY29uc3QgaGVhZGVycyA9IHRoaXMuZ2V0SGVhZGVycygpO1xuICAgIGNvbnN0IHJlcXVlc3RDb25maWc6IFJlcXVlc3RJbml0ID0ge1xuICAgICAgbWV0aG9kOiBjb25maWcubWV0aG9kLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAuLi5oZWFkZXJzLFxuICAgICAgICAuLi5jb25maWcuaGVhZGVycyxcbiAgICAgIH0sXG4gICAgICBib2R5OiBjb25maWcuYm9keSxcbiAgICB9O1xuXG4gICAgLy8g5LuF5Zyo5byA5Y+R546v5aKD6L6T5Ye66LCD6K+V5pel5b+XXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnICYmIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0RFQlVHX0FQSSA9PT0gJ3RydWUnKSB7XG4gICAgICBjb25zb2xlLmxvZygnSFRUUCBDbGllbnQgUmVxdWVzdDonLCB7XG4gICAgICAgIHVybCxcbiAgICAgICAgbWV0aG9kOiBjb25maWcubWV0aG9kLFxuICAgICAgICBoZWFkZXJzLFxuICAgICAgICBib2R5OiBjb25maWcuYm9keVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gICAgICBjb25zdCB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IGNvbnRyb2xsZXIuYWJvcnQoKSwgdGhpcy50aW1lb3V0KTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgICAgLi4ucmVxdWVzdENvbmZpZyxcbiAgICAgICAgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbCxcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgIFxuICAgICAgLy8g5LuF5Zyo5byA5Y+R546v5aKD6L6T5Ye66LCD6K+V5pel5b+XXG4gICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgJiYgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfREVCVUdfQVBJID09PSAndHJ1ZScpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0hUVFAgQ2xpZW50IFJlc3BvbnNlOicsIHtcbiAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICBzdGF0dXNUZXh0OiByZXNwb25zZS5zdGF0dXNUZXh0LFxuICAgICAgICAgIGhlYWRlcnM6IHJlc3BvbnNlLmhlYWRlcnMgPyBPYmplY3QuZnJvbUVudHJpZXMocmVzcG9uc2UuaGVhZGVycy5lbnRyaWVzKCkpIDoge31cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIElmIDQwMSBlcnJvciwgdHJ5IHRvIHJlZnJlc2ggdG9rZW5cbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICBjb25zdCByZWZyZXNoU3VjY2VzcyA9IGF3YWl0IHRoaXMucmVmcmVzaFRva2VuSW50ZXJuYWwoKTtcbiAgICAgICAgaWYgKHJlZnJlc2hTdWNjZXNzKSB7XG4gICAgICAgICAgLy8gUmV0cnkgb3JpZ2luYWwgcmVxdWVzdFxuICAgICAgICAgIGNvbnN0IHJldHJ5Q29uZmlnOiBSZXF1ZXN0SW5pdCA9IHtcbiAgICAgICAgICAgIC4uLnJlcXVlc3RDb25maWcsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgIC4uLnRoaXMuZ2V0SGVhZGVycygpLFxuICAgICAgICAgICAgICAuLi5jb25maWcuaGVhZGVycyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfTtcbiAgICAgICAgICBjb25zdCByZXRyeVJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCByZXRyeUNvbmZpZyk7XG4gICAgICAgICAgaWYgKCFyZXRyeVJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICBjb25zdCByaWQgPSByZXRyeVJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdYLVJlcXVlc3QtSWQnKSB8fCAnJztcbiAgICAgICAgICAgIGNvbnN0IHN1ZmZpeCA9IHJpZCA/IGAgW1JJRDogJHtyaWR9XWAgOiAnJztcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCBlcnJvciEgc3RhdHVzOiAke3JldHJ5UmVzcG9uc2Uuc3RhdHVzfSR7c3VmZml4fWApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCByZXRyeURhdGEgPSBhd2FpdCByZXRyeVJlc3BvbnNlLmpzb24oKSBhcyBBcGlSZXNwb25zZTxUPjtcbiAgICAgICAgICBjb25zb2xlLmxvZygnSFRUUCBDbGllbnQgUmV0cnkgUmVzcG9uc2UgRGF0YTonLCByZXRyeURhdGEpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIENoZWNrIHJlc3BvbnNlIGNvZGVcbiAgICAgICAgICBpZiAocmV0cnlEYXRhLmNvZGUgIT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHJpZCA9IHJldHJ5UmVzcG9uc2UuaGVhZGVycy5nZXQoJ1gtUmVxdWVzdC1JZCcpIHx8ICcnO1xuICAgICAgICAgICAgY29uc3Qgc3VmZml4ID0gcmlkID8gYCBbUklEOiAke3JpZH1dYCA6ICcnO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKChyZXRyeURhdGEubWVzc2FnZSB8fCAnUmVxdWVzdCBmYWlsZWQnKSArIHN1ZmZpeCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIHJldHVybiByZXRyeURhdGEuZGF0YTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBSZWZyZXNoIGZhaWxlZCwgY2xlYXIgdG9rZW4gYW5kIHJlZGlyZWN0IHRvIGxvZ2luXG4gICAgICAgICAgdGhpcy5jbGVhclRva2VuKCk7XG4gICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncmVmcmVzaF90b2tlbicpO1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL2xvZ2luJztcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoZW50aWNhdGlvbiBmYWlsZWQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGNvbnN0IHJpZCA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdYLVJlcXVlc3QtSWQnKSB8fCAnJztcbiAgICAgICAgY29uc3Qgc3VmZml4ID0gcmlkID8gYCBbUklEOiAke3JpZH1dYCA6ICcnO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhUVFAgZXJyb3IhIHN0YXR1czogJHtyZXNwb25zZS5zdGF0dXN9JHtzdWZmaXh9YCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKSBhcyBBcGlSZXNwb25zZTxUPjtcbiAgICAgIC8vIOS7heWcqOW8gOWPkeeOr+Wig+i+k+WHuuiwg+ivleaXpeW/l1xuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnICYmIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0RFQlVHX0FQSSA9PT0gJ3RydWUnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdIVFRQIENsaWVudCBSYXcgUmVzcG9uc2UgRGF0YTonLCByZXNwb25zZURhdGEpO1xuICAgICAgICBjb25zb2xlLmxvZygnSFRUUCBDbGllbnQgUmVzcG9uc2UgQ29kZTonLCByZXNwb25zZURhdGEuY29kZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdIVFRQIENsaWVudCBSZXNwb25zZSBNZXNzYWdlOicsIHJlc3BvbnNlRGF0YS5tZXNzYWdlKTtcbiAgICAgICAgY29uc29sZS5sb2coJ0hUVFAgQ2xpZW50IFJlc3BvbnNlIERhdGEgVHlwZTonLCB0eXBlb2YgcmVzcG9uc2VEYXRhLmRhdGEpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDaGVjayByZXNwb25zZSBjb2RlXG4gICAgICBpZiAocmVzcG9uc2VEYXRhLmNvZGUgIT09IDApIHtcbiAgICAgICAgY29uc3QgcmlkID0gKHJlc3BvbnNlLmhlYWRlcnMgJiYgcmVzcG9uc2UuaGVhZGVycy5nZXQoJ1gtUmVxdWVzdC1JZCcpKSB8fCAnJztcbiAgICAgICAgY29uc3Qgc3VmZml4ID0gcmlkID8gYCBbUklEOiAke3JpZH1dYCA6ICcnO1xuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSByZXNwb25zZURhdGEubWVzc2FnZSB8fCAnUmVxdWVzdCBmYWlsZWQnO1xuICAgICAgICBjb25zb2xlLmVycm9yKCdBUEkgRXJyb3I6Jywge1xuICAgICAgICAgIGNvZGU6IHJlc3BvbnNlRGF0YS5jb2RlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yTWVzc2FnZSxcbiAgICAgICAgICBlbmRwb2ludCxcbiAgICAgICAgICB1cmwsXG4gICAgICAgICAgcmVzcG9uc2VEYXRhXG4gICAgICAgIH0pO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNZXNzYWdlICsgc3VmZml4KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8g6aqM6K+BZGF0YeWtl+auteWtmOWcqFxuICAgICAgaWYgKHJlc3BvbnNlRGF0YS5kYXRhID09PSB1bmRlZmluZWQgfHwgcmVzcG9uc2VEYXRhLmRhdGEgPT09IG51bGwpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignQVBJIFJlc3BvbnNlIGRhdGEgaXMgdW5kZWZpbmVkIG9yIG51bGw6JywgcmVzcG9uc2VEYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBUEnlk43lupTmlbDmja7kuLrnqbonKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3BvbnNlRGF0YS5kYXRhO1xuICAgIH0gY2F0Y2ggKGVycm9yOiB1bmtub3duKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdSZXF1ZXN0IGZhaWxlZDonLCB7XG4gICAgICAgIGVycm9yLFxuICAgICAgICBlbmRwb2ludCxcbiAgICAgICAgdXJsOiBgJHt0aGlzLmJhc2VVUkx9JHtlbmRwb2ludH1gLFxuICAgICAgICBtZXRob2Q6IGNvbmZpZy5tZXRob2RcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0Fib3J0RXJyb3InKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1ZXN0IHRpbWVvdXQsIHBsZWFzZSB0cnkgYWdhaW4gbGF0ZXInKTtcbiAgICAgICAgfVxuICAgICAgICAvLyDlpoLmnpzmmK/nvZHnu5zplJnor6/vvIzmj5Dkvpvmm7Tlj4vlpb3nmoTplJnor6/kv6Hmga9cbiAgICAgICAgaWYgKGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ0ZhaWxlZCB0byBmZXRjaCcpIHx8IGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ05ldHdvcmtFcnJvcicpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfml6Dms5Xov57mjqXliLDmnI3liqHlmajvvIzor7fmo4Dmn6XnvZHnu5zov57mjqXmiJbnoa7kv53lkI7nq6/mnI3liqHmraPlnKjov5DooYwnKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBlcnJvciBvY2N1cnJlZCcpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldDxUPihlbmRwb2ludDogc3RyaW5nLCBwYXJhbXM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik6IFByb21pc2U8VD4ge1xuICAgIGxldCB1cmwgPSBlbmRwb2ludDtcbiAgICBpZiAocGFyYW1zKSB7XG4gICAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgICBPYmplY3QuZW50cmllcyhwYXJhbXMpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgIHNlYXJjaFBhcmFtcy5hcHBlbmQoa2V5LCBTdHJpbmcodmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB1cmwgKz0gYD8ke3NlYXJjaFBhcmFtcy50b1N0cmluZygpfWA7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8VD4odXJsLCB7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgcG9zdDxUPihlbmRwb2ludDogc3RyaW5nLCBkYXRhPzogdW5rbm93bik6IFByb21pc2U8VD4ge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8VD4oZW5kcG9pbnQsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgYm9keTogZGF0YSA/IEpTT04uc3RyaW5naWZ5KGRhdGEpIDogdW5kZWZpbmVkLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgcHV0PFQ+KGVuZHBvaW50OiBzdHJpbmcsIGRhdGE/OiB1bmtub3duKTogUHJvbWlzZTxUPiB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxUPihlbmRwb2ludCwge1xuICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgIGJvZHk6IGRhdGEgPyBKU09OLnN0cmluZ2lmeShkYXRhKSA6IHVuZGVmaW5lZCxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHBhdGNoPFQ+KGVuZHBvaW50OiBzdHJpbmcsIGRhdGE/OiB1bmtub3duKTogUHJvbWlzZTxUPiB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxUPihlbmRwb2ludCwge1xuICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgYm9keTogZGF0YSA/IEpTT04uc3RyaW5naWZ5KGRhdGEpIDogdW5kZWZpbmVkLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlPFQ+KGVuZHBvaW50OiBzdHJpbmcpOiBQcm9taXNlPFQ+IHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PFQ+KGVuZHBvaW50LCB7XG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBodHRwQ2xpZW50ID0gbmV3IEh0dHBDbGllbnQoKTtcbmV4cG9ydCBkZWZhdWx0IEh0dHBDbGllbnQ7Il0sIm5hbWVzIjpbImh0dHBDbGllbnQiLCJIdHRwQ2xpZW50IiwiY29uc3RydWN0b3IiLCJiYXNlVVJMIiwiQVBJX0JBU0VfVVJMIiwidG9rZW4iLCJ0ZW5hbnRJZCIsInRlbmFudENvZGUiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfQVBJX1VSTCIsInRpbWVvdXQiLCJwYXJzZUludCIsIk5FWFRfUFVCTElDX0FQSV9USU1FT1VUIiwid2luZG93IiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInN0b3JlZFRlbmFudElkIiwic2V0VG9rZW4iLCJzZXRJdGVtIiwiZG9jdW1lbnQiLCJjb29raWUiLCJjbGVhclRva2VuIiwicmVtb3ZlSXRlbSIsInNldFRlbmFudElkIiwidG9TdHJpbmciLCJzZXRUZW5hbnRDb2RlIiwiY29kZSIsImNvbnNvbGUiLCJsb2ciLCJnZXRUZW5hbnRDb2RlIiwiZ2V0VGVuYW50SWQiLCJnZXRIZWFkZXJzIiwiY3NyZlRva2VuIiwic2VjdXJpdHkiLCJjc3JmIiwiZ2V0VG9rZW5Gcm9tTWV0YSIsImhlYWRlcnMiLCJuZXR3b3JrIiwiZ2V0U2VjdXJlSGVhZGVycyIsInVuZGVmaW5lZCIsImN1cnJlbnRUb2tlbiIsImN1cnJlbnRUZW5hbnRJZCIsImN1cnJlbnRUZW5hbnRDb2RlIiwicmVmcmVzaFRva2VuSW50ZXJuYWwiLCJyZWZyZXNoVG9rZW4iLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZWZyZXNoX3Rva2VuIiwib2siLCJkYXRhIiwianNvbiIsImFjY2Vzc190b2tlbiIsImVycm9yIiwicmVxdWVzdCIsImVuZHBvaW50IiwiY29uZmlnIiwidXJsIiwicmVxdWVzdENvbmZpZyIsIk5PREVfRU5WIiwiTkVYVF9QVUJMSUNfREVCVUdfQVBJIiwiY29udHJvbGxlciIsIkFib3J0Q29udHJvbGxlciIsInRpbWVvdXRJZCIsInNldFRpbWVvdXQiLCJhYm9ydCIsInNpZ25hbCIsImNsZWFyVGltZW91dCIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImVudHJpZXMiLCJyZWZyZXNoU3VjY2VzcyIsInJldHJ5Q29uZmlnIiwicmV0cnlSZXNwb25zZSIsInJpZCIsImdldCIsInN1ZmZpeCIsIkVycm9yIiwicmV0cnlEYXRhIiwibWVzc2FnZSIsImxvY2F0aW9uIiwiaHJlZiIsInJlc3BvbnNlRGF0YSIsImVycm9yTWVzc2FnZSIsIm5hbWUiLCJpbmNsdWRlcyIsInBhcmFtcyIsInNlYXJjaFBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsImZvckVhY2giLCJrZXkiLCJ2YWx1ZSIsImFwcGVuZCIsIlN0cmluZyIsInBvc3QiLCJwdXQiLCJwYXRjaCIsImRlbGV0ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7SUFpVkEsT0FBMEI7ZUFBMUI7O0lBRGFBLFVBQVU7ZUFBVkE7OzsyQkFoVmdCOzBCQUNKO0FBaUJ6QixNQUFNQztJQU9KQyxZQUFZQyxVQUFrQkMsdUJBQVksQ0FBRTthQUxwQ0MsUUFBdUI7YUFDdkJDLFdBQTBCO2FBQzFCQyxhQUE0QjtRQUlsQyxJQUFJLENBQUNKLE9BQU8sR0FBR0ssUUFBUUMsR0FBRyxDQUFDQyxtQkFBbUIsSUFBSVA7UUFDbEQsSUFBSSxDQUFDUSxPQUFPLEdBQUdDLFNBQVNKLFFBQVFDLEdBQUcsQ0FBQ0ksdUJBQXVCLElBQUk7UUFDL0QsNENBQTRDO1FBQzVDLElBQUksT0FBT0MsV0FBVyxhQUFhO1lBQ2pDLElBQUksQ0FBQ1QsS0FBSyxHQUFHVSxhQUFhQyxPQUFPLENBQUMsaUJBQWlCLDBCQUEwQjtZQUM3RSxNQUFNQyxpQkFBaUJGLGFBQWFDLE9BQU8sQ0FBQztZQUM1QyxJQUFJLENBQUNWLFFBQVEsR0FBR1csaUJBQWlCTCxTQUFTSyxrQkFBa0I7WUFDNUQsSUFBSSxDQUFDVixVQUFVLEdBQUdRLGFBQWFDLE9BQU8sQ0FBQywwQkFBMEI7UUFDbkU7SUFDRjtJQUVBRSxTQUFTYixLQUFhLEVBQUU7UUFDdEIsSUFBSSxDQUFDQSxLQUFLLEdBQUdBO1FBQ2IsSUFBSSxPQUFPUyxXQUFXLGFBQWE7WUFDakNDLGFBQWFJLE9BQU8sQ0FBQyxnQkFBZ0JkLFFBQVEsMEJBQTBCO1lBQ3ZFLHdCQUF3QjtZQUN4QmUsU0FBU0MsTUFBTSxHQUFHLENBQUMsV0FBVyxFQUFFaEIsTUFBTSxtQ0FBbUMsQ0FBQztRQUM1RTtJQUNGO0lBRUFpQixhQUFhO1FBQ1gsSUFBSSxDQUFDakIsS0FBSyxH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