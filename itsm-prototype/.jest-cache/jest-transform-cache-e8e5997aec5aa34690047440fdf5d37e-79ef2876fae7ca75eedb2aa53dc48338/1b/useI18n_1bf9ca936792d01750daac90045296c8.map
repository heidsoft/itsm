{"version":3,"names":["cov_g6he40uwh","actualCoverage","s","useI18n","f","language","setLanguage","_react","useState","useEffect","prefs","_userpreferences","userPreferences","get","currentLang","b","unsubscribe","subscribe","newLang","t","useCallback","key","params","keys","split","value","_translations","translations","k","fallbackKey","result","Object","forEach","paramKey","regex","RegExp","replace","String","changeLanguage","lang","update"],"sources":["/Users/heidsoft/Downloads/research/itsm/itsm-prototype/src/lib/i18n/useI18n.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, useCallback } from 'react';\nimport { userPreferences } from '@/app/lib/user-preferences';\nimport { translations, Language } from './translations';\n\n/**\n * 国际化 Hook\n * 根据用户偏好设置返回对应的翻译文本\n */\nexport function useI18n() {\n  const [language, setLanguage] = useState<Language>('zh-CN');\n\n  // 初始化语言设置\n  useEffect(() => {\n    const prefs = userPreferences.get();\n    const currentLang = prefs.language === 'en-US' ? 'en-US' : 'zh-CN';\n    setLanguage(currentLang);\n\n    // 订阅语言变化\n    const unsubscribe = userPreferences.subscribe((prefs) => {\n      const newLang = prefs.language === 'en-US' ? 'en-US' : 'zh-CN';\n      setLanguage(newLang);\n    });\n\n    return unsubscribe;\n  }, []);\n\n  /**\n   * 获取翻译文本\n   * @param key 翻译键，支持嵌套路径，如 'dashboard.title'\n   * @param params 可选的参数对象，用于替换翻译文本中的占位符，如 {name: 'John'} 会替换 {name}\n   */\n  const t = useCallback(\n    (key: string, params?: Record<string, string | number>): string => {\n      const keys = key.split('.');\n      let value: any = translations[language];\n\n      for (const k of keys) {\n        if (value && typeof value === 'object' && k in value) {\n          value = value[k as keyof typeof value];\n        } else {\n          // 如果找不到翻译，尝试使用中文作为后备\n          value = translations['zh-CN'];\n          for (const fallbackKey of keys) {\n            if (value && typeof value === 'object' && fallbackKey in value) {\n              value = value[fallbackKey as keyof typeof value];\n            } else {\n              return key; // 如果还是找不到，返回原始键\n            }\n          }\n          break;\n        }\n      }\n\n      let result = typeof value === 'string' ? value : key;\n      \n      // 替换参数占位符\n      if (params) {\n        Object.keys(params).forEach(paramKey => {\n          const regex = new RegExp(`\\\\{${paramKey}\\\\}`, 'g');\n          result = result.replace(regex, String(params[paramKey]));\n        });\n      }\n\n      return result;\n    },\n    [language]\n  );\n\n  /**\n   * 切换语言\n   */\n  const changeLanguage = useCallback((lang: Language) => {\n    userPreferences.update({ language: lang });\n  }, []);\n\n  return {\n    t,\n    language,\n    changeLanguage,\n  };\n}\n\n"],"mappings":"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","ignoreList":[]}