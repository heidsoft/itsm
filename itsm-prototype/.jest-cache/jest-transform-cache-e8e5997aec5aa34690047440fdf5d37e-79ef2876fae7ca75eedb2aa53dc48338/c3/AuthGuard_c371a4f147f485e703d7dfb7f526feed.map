{"version":3,"names":["AuthGuard","children","cov_2875t0y8zg","f","router","s","_navigation","useRouter","pathname","usePathname","isLoading","setIsLoading","_react","useState","isAuthenticated","_authstore","useAuthStore","useEffect","initializeAuth","console","log","_mockauthservice","MockAuthService","initialize","authenticated","b","push","error","_jsxruntime","jsx","className","jsxs","Fragment"],"sources":["/Users/heidsoft/Downloads/research/itsm/itsm-prototype/src/app/components/AuthGuard.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter, usePathname } from \"next/navigation\";\nimport { MockAuthService } from \"@/lib/auth/mock-auth-service\";\nimport { useAuthStore } from \"@/lib/store/auth-store\";\n\ninterface AuthGuardProps {\n  children: React.ReactNode;\n}\n\nexport function AuthGuard({ children }: AuthGuardProps) {\n  const router = useRouter();\n  const pathname = usePathname();\n  const [isLoading, setIsLoading] = useState(true);\n  const { isAuthenticated } = useAuthStore();\n\n  useEffect(() => {\n    const initializeAuth = async () => {\n      console.log(\"AuthGuard: 初始化认证状态\", { pathname });\n\n      try {\n        // 初始化认证服务\n        await MockAuthService.initialize();\n        \n        const authenticated = MockAuthService.isAuthenticated();\n        console.log(\"AuthGuard: 认证状态\", { authenticated, pathname });\n\n        setIsLoading(false);\n\n        // 如果未认证且不在登录页面，重定向到登录页\n        if (!authenticated && pathname !== \"/login\") {\n          console.log(\"AuthGuard: 未认证，重定向到登录页\");\n          router.push(\"/login\");\n          return;\n        }\n\n        // 如果已认证且在登录页面，重定向到dashboard\n        if (authenticated && pathname === \"/login\") {\n          console.log(\"AuthGuard: 已认证且在登录页，重定向到dashboard\");\n          router.push(\"/dashboard\");\n          return;\n        }\n\n        console.log(\"AuthGuard: 状态正常，显示内容\");\n      } catch (error) {\n        console.error(\"AuthGuard: 初始化认证失败\", error);\n        setIsLoading(false);\n        \n        // 初始化失败，如果不在登录页则重定向\n        if (pathname !== \"/login\") {\n          router.push(\"/login\");\n        }\n      }\n    };\n\n    initializeAuth();\n  }, [router, pathname]);\n\n  if (isLoading) {\n    console.log(\"AuthGuard: 显示加载状态\");\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">正在加载...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // 如果在登录页面，直接显示内容\n  if (pathname === \"/login\") {\n    console.log(\"AuthGuard: 在登录页面，直接显示内容\");\n    return <>{children}</>;\n  }\n\n  // 如果已认证，显示内容\n  if (isAuthenticated) {\n    console.log(\"AuthGuard: 已认证，显示内容\");\n    return <>{children}</>;\n  }\n\n  // 其他情况显示加载状态\n  console.log(\"AuthGuard: 其他情况，显示加载状态\");\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n      <div className=\"text-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n        <p className=\"text-gray-600\">正在验证身份...</p>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]}