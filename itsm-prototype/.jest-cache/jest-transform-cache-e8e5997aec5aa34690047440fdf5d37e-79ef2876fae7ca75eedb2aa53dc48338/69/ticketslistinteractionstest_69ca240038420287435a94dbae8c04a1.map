{"version":3,"sources":["/Users/heidsoft/Downloads/research/itsm/itsm-prototype/src/app/__tests__/tickets-list-interactions.test.tsx"],"sourcesContent":["import React from 'react'\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\nimport '@testing-library/jest-dom'\nimport { App as AntdApp } from 'antd'\nimport { TicketList } from '@/components/business/TicketList'\n\njest.mock('@/lib/store/auth-store', () => ({\n  useAuthStore: () => ({ currentTenant: { id: 1 } }),\n}))\n\nconst getTicketsMock = jest.fn(async () => ({ data: [], total: 0 }))\n\njest.mock('@/lib/services/ticket-service', () => ({\n  ticketService: {\n    getTickets: (...args: any[]) => getTicketsMock(...args),\n    deleteTicket: jest.fn(async () => undefined),\n    exportTickets: jest.fn(async () => new Blob(['id,title'], { type: 'text/csv' })),\n  },\n}))\n\ndescribe('TicketList interactions', () => {\n  it('loads tickets with default pagination and tenant filter', async () => {\n    render(\n      <AntdApp>\n        <TicketList />\n      </AntdApp>\n    )\n    await waitFor(() => expect(getTicketsMock).toHaveBeenCalled())\n    const params = getTicketsMock.mock.calls[0][0]\n    expect(params.page).toBe(1)\n    expect(params.size).toBe(10)\n  })\n\n  it('applies search and status filter', async () => {\n    render(\n      <AntdApp>\n        <TicketList />\n      </AntdApp>\n    )\n\n    const search = screen.getByPlaceholderText('搜索工单标题或描述') as HTMLInputElement\n    fireEvent.change(search, { target: { value: '网络' } })\n    fireEvent.keyDown(search, { key: 'Enter' })\n\n    const statusSelect = screen.getByPlaceholderText('状态')\n    fireEvent.mouseDown(statusSelect)\n    const option = await screen.findByText('处理中')\n    fireEvent.click(option)\n\n    await waitFor(() => expect(getTicketsMock).toHaveBeenCalledTimes(3))\n    const params = getTicketsMock.mock.calls[getTicketsMock.mock.calls.length - 1][0]\n    expect(params.search).toBe('网络')\n    expect(params.status).toBe('in_progress')\n  })\n})\n\n"],"names":["jest","mock","useAuthStore","currentTenant","id","ticketService","getTickets","args","getTicketsMock","deleteTicket","fn","undefined","exportTickets","Blob","type","data","total","describe","it","render","AntdApp","TicketList","waitFor","expect","toHaveBeenCalled","params","calls","page","toBe","size","search","screen","getByPlaceholderText","fireEvent","change","target","value","keyDown","key","statusSelect","mouseDown","option","findByText","click","toHaveBeenCalledTimes","length","status"],"mappings":";AAMAA,KAAKC,IAAI,CAAC,0BAA0B,IAAO,CAAA;QACzCC,cAAc,IAAO,CAAA;gBAAEC,eAAe;oBAAEC,IAAI;gBAAE;YAAE,CAAA;IAClD,CAAA;AAIAJ,KAAKC,IAAI,CAAC,iCAAiC,IAAO,CAAA;QAChDI,eAAe;YACbC,YAAY,CAAC,GAAGC,OAAgBC,kBAAkBD;YAClDE,cAAcT,KAAKU,EAAE,CAAC,UAAYC;YAClCC,eAAeZ,KAAKU,EAAE,CAAC,UAAY,IAAIG,KAAK;oBAAC;iBAAW,EAAE;oBAAEC,MAAM;gBAAW;QAC/E;IACF,CAAA;;;;;8DAlBkB;wBACiC;QAC5C;sBACwB;4BACJ;;;;;;AAM3B,MAAMN,iBAAiBR,KAAKU,EAAE,CAAC,UAAa,CAAA;QAAEK,MAAM,EAAE;QAAEC,OAAO;IAAE,CAAA;AAUjEC,SAAS,2BAA2B;IAClCC,GAAG,2DAA2D;QAC5DC,IAAAA,cAAM,gBACJ,qBAACC,SAAO;sBACN,cAAA,qBAACC,sBAAU;;QAGf,MAAMC,IAAAA,eAAO,EAAC,IAAMC,OAAOf,gBAAgBgB,gBAAgB;QAC3D,MAAMC,SAASjB,eAAeP,IAAI,CAACyB,KAAK,CAAC,EAAE,CAAC,EAAE;QAC9CH,OAAOE,OAAOE,IAAI,EAAEC,IAAI,CAAC;QACzBL,OAAOE,OAAOI,IAAI,EAAED,IAAI,CAAC;IAC3B;IAEAV,GAAG,oCAAoC;QACrCC,IAAAA,cAAM,gBACJ,qBAACC,SAAO;sBACN,cAAA,qBAACC,sBAAU;;QAIf,MAAMS,SAASC,cAAM,CAACC,oBAAoB,CAAC;QAC3CC,iBAAS,CAACC,MAAM,CAACJ,QAAQ;YAAEK,QAAQ;gBAAEC,OAAO;YAAK;QAAE;QACnDH,iBAAS,CAACI,OAAO,CAACP,QAAQ;YAAEQ,KAAK;QAAQ;QAEzC,MAAMC,eAAeR,cAAM,CAACC,oBAAoB,CAAC;QACjDC,iBAAS,CAACO,SAAS,CAACD;QACpB,MAAME,SAAS,MAAMV,cAAM,CAACW,UAAU,CAAC;QACvCT,iBAAS,CAACU,KAAK,CAACF;QAEhB,MAAMnB,IAAAA,eAAO,EAAC,IAAMC,OAAOf,gBAAgBoC,qBAAqB,CAAC;QACjE,MAAMnB,SAASjB,eAAeP,IAAI,CAACyB,KAAK,CAAClB,eAAeP,IAAI,CAACyB,KAAK,CAACmB,MAAM,GAAG,EAAE,CAAC,EAAE;QACjFtB,OAAOE,OAAOK,MAAM,EAAEF,IAAI,CAAC;QAC3BL,OAAOE,OAAOqB,MAAM,EAAElB,IAAI,CAAC;IAC7B;AACF"}