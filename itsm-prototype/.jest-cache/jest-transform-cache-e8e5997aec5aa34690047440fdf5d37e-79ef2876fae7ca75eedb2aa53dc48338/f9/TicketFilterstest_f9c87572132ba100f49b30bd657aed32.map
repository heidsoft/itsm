{"version":3,"sources":["/Users/heidsoft/Downloads/research/itsm/itsm-prototype/src/app/components/__tests__/TicketFilters.test.tsx"],"sourcesContent":["import React from 'react';\nimport { render, screen } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport TicketFilters, { TicketFilterState } from '../../components/TicketFilters';\n\ndescribe('TicketFilters 组件', () => {\n  const setup = (initial?: Partial<TicketFilterState>) => {\n    const onChange = jest.fn();\n    render(\n      <TicketFilters\n        value={{\n          status: 'all',\n          priority: 'all',\n          keyword: '',\n          dateStart: '',\n          dateEnd: '',\n          sortBy: 'createdAt_desc',\n          ...initial,\n        }}\n        onChange={onChange}\n      />\n    );\n    return { onChange };\n  };\n\n  it('应渲染所有过滤控件并展示默认值', () => {\n    setup();\n    expect(screen.getByTestId('filter-status-select')).toBeInTheDocument();\n    expect(screen.getByTestId('filter-priority-select')).toBeInTheDocument();\n    expect(screen.getByTestId('filter-keyword-input')).toBeInTheDocument();\n    expect(screen.getByTestId('filter-date-start')).toBeInTheDocument();\n    expect(screen.getByTestId('filter-date-end')).toBeInTheDocument();\n    expect(screen.getByTestId('filter-sort-select')).toBeInTheDocument();\n    expect(screen.getByTestId('filter-apply-btn')).toBeInTheDocument();\n    expect(screen.getByTestId('filter-reset-btn')).toBeInTheDocument();\n  });\n\n  it('状态过滤变化时应调用 onChange', async () => {\n    const user = userEvent.setup();\n    const { onChange } = setup();\n\n    await user.selectOptions(screen.getByTestId('filter-status-select'), 'open');\n    expect(onChange).toHaveBeenLastCalledWith(\n      expect.objectContaining({ status: 'open' })\n    );\n  });\n\n  it('优先级过滤变化时应调用 onChange', async () => {\n    const user = userEvent.setup();\n    const { onChange } = setup();\n\n    await user.selectOptions(screen.getByTestId('filter-priority-select'), 'p1');\n    expect(onChange).toHaveBeenLastCalledWith(\n      expect.objectContaining({ priority: 'p1' })\n    );\n  });\n\n  it('关键字输入后点击应用应调用 onChange，包含 keyword', async () => {\n    const user = userEvent.setup();\n    const { onChange } = setup();\n\n    const input = screen.getByTestId('filter-keyword-input');\n    await user.type(input, '数据库');\n    await user.click(screen.getByTestId('filter-apply-btn'));\n\n    expect(onChange).toHaveBeenLastCalledWith(\n      expect.objectContaining({ keyword: '数据库' })\n    );\n  });\n\n  it('设置日期范围后点击应用应包含 dateStart 与 dateEnd', async () => {\n    const user = userEvent.setup();\n    const { onChange } = setup();\n\n    await user.type(screen.getByTestId('filter-date-start'), '2025-01-01');\n    await user.type(screen.getByTestId('filter-date-end'), '2025-01-31');\n    await user.click(screen.getByTestId('filter-apply-btn'));\n\n    expect(onChange).toHaveBeenLastCalledWith(\n      expect.objectContaining({ dateStart: '2025-01-01', dateEnd: '2025-01-31' })\n    );\n  });\n\n  it('排序变化时应调用 onChange', async () => {\n    const user = userEvent.setup();\n    const { onChange } = setup();\n\n    await user.selectOptions(screen.getByTestId('filter-sort-select'), 'priority_desc');\n    expect(onChange).toHaveBeenLastCalledWith(\n      expect.objectContaining({ sortBy: 'priority_desc' })\n    );\n  });\n\n  it('重置按钮应将过滤条件恢复默认并调用 onChange', async () => {\n    const user = userEvent.setup();\n    const { onChange } = setup({ status: 'open', priority: 'p2', keyword: 'x' });\n\n    await user.click(screen.getByTestId('filter-reset-btn'));\n    expect(onChange).toHaveBeenLastCalledWith({\n      status: 'all',\n      priority: 'all',\n      keyword: '',\n      dateStart: '',\n      dateEnd: '',\n      sortBy: 'createdAt_desc',\n    });\n  });\n});"],"names":["describe","setup","initial","onChange","jest","fn","render","TicketFilters","value","status","priority","keyword","dateStart","dateEnd","sortBy","it","expect","screen","getByTestId","toBeInTheDocument","user","userEvent","selectOptions","toHaveBeenLastCalledWith","objectContaining","input","type","click"],"mappings":"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"}